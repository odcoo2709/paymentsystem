<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Order & Wallet Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Apple SD Gothic Neo', -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .admin-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .admin-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .admin-title {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .admin-subtitle {
            color: #7f8c8d;
            font-size: 16px;
            text-align: center;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 25px;
        }

        .lang-switch-btn {
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .lang-switch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .lang-icon {
            font-size: 16px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-button {
            flex: 1;
            padding: 18px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab-button:hover {
            background: #f8f9fa;
        }

        .tab-button.active {
            color: #3498db;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 14px;
            color: #27ae60;
        }

        .stat-change.negative {
            color: #e74c3c;
        }

        .orders-section, .wallets-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select, .search-box {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .search-box {
            width: 250px;
        }

        .refresh-button, .add-button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .add-button {
            background: #27ae60;
        }

        .refresh-button:hover {
            background: #2980b9;
        }

        .add-button:hover {
            background: #219653;
        }

        .export-button {
            padding: 10px 20px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .export-button:hover {
            background: #8e44ad;
        }

        .orders-table-container, .wallets-table-container {
            overflow-x: auto;
        }

        .orders-table, .wallets-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .wallets-table {
            min-width: 800px;
        }

        .orders-table th, .wallets-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #dee2e6;
        }

        .orders-table td, .wallets-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .orders-table tr:hover, .wallets-table tr:hover {
            background: #f8f9fa;
        }

        .order-id, .wallet-id {
            font-weight: bold;
            color: #2c3e50;
            font-family: monospace;
        }

        .order-time {
            font-size: 12px;
            color: #7f8c8d;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-align: center;
            min-width: 80px;
        }

        .status-waiting { background: #f39c12; }
        .status-confirmed { background: #3498db; }
        .status-processing { background: #9b59b6; }
        .status-completed { background: #27ae60; }
        .status-cancelled { background: #e74c3c; }

        .wallet-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-align: center;
            min-width: 80px;
        }

        .wallet-active { background: #27ae60; }
        .wallet-inactive { background: #95a5a6; }

        .network-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }

        .network-trc20 { background: #e74c3c; }
        .network-erc20 { background: #3498db; }
        .network-bep20 { background: #2ecc71; }
        .network-solana { background: #9b59b6; }
        .network-polygon { background: #8e44ad; }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .action-view { background: #3498db; color: white; }
        .action-confirm { background: #2ecc71; color: white; }
        .action-process { background: #9b59b6; color: white; }
        .action-complete { background: #27ae60; color: white; }
        .action-cancel { background: #e74c3c; color: white; }
        .action-reset { background: #f39c12; color: white; }
        .action-edit { background: #3498db; color: white; }
        .action-delete { background: #e74c3c; color: white; }
        .action-activate { background: #2ecc71; color: white; }
        .action-deactivate { background: #95a5a6; color: white; }
        .action-setdefault { background: #f39c12; color: white; }

        .no-orders, .no-wallets {
            text-align: center;
            padding: 50px;
            color: #95a5a6;
            font-size: 16px;
        }

        .amount-display {
            font-weight: bold;
            color: #2c3e50;
        }

        .progress-indicator {
            width: 100px;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-bar {
            height: 100%;
            background: #3498db;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .wallet-address {
            font-family: monospace;
            font-size: 12px;
            color: #2c3e50;
            word-break: break-all;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            margin-top: 5px;
            border: 1px solid #e9ecef;
        }

        .qr-code-small {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #dee2e6;
            margin: 0 auto;
        }

        .qr-code-small img {
            max-width: 100%;
            max-height: 100%;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #95a5a6;
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button.primary {
            background: #3498db;
            color: white;
        }

        .modal-button.secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .modal-button.success {
            background: #27ae60;
            color: white;
        }

        .modal-button.danger {
            background: #e74c3c;
            color: white;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .hidden {
            display: none;
        }

        .time-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .active-wallet-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .default-wallet-badge {
            display: inline-block;
            padding: 2px 8px;
            background: #f39c12;
            color: white;
            font-size: 10px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .wallet-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .total-row {
            background: #f8f9fa;
            font-weight: bold;
        }

        .save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
        }

        .save-status.show {
            display: block;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(20px); }
        }

        .sync-badge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 1000;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .filter-controls {
                width: 100%;
                flex-wrap: wrap;
            }
            
            .search-box {
                width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .language-switcher {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- ë™ê¸°í™” ë°°ì§€ -->
    <div class="sync-badge" id="syncBadge">
        <div class="sync-dot"></div>
        <span id="syncStatusText">ì‹¤ì‹œê°„ ë™ê¸°í™”</span>
    </div>
    
    <div class="admin-container">
        <!-- í—¤ë” -->
        <div class="admin-header">
            <div class="language-switcher">
                <button class="lang-switch-btn" id="langSwitchBtn">
                    <span class="lang-icon">ğŸŒ</span>
                    <span id="langSwitchText">English</span>
                </button>
            </div>
            <h1 class="admin-title" id="adminTitle">ğŸ“Š ì£¼ë¬¸ ë° ì§€ê°‘ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p class="admin-subtitle" id="adminSubtitle">í•œ ê³³ì—ì„œ ì‚¬ìš©ì ì£¼ë¬¸ê³¼ ì§€ê°‘ ì„¤ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab-button active" data-tab="orders">ğŸ“‹ ì£¼ë¬¸ ê´€ë¦¬</button>
            <button class="tab-button" data-tab="wallets">ğŸ‘› ì§€ê°‘ ê´€ë¦¬</button>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-cards">
            <div class="stat-card">
                <h3 id="statTotalOrders">ì´ ì£¼ë¬¸</h3>
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-change" id="statTotalChange">ì „ì²´ ì£¼ë¬¸</div>
            </div>
            <div class="stat-card">
                <h3 id="statWaiting">ì…ê¸ˆ ëŒ€ê¸°</h3>
                <div class="stat-value" id="waitingOrders">0</div>
                <div class="stat-change" id="waitingChange">ëŒ€ê¸°ì¤‘</div>
            </div>
            <div class="stat-card">
                <h3 id="statActiveWallets">í™œì„± ì§€ê°‘</h3>
                <div class="stat-value" id="activeWallets">0</div>
                <div class="stat-change" id="walletsChange">ì‚¬ìš© ê°€ëŠ¥</div>
            </div>
            <div class="stat-card">
                <h3 id="statTodayRevenue">ì˜¤ëŠ˜ ìˆ˜ìµ</h3>
                <div class="stat-value" id="todayRevenue">0 THB</div>
                <div class="stat-change" id="revenueChange">ì´ ê±°ë˜ì•¡</div>
            </div>
        </div>

        <!-- ì£¼ë¬¸ ê´€ë¦¬ íƒ­ -->
        <div id="ordersTab" class="tab-content active">
            <div class="orders-section">
                <div class="section-header">
                    <h2 class="section-title" id="ordersTitle">ğŸ“‹ ì£¼ë¬¸ ëª©ë¡</h2>
                    <div class="filter-controls">
                        <input type="text" class="search-box" id="searchOrder" placeholder="ì£¼ë¬¸ ID ê²€ìƒ‰...">
                        <select class="filter-select" id="statusFilter">
                            <option value="all">ëª¨ë“  ìƒíƒœ</option>
                            <option value="ì…ê¸ˆëŒ€ê¸°">ì…ê¸ˆ ëŒ€ê¸°</option>
                            <option value="ì…ê¸ˆí™•ì¸">ì…ê¸ˆ í™•ì¸</option>
                            <option value="ì²˜ë¦¬ì¤‘">ì²˜ë¦¬ì¤‘</option>
                            <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                            <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                        </select>
                        <div class="time-filter">
                            <input type="date" class="time-input" id="dateFrom">
                            <span>~</span>
                            <input type="date" class="time-input" id="dateTo">
                        </div>
                        <button class="export-button" id="exportOrders">ğŸ“¥ ì €ì¥í•˜ê¸°</button>
                        <button class="refresh-button" id="refreshOrders">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>

                <div class="orders-table-container">
                    <table class="orders-table" id="ordersTable">
                        <thead>
                            <tr>
                                <th id="thOrderId">ì£¼ë¬¸ ID(Order ID)</th>
                                <th id="thAmount">ê¸ˆì•¡ (THB)</th>
                                <th id="thWallet">ì…ê¸ˆ ì§€ê°‘</th>
                                <th id="thStatus">ìƒíƒœ</th>
                                <th id="thStep">ì§„í–‰ ë‹¨ê³„</th>
                                <th id="thProof">ìœ ì € ìš”ì²­ì„œ</th>
                                <th id="thAction">ê²°ì œ ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <tr>
                                <td colspan="7" class="no-orders" id="noOrdersText">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ì§€ê°‘ ê´€ë¦¬ íƒ­ -->
        <div id="walletsTab" class="tab-content">
            <div class="wallets-section">
                <div class="section-header">
                    <h2 class="section-title" id="walletsTitle">ğŸ‘› ì§€ê°‘ ëª©ë¡</h2>
                    <div class="filter-controls">
                        <select class="filter-select" id="walletStatusFilter">
                            <option value="all">ëª¨ë“  ìƒíƒœ</option>
                            <option value="active">í™œì„±</option>
                            <option value="inactive">ë¹„í™œì„±</option>
                        </select>
                        <select class="filter-select" id="walletNetworkFilter">
                            <option value="all">ëª¨ë“  ë„¤íŠ¸ì›Œí¬</option>
                            <option value="TRC20">TRC20</option>
                            <option value="ERC20">ERC20</option>
                            <option value="BEP20">BEP20</option>
                            <option value="Solana">Solana</option>
                            <option value="Polygon">Polygon</option>
                        </select>
                        <button class="add-button" id="addWallet">â• ìƒˆ ì§€ê°‘ ì¶”ê°€</button>
                        <button class="refresh-button" id="refreshWallets">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>

                <div class="wallets-table-container">
                    <table class="wallets-table" id="walletsTable">
                        <thead>
                            <tr>
                                <th id="thWalletName">ì´ë¦„</th>
                                <th id="thNetwork">ë„¤íŠ¸ì›Œí¬</th>
                                <th id="thAddress">ì£¼ì†Œ</th>
                                <th id="thQRCode">QR ì½”ë“œ</th>
                                <th id="thWalletStatus">ìƒíƒœ</th>
                                <th id="thCreated">ìƒì„±ì¼</th>
                                <th id="thWalletAction">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="walletsTableBody">
                            <tr>
                                <td colspan="7" class="no-wallets" id="noWalletsText">ì§€ê°‘ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì§€ê°‘ì„ ì¶”ê°€í•˜ì„¸ìš”.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;" id="walletGuideTitle">ğŸ’¡ ì§€ê°‘ ê´€ë¦¬ ì•ˆë‚´</h3>
                    <ul style="color: #4a5568; line-height: 1.6; padding-left: 20px;" id="walletGuideList">
                        <li>ì—¬ëŸ¬ ê°œì˜ ì§€ê°‘ì„ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li><strong>í™œì„± ì§€ê°‘</strong>ì€ ì‚¬ìš©ì í˜ì´ì§€ì— í‘œì‹œë©ë‹ˆë‹¤.</li>
                        <li><strong>ê¸°ë³¸ ì§€ê°‘</strong>ì€ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ í™œì„± ìƒíƒœëŠ” ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>ê° ì§€ê°‘ì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>ë„¤íŠ¸ì›Œí¬ ìœ í˜•ë³„ë¡œ ì§€ê°‘ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ì €ì¥ ìƒíƒœ í‘œì‹œ -->
    <div class="save-status" id="saveStatus">
        íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
    </div>

    <!-- ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay hidden" id="orderDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="orderDetailTitle">ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h3>
                <button class="modal-close" id="closeDetailModal">âœ•</button>
            </div>
            <div class="modal-body" id="orderDetailContent">
                <!-- ë™ì  ë‚´ìš© -->
            </div>
            <div class="modal-actions" id="orderDetailActions">
                <!-- ë™ì  ì•¡ì…˜ ë²„íŠ¼ -->
            </div>
        </div>
    </div>

    <!-- ì§€ê°‘ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay hidden" id="walletModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="walletModalTitle">ğŸ‘› ìƒˆ ì§€ê°‘ ì¶”ê°€</h3>
                <button class="modal-close" id="closeWalletModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="walletForm">
                    <div class="form-group">
                        <label class="form-label" id="labelWalletName">ì§€ê°‘ ì´ë¦„ *</label>
                        <input type="text" class="form-input" id="walletName" 
                               placeholder="ì˜ˆ: ë©”ì¸ TRC20 ì§€ê°‘" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" id="labelNetwork">ë„¤íŠ¸ì›Œí¬ *</label>
                            <select class="form-select" id="walletNetwork" required>
                                <option value="">ì„ íƒ</option>
                                <option value="TRC20">TRC20 (íŠ¸ë¡ )</option>
                                <option value="ERC20">ERC20 (ì´ë”ë¦¬ì›€)</option>
                                <option value="BEP20">BEP20 (BNB ìŠ¤ë§ˆíŠ¸ ì²´ì¸)</option>
                                <option value="Solana">Solana</option>
                                <option value="Polygon">Polygon</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" id="labelStatus">ìƒíƒœ</label>
                            <select class="form-select" id="walletStatus">
                                <option value="active">í™œì„±</option>
                                <option value="inactive">ë¹„í™œì„±</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="labelAddress">ì§€ê°‘ ì£¼ì†Œ *</label>
                        <textarea class="form-textarea" id="walletAddress" 
                                  placeholder="ì§€ê°‘ ì£¼ì†Œ ì…ë ¥" 
                                  rows="3" required></textarea>
                        <small style="color: #718096; font-size: 12px;" id="addressHelp">
                            * ì˜¬ë°”ë¥¸ ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”. í˜•ì‹ì€ ë„¤íŠ¸ì›Œí¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="labelQRCode">QR ì½”ë“œ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)</label>
                        <input type="file" class="form-input" id="walletQRCode" 
                               accept="image/*">
                        <small style="color: #718096; font-size: 12px;" id="qrCodeHelp">
                            * ì§€ê°‘ ì£¼ì†Œì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”. (ê¶Œì¥ í¬ê¸°: 200x200px)
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="labelMemo">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
                        <textarea class="form-textarea" id="walletMemo" 
                                  placeholder="ì§€ê°‘ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´" 
                                  rows="2"></textarea>
                    </div>

                    <input type="hidden" id="walletId">
                </form>
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" id="cancelWalletModal">ì·¨ì†Œ</button>
                <button class="modal-button primary" id="saveWallet">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== ë°ì´í„° ê´€ë¦¬ì í´ë˜ìŠ¤ ====================
        class DataManager {
            constructor() {
                this.ORDERS_KEY = 'payment_orders';
                this.WALLETS_KEY = 'payment_wallets';
                this.SYNC_KEY = 'payment_sync_flag';
                this.ADMIN_SYNC_KEY = 'admin_sync_check';
            }

            // ì£¼ë¬¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            getOrders() {
                try {
                    return JSON.parse(localStorage.getItem(this.ORDERS_KEY) || '[]');
                } catch (error) {
                    console.error('Error loading orders:', error);
                    return [];
                }
            }

            // ì£¼ë¬¸ ë°ì´í„° ì €ì¥í•˜ê¸°
            saveOrders(orders) {
                try {
                    localStorage.setItem(this.ORDERS_KEY, JSON.stringify(orders));
                    localStorage.setItem(this.SYNC_KEY, Date.now().toString());
                    return true;
                } catch (error) {
                    console.error('Error saving orders:', error);
                    return false;
                }
            }

            // ì§€ê°‘ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            getWallets() {
                try {
                    let wallets = JSON.parse(localStorage.getItem(this.WALLETS_KEY) || '[]');
                    
                    if (wallets.length === 0) {
                        wallets = [this.createDefaultWallet()];
                        this.saveWallets(wallets);
                    }
                    
                    return wallets;
                } catch (error) {
                    console.error('Error loading wallets:', error);
                    return [];
                }
            }

            // ì§€ê°‘ ë°ì´í„° ì €ì¥í•˜ê¸°
            saveWallets(wallets) {
                try {
                    localStorage.setItem(this.WALLETS_KEY, JSON.stringify(wallets));
                    localStorage.setItem(this.SYNC_KEY, Date.now().toString());
                    return true;
                } catch (error) {
                    console.error('Error saving wallets:', error);
                    return false;
                }
            }

            // ê¸°ë³¸ ì§€ê°‘ ìƒì„±
            createDefaultWallet() {
                return {
                    id: 'wallet_1',
                    name: 'ê¸°ë³¸ ì§€ê°‘ (TRC20)',
                    address: 'TXYZ1234567890abcdefghijklmnopqrstuvw',
                    network: 'TRC20',
                    qrCode: null,
                    isActive: true,
                    isDefault: true,
                    createdAt: new Date().toISOString()
                };
            }

            // ë™ê¸°í™” ì²´í¬
            checkSync() {
                return localStorage.getItem(this.SYNC_KEY);
            }

            // ê´€ë¦¬ì ë™ê¸°í™” ì‹œê°„ ì—…ë°ì´íŠ¸
            updateAdminSync() {
                const syncTime = this.checkSync();
                localStorage.setItem(this.ADMIN_SYNC_KEY, syncTime || '0');
                return syncTime;
            }

            // ë™ê¸°í™” í•„ìš” ì—¬ë¶€ ì²´í¬
            needsSync() {
                const lastSync = this.checkSync();
                const lastAdminSync = localStorage.getItem(this.ADMIN_SYNC_KEY) || '0';
                return lastSync !== lastAdminSync;
            }

            // ì‚¬ìš©ì í˜ì´ì§€ì— ìƒíƒœ ì—…ë°ì´íŠ¸ ì•Œë¦¼
            notifyUserPage(orderId, newStatus) {
                try {
                    // ì‚¬ìš©ì í˜ì´ì§€ê°€ ì—´ë ¤ìˆìœ¼ë©´ window ê°ì²´ë¥¼ í†µí•´ ì•Œë¦¼
                    if (window.updateOrderStatusFromAdmin) {
                        window.updateOrderStatusFromAdmin(orderId, newStatus);
                    }
                } catch (e) {
                    console.log('ì‚¬ìš©ì í˜ì´ì§€ ì•Œë¦¼ ì‹¤íŒ¨');
                }
            }

            // ì‚¬ìš©ì í˜ì´ì§€ì— ì§€ê°‘ ì—…ë°ì´íŠ¸ ì•Œë¦¼
            notifyUserPageWallets(wallets) {
                try {
                    if (window.updateWalletsFromAdmin) {
                        window.updateWalletsFromAdmin(wallets);
                    }
                } catch (e) {
                    console.log('ì‚¬ìš©ì í˜ì´ì§€ ì§€ê°‘ ì•Œë¦¼ ì‹¤íŒ¨');
                }
            }
        }

        // ==================== ì „ì—­ ë³€ìˆ˜ ====================
        const dataManager = new DataManager();
        
        let allOrders = [];
        let allWallets = [];
        let currentFilter = 'all';
        let selectedOrder = null;
        let selectedWallet = null;
        let currentTab = 'orders';
        let qrCodeFile = null;
        let currentLang = 'ko';
        let syncCheckInterval = null;

        // ë²ˆì—­ ë°ì´í„°
        const translations = {
            en: {
                adminTitle: "ğŸ“Š Order & Wallet Management System",
                adminSubtitle: "Manage user orders and wallet settings in one place",
                langSwitchText: "í•œêµ­ì–´",
                statTotalOrders: "Total Orders",
                statWaiting: "Waiting Deposit",
                statActiveWallets: "Active Wallets",
                statTodayRevenue: "Today's Revenue",
                ordersTitle: "ğŸ“‹ Order List",
                walletsTitle: "ğŸ‘› Wallet List",
                thOrderId: "Order ID",
                thTime: "Time",
                thAmount: "Amount (THB)",
                thWallet: "Wallet",
                thStatus: "Status",
                thStep: "Step",
                thProof: "Proof",
                thAction: "Action",
                thWalletName: "Name",
                thNetwork: "Network",
                thAddress: "Address",
                thQRCode: "QR Code",
                thWalletStatus: "Status",
                thCreated: "Created",
                thWalletAction: "Action",
                noOrdersText: "No orders",
                noWalletsText: "No wallets. Please add a new wallet.",
                searchPlaceholder: "Search order ID...",
                statusAll: "All Status",
                statusWaiting: "Waiting Deposit",
                statusConfirmed: "Deposit Confirmed",
                statusProcessing: "Processing",
                statusCompleted: "Completed",
                statusCancelled: "Cancelled",
                exportBtn: "ğŸ“¥ Export",
                refreshBtn: "ğŸ”„ Refresh",
                addWalletBtn: "â• Add New Wallet",
                walletGuideTitle: "ğŸ’¡ Wallet Management Guide",
                walletGuideList: [
                    "You can add, edit, and delete multiple wallets.",
                    "<strong>Active wallets</strong> are displayed on the user page.",
                    "<strong>Default wallet</strong> cannot be deleted, but its active status can be changed.",
                    "You can upload QR code images for each wallet.",
                    "Manage wallets by network type."
                ],
                orderDetailTitle: "ğŸ“‹ Order Details",
                walletModalTitle: "ğŸ‘› Add New Wallet",
                labelWalletName: "Wallet Name *",
                labelNetwork: "Network *",
                labelStatus: "Status",
                labelAddress: "Wallet Address *",
                addressHelp: "* Enter correct wallet address. Format varies by network.",
                labelQRCode: "QR Code Image (Optional)",
                qrCodeHelp: "* Upload QR code image for wallet address. (Recommended size: 200x200px)",
                labelMemo: "Memo (Optional)",
                saveBtn: "Save",
                cancelBtn: "Cancel",
                statTotalChange: "All orders",
                waitingChange: "waiting",
                walletsChange: "available",
                revenueChange: "Total transaction",
                syncStatusText: "Real-time Sync"
            },
            ko: {
                adminTitle: "ğŸ“Š ì£¼ë¬¸ ë° ì§€ê°‘ ê´€ë¦¬ ì‹œìŠ¤í…œ",
                adminSubtitle: "í•œ ê³³ì—ì„œ ì‚¬ìš©ì ì£¼ë¬¸ê³¼ ì§€ê°‘ ì„¤ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”",
                langSwitchText: "English",
                statTotalOrders: "ì´ ì£¼ë¬¸",
                statWaiting: "ì…ê¸ˆ ëŒ€ê¸°",
                statActiveWallets: "í™œì„± ì§€ê°‘",
                statTodayRevenue: "ì˜¤ëŠ˜ ìˆ˜ìµ",
                ordersTitle: "ğŸ“‹ ì£¼ë¬¸ ëª©ë¡",
                walletsTitle: "ğŸ‘› ì§€ê°‘ ëª©ë¡",
                thOrderId: "ì£¼ë¬¸ ID",
                thTime: "ì‹œê°„",
                thAmount: "ê¸ˆì•¡ (THB)",
                thWallet: "ì§€ê°‘",
                thStatus: "ìƒíƒœ",
                thStep: "ë‹¨ê³„",
                thProof: "ì¦ëª…ì„œ",
                thAction: "ì‘ì—…",
                thWalletName: "ì´ë¦„",
                thNetwork: "ë„¤íŠ¸ì›Œí¬",
                thAddress: "ì£¼ì†Œ",
                thQRCode: "QR ì½”ë“œ",
                thWalletStatus: "ìƒíƒœ",
                thCreated: "ìƒì„±ì¼",
                thWalletAction: "ì‘ì—…",
                noOrdersText: "ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤",
                noWalletsText: "ì§€ê°‘ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì§€ê°‘ì„ ì¶”ê°€í•˜ì„¸ìš”.",
                searchPlaceholder: "ì£¼ë¬¸ ID ê²€ìƒ‰...",
                statusAll: "ëª¨ë“  ìƒíƒœ",
                statusWaiting: "ì…ê¸ˆ ëŒ€ê¸°",
                statusConfirmed: "ì…ê¸ˆ í™•ì¸",
                statusProcessing: "ì²˜ë¦¬ì¤‘",
                statusCompleted: "ì™„ë£Œ",
                statusCancelled: "ì·¨ì†Œ",
                exportBtn: "ğŸ“¥ ë‚´ë³´ë‚´ê¸°",
                refreshBtn: "ğŸ”„ ìƒˆë¡œê³ ì¹¨",
                addWalletBtn: "â• ìƒˆ ì§€ê°‘ ì¶”ê°€",
                walletGuideTitle: "ğŸ’¡ ì§€ê°‘ ê´€ë¦¬ ì•ˆë‚´",
                walletGuideList: [
                    "ì—¬ëŸ¬ ê°œì˜ ì§€ê°‘ì„ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "<strong>í™œì„± ì§€ê°‘</strong>ì€ ì‚¬ìš©ì í˜ì´ì§€ì— í‘œì‹œë©ë‹ˆë‹¤.",
                    "<strong>ê¸°ë³¸ ì§€ê°‘</strong>ì€ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ í™œì„± ìƒíƒœëŠ” ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "ê° ì§€ê°‘ì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "ë„¤íŠ¸ì›Œí¬ ìœ í˜•ë³„ë¡œ ì§€ê°‘ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                ],
                orderDetailTitle: "ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´",
                walletModalTitle: "ğŸ‘› ìƒˆ ì§€ê°‘ ì¶”ê°€",
                labelWalletName: "ì§€ê°‘ ì´ë¦„ *",
                labelNetwork: "ë„¤íŠ¸ì›Œí¬ *",
                labelStatus: "ìƒíƒœ",
                labelAddress: "ì§€ê°‘ ì£¼ì†Œ *",
                addressHelp: "* ì˜¬ë°”ë¥¸ ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”. í˜•ì‹ì€ ë„¤íŠ¸ì›Œí¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.",
                labelQRCode: "QR ì½”ë“œ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)",
                qrCodeHelp: "* ì§€ê°‘ ì£¼ì†Œì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”. (ê¶Œì¥ í¬ê¸°: 200x200px)",
                labelMemo: "ë©”ëª¨ (ì„ íƒì‚¬í•­)",
                saveBtn: "ì €ì¥",
                cancelBtn: "ì·¨ì†Œ",
                statTotalChange: "ì „ì²´ ì£¼ë¬¸",
                waitingChange: "ëŒ€ê¸°ì¤‘",
                walletsChange: "ì‚¬ìš© ê°€ëŠ¥",
                revenueChange: "ì´ ê±°ë˜ì•¡",
                syncStatusText: "ì‹¤ì‹œê°„ ë™ê¸°í™”"
            }
        };

        // ==================== í˜ì´ì§€ ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ê´€ë¦¬ì í˜ì´ì§€ ë¡œë“œë¨');
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateFrom').value = today;
            document.getElementById('dateTo').value = today;
            
            // ì–¸ì–´ ì´ˆê¸°í™”
            currentLang = 'ko';
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            // ë°ì´í„° ë¡œë“œ
            loadAllData();
            
            // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateAllText();
            
            // ë™ê¸°í™” ì²´í¬ ì‹œì‘
            startSyncCheck();
            
            console.log('ê´€ë¦¬ì í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // ==================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ====================
        function setupEventListeners() {
            // ì–¸ì–´ ì „í™˜ ë²„íŠ¼
            document.getElementById('langSwitchBtn').addEventListener('click', toggleLanguage);
            
            // íƒ­ ì „í™˜
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', switchTab);
            });
            
            // ì£¼ë¬¸ ê´€ë¦¬ í•„í„°
            document.getElementById('statusFilter').addEventListener('change', updateOrders);
            document.getElementById('searchOrder').addEventListener('input', updateOrders);
            document.getElementById('dateFrom').addEventListener('change', updateOrders);
            document.getElementById('dateTo').addEventListener('change', updateOrders);
            document.getElementById('refreshOrders').addEventListener('click', () => loadAllData());
            document.getElementById('exportOrders').addEventListener('click', exportOrdersToExcel);
            
            // ì§€ê°‘ ê´€ë¦¬ í•„í„°
            document.getElementById('walletStatusFilter').addEventListener('change', updateWallets);
            document.getElementById('walletNetworkFilter').addEventListener('change', updateWallets);
            document.getElementById('refreshWallets').addEventListener('click', () => loadAllData());
            document.getElementById('addWallet').addEventListener('click', openAddWalletModal);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            document.getElementById('closeDetailModal').addEventListener('click', closeOrderDetail);
            document.getElementById('closeWalletModal').addEventListener('click', closeWalletModal);
            document.getElementById('cancelWalletModal').addEventListener('click', closeWalletModal);
            
            // ì§€ê°‘ ëª¨ë‹¬ ì €ì¥
            document.getElementById('saveWallet').addEventListener('click', saveWallet);
            document.getElementById('walletQRCode').addEventListener('change', handleQRCodeUpload);
            
            // ì§€ê°‘ í¼ ì œì¶œ ë°©ì§€
            document.getElementById('walletForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveWallet();
            });
        }

        // ==================== ì–¸ì–´ ê´€ë ¨ ====================
        function toggleLanguage() {
    console.log('í˜„ì¬ ì–¸ì–´:', currentLang, '-> ë³€ê²½');
    currentLang = currentLang === 'en' ? 'ko' : 'en';
    updateAllText();
}

        function updateAllText() {
    const trans = translations[currentLang];
    console.log('ê´€ë¦¬ì: ì–¸ì–´ ì—…ë°ì´íŠ¸ ->', currentLang);
    
    try {
        // í—¤ë”
        safeSetText('adminTitle', trans.adminTitle);
        safeSetText('adminSubtitle', trans.adminSubtitle);
        safeSetText('langSwitchText', trans.langSwitchText);
        
        // í†µê³„
        safeSetText('statTotalOrders', trans.statTotalOrders);
        safeSetText('statWaiting', trans.statWaiting);
        safeSetText('statActiveWallets', trans.statActiveWallets);
        safeSetText('statTodayRevenue', trans.statTodayRevenue);
        safeSetText('statTotalChange', trans.statTotalChange);
        safeSetText('walletsChange', trans.walletsChange);
        safeSetText('revenueChange', trans.revenueChange);
        
        // íƒ­ ë²„íŠ¼
        const tabButtons = document.querySelectorAll('.tab-button');
        if (tabButtons[0]) tabButtons[0].textContent = 'ğŸ“‹ ' + (currentLang === 'en' ? 'Order Management' : 'ì£¼ë¬¸ ê´€ë¦¬');
        if (tabButtons[1]) tabButtons[1].textContent = 'ğŸ‘› ' + (currentLang === 'en' ? 'Wallet Management' : 'ì§€ê°‘ ê´€ë¦¬');
        
        // ì£¼ë¬¸ ê´€ë¦¬
        safeSetText('ordersTitle', trans.ordersTitle);
        safeSetText('noOrdersText', trans.noOrdersText);
        safeSetPlaceholder('searchOrder', trans.searchPlaceholder);
        safeSetText('exportOrders', trans.exportBtn);
        safeSetText('refreshOrders', trans.refreshBtn);
        
        // í…Œì´ë¸” í—¤ë”
        safeSetText('thOrderId', trans.thOrderId);
        safeSetText('thAmount', trans.thAmount);
        safeSetText('thWallet', trans.thWallet);
        safeSetText('thStatus', trans.thStatus);
        safeSetText('thStep', trans.thStep);
        safeSetText('thProof', trans.thProof);
        safeSetText('thAction', trans.thAction);
        
        // ìƒíƒœ í•„í„° ì˜µì…˜
        const statusFilter = document.getElementById('statusFilter');
        if (statusFilter) {
            statusFilter.innerHTML = `
                <option value="all">${trans.statusAll}</option>
                <option value="ì…ê¸ˆëŒ€ê¸°">${trans.statusWaiting}</option>
                <option value="ì…ê¸ˆí™•ì¸">${trans.statusConfirmed}</option>
                <option value="ì²˜ë¦¬ì¤‘">${trans.statusProcessing}</option>
                <option value="ì™„ë£Œ">${trans.statusCompleted}</option>
                <option value="ì·¨ì†Œ">${trans.statusCancelled}</option>
            `;
        }
        
        // ì§€ê°‘ ê´€ë¦¬
        safeSetText('walletsTitle', trans.walletsTitle);
        safeSetText('noWalletsText', trans.noWalletsText);
        safeSetText('addWallet', trans.addWalletBtn);
        safeSetText('refreshWallets', trans.refreshBtn);
        safeSetText('walletGuideTitle', trans.walletGuideTitle);
        
        // ì§€ê°‘ ê°€ì´ë“œ ë¦¬ìŠ¤íŠ¸
        const walletGuideList = document.getElementById('walletGuideList');
        if (walletGuideList) {
            let guideListHtml = '';
            trans.walletGuideList.forEach(item => {
                guideListHtml += `<li>${item}</li>`;
            });
            walletGuideList.innerHTML = guideListHtml;
        }
        
        // ì§€ê°‘ í…Œì´ë¸” í—¤ë”
        safeSetText('thWalletName', trans.thWalletName);
        safeSetText('thNetwork', trans.thNetwork);
        safeSetText('thAddress', trans.thAddress);
        safeSetText('thQRCode', trans.thQRCode);
        safeSetText('thWalletStatus', trans.thWalletStatus);
        safeSetText('thCreated', trans.thCreated);
        safeSetText('thWalletAction', trans.thWalletAction);
        
        // ëª¨ë‹¬
        safeSetText('orderDetailTitle', trans.orderDetailTitle);
        safeSetText('walletModalTitle', trans.walletModalTitle);
        safeSetText('labelWalletName', trans.labelWalletName);
        safeSetText('labelNetwork', trans.labelNetwork);
        safeSetText('labelStatus', trans.labelStatus);
        safeSetText('labelAddress', trans.labelAddress);
        safeSetText('addressHelp', trans.addressHelp);
        safeSetText('labelQRCode', trans.labelQRCode);
        safeSetText('qrCodeHelp', trans.qrCodeHelp);
        safeSetText('labelMemo', trans.labelMemo);
        safeSetText('saveWallet', trans.saveBtn);
        safeSetText('cancelWalletModal', trans.cancelBtn);
        
        // ë™ê¸°í™” ìƒíƒœ
        safeSetText('syncStatusText', trans.syncStatusText);
        
        console.log('ê´€ë¦¬ì: ì–¸ì–´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        
    } catch (error) {
        console.error('ì–¸ì–´ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
    }
}

// âœ… ì•ˆì „í•œ í…ìŠ¤íŠ¸ ì„¤ì • í•¨ìˆ˜
function safeSetText(elementId, text) {
    const element = document.getElementById(elementId);
    if (element) {
        element.textContent = text;
    } else {
        console.warn(`ìš”ì†Œ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${elementId}`);
    }
}

// âœ… ì•ˆì „í•œ placeholder ì„¤ì • í•¨ìˆ˜
function safeSetPlaceholder(elementId, placeholder) {
    const element = document.getElementById(elementId);
    if (element) {
        element.placeholder = placeholder;
    } else {
        console.warn(`ìš”ì†Œ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${elementId}`);
    }
}
    
    // ì§€ê°‘ ê´€ë¦¬
    document.getElementById('walletsTitle').textContent = trans.walletsTitle;
    document.getElementById('noWalletsText').textContent = trans.noWalletsText;
    document.getElementById('addWallet').textContent = trans.addWalletBtn;
    document.getElementById('refreshWallets').textContent = trans.refreshBtn;
    document.getElementById('walletGuideTitle').textContent = trans.walletGuideTitle;
    
    // ì§€ê°‘ ê°€ì´ë“œ ë¦¬ìŠ¤íŠ¸
    let guideListHtml = '';
    trans.walletGuideList.forEach(item => {
        guideListHtml += `<li>${item}</li>`;
    });
    document.getElementById('walletGuideList').innerHTML = guideListHtml;
    
    // ì§€ê°‘ í…Œì´ë¸” í—¤ë”
    document.getElementById('thWalletName').textContent = trans.thWalletName;
    document.getElementById('thNetwork').textContent = trans.thNetwork;
    document.getElementById('thAddress').textContent = trans.thAddress;
    document.getElementById('thQRCode').textContent = trans.thQRCode;
    document.getElementById('thWalletStatus').textContent = trans.thWalletStatus;
    document.getElementById('thCreated').textContent = trans.thCreated;
    document.getElementById('thWalletAction').textContent = trans.thWalletAction;
    
    // ëª¨ë‹¬
    document.getElementById('orderDetailTitle').textContent = trans.orderDetailTitle;
    document.getElementById('walletModalTitle').textContent = trans.walletModalTitle;
    document.getElementById('labelWalletName').textContent = trans.labelWalletName;
    document.getElementById('labelNetwork').textContent = trans.labelNetwork;
    document.getElementById('labelStatus').textContent = trans.labelStatus;
    document.getElementById('labelAddress').textContent = trans.labelAddress;
    document.getElementById('addressHelp').textContent = trans.addressHelp;
    document.getElementById('labelQRCode').textContent = trans.labelQRCode;
    document.getElementById('qrCodeHelp').textContent = trans.qrCodeHelp;
    document.getElementById('labelMemo').textContent = trans.labelMemo;
    document.getElementById('saveWallet').textContent = trans.saveBtn;
    document.getElementById('cancelWalletModal').textContent = trans.cancelBtn;
    
    // ë™ê¸°í™” ìƒíƒœ
    document.getElementById('syncStatusText').textContent = trans.syncStatusText;
    
    // âœ… ì£¼ë¬¸ ëª©ë¡ì˜ ì•¡ì…˜ ë²„íŠ¼ë“¤ë„ ì—…ë°ì´íŠ¸
    updateOrders();
    updateWallets();
}

        // ==================== ë°ì´í„° ë¡œë“œ ====================
        function loadAllData() {
    try {
        // ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ
        allOrders = dataManager.getOrders();
        console.log('ê´€ë¦¬ì: ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ', allOrders.length, 'ê°œ');
        
        // ì§€ê°‘ ë°ì´í„° ë¡œë“œ
        allWallets = dataManager.getWallets();
        console.log('ê´€ë¦¬ì: ì§€ê°‘ ë°ì´í„° ë¡œë“œ', allWallets.length, 'ê°œ');
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        updateStats();
        
        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        updateOrders();
        updateWallets();
        
        // ë™ê¸°í™” ì‹œê°„ ì—…ë°ì´íŠ¸
        dataManager.updateAdminSync();
        
    } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
}
        // ==================== í†µê³„ ì—…ë°ì´íŠ¸ ====================
        function updateStats() {
            const totalOrders = allOrders.length;
            const waitingOrders = allOrders.filter(o => o.status === 'ì…ê¸ˆëŒ€ê¸°').length;
            const activeWallets = allWallets.filter(w => w.isActive).length;
            
            // ì˜¤ëŠ˜ ë§¤ì¶œ ê³„ì‚°
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = allOrders.filter(o => {
                const orderDate = o.time.split('T')[0];
                return orderDate === today && o.status === 'ì™„ë£Œ';
            });
            
            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.amount, 0);
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('waitingOrders').textContent = waitingOrders;
            document.getElementById('activeWallets').textContent = activeWallets;
            document.getElementById('todayRevenue').textContent = todayRevenue.toLocaleString() + ' THB';
            
            const trans = translations[currentLang];
            document.getElementById('waitingChange').textContent = `${waitingOrders} ${trans.waitingChange}`;
            document.getElementById('walletsChange').textContent = `${activeWallets} ${trans.walletsChange}`;
            
            if (waitingOrders > 0) {
                document.getElementById('waitingChange').classList.remove('negative');
            } else {
                document.getElementById('waitingChange').classList.add('negative');
            }
        }

        // ==================== ì£¼ë¬¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ====================
        function updateOrders() {
            currentFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchOrder').value.toLowerCase();
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let filteredOrders = [...allOrders];
            
            // ìƒíƒœ í•„í„°ë§
            if (currentFilter !== 'all') {
                filteredOrders = filteredOrders.filter(o => o.status === currentFilter);
            }
            
            // ê²€ìƒ‰ì–´ í•„í„°ë§
            if (searchTerm) {
                filteredOrders = filteredOrders.filter(o => 
                    o.id.toLowerCase().includes(searchTerm)
                );
            }
            
            // ë‚ ì§œ í•„í„°ë§
            if (dateFrom && dateTo) {
                filteredOrders = filteredOrders.filter(o => {
                    const orderDate = o.time.split('T')[0];
                    return orderDate >= dateFrom && orderDate <= dateTo;
                });
            }
            
            // ì‹œê°„ìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            filteredOrders.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            const ordersTableBody = document.getElementById('ordersTableBody');
            
            if (filteredOrders.length === 0) {
                const trans = translations[currentLang];
                ordersTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-orders">${trans.noOrdersText}</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredOrders.forEach(order => {
                const time = new Date(order.time).toLocaleString('ko-KR', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusClass = {
                    'ì…ê¸ˆëŒ€ê¸°': 'status-waiting',
                    'ì…ê¸ˆí™•ì¸': 'status-confirmed',
                    'ì²˜ë¦¬ì¤‘': 'status-processing',
                    'ì™„ë£Œ': 'status-completed',
                    'ì·¨ì†Œ': 'status-cancelled'
                }[order.status] || 'status-waiting';
                
                // ìƒíƒœ í…ìŠ¤íŠ¸ ë²ˆì—­
                const statusText = {
                    'ì…ê¸ˆëŒ€ê¸°': currentLang === 'en' ? 'Waiting Deposit' : 'ì…ê¸ˆëŒ€ê¸°',
                    'ì…ê¸ˆí™•ì¸': currentLang === 'en' ? 'Deposit Confirmed' : 'ì…ê¸ˆí™•ì¸',
                    'ì²˜ë¦¬ì¤‘': currentLang === 'en' ? 'Processing' : 'ì²˜ë¦¬ì¤‘',
                    'ì™„ë£Œ': currentLang === 'en' ? 'Completed' : 'ì™„ë£Œ',
                    'ì·¨ì†Œ': currentLang === 'en' ? 'Cancelled' : 'ì·¨ì†Œ'
                }[order.status] || order.status;
                
                const stepProgress = Math.min(100, (order.step || 1) * 25);
                
                // ì¦ëª…ì„œ ì—¬ë¶€ í™•ì¸
                const hasProof = order.proof && order.proof.data;
                const proofText = currentLang === 'en' ? 'View' : 'ë³´ê¸°';
                const proofButton = hasProof ? 
                    `<button class="action-button action-view" onclick="event.stopPropagation(); viewProof('${order.id}')">${proofText}</button>` :
                    currentLang === 'en' ? 'None' : 'ì—†ìŒ';
                
                // ì§€ê°‘ ì •ë³´
                const walletInfo = order.wallet ? 
                    `${order.wallet.name} (${order.wallet.network})` : 
                    currentLang === 'en' ? 'Not specified' : 'ì§€ì •ë˜ì§€ ì•ŠìŒ';
                
                // ë‹¨ê³„ í…ìŠ¤íŠ¸
                const stepText = getStepText(order.step || 1);
                
                // ì•¡ì…˜ ë²„íŠ¼ í…ìŠ¤íŠ¸
                const confirmText = currentLang === 'en' ? 'Confirm Deposit' : 'ì…ê¸ˆ í™•ì¸';
                const cancelText = currentLang === 'en' ? 'Cancel' : 'ì·¨ì†Œ';
                const processText = currentLang === 'en' ? 'Start Process' : 'ì²˜ë¦¬ ì‹œì‘';
                const completeText = currentLang === 'en' ? 'Complete' : 'ì™„ë£Œ';
                const resetText = currentLang === 'en' ? 'Reset' : 'ì¬ì„¤ì •';
                
                html += `
                    <tr onclick="showOrderDetail('${order.id}')" style="cursor: pointer;">
                        <td>
                            <div class="order-id">${order.id}</div>
                            <div class="order-time">${time}</div>
                        </td>
                        <td>
                            <div class="amount-display">${order.amount.toLocaleString()} THB</div>
                        </td>
                        <td>
                            <div>${walletInfo}</div>
                        </td>
                        <td>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </td>
                        <td>
                            <div>${stepText}</div>
                            <div class="progress-indicator">
                                <div class="progress-bar" style="width: ${stepProgress}%"></div>
                            </div>
                        </td>
                        <td>
                            ${proofButton}
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${order.status === 'ì…ê¸ˆëŒ€ê¸°' ? `
                                    <button class="action-button action-confirm" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì…ê¸ˆí™•ì¸')">${confirmText}</button>
                                    <button class="action-button action-cancel" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                                ` : ''}
                                ${order.status === 'ì…ê¸ˆí™•ì¸' ? `
                                    <button class="action-button action-process" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì²˜ë¦¬ì¤‘')">${processText}</button>
                                    <button class="action-button action-cancel" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                                ` : ''}
                                ${order.status === 'ì²˜ë¦¬ì¤‘' ? `
                                    <button class="action-button action-complete" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì™„ë£Œ')">${completeText}</button>
                                ` : ''}
                                ${['ì™„ë£Œ', 'ì·¨ì†Œ'].includes(order.status) ? `
                                    <button class="action-button action-reset" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì…ê¸ˆëŒ€ê¸°')">${resetText}</button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            ordersTableBody.innerHTML = html;
        }

        // ë‹¨ê³„ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStepText(step) {
            if (currentLang === 'en') {
                switch(step) {
                    case 1: return 'Waiting USDT Transfer';
                    case 2: return 'Verifying Deposit';
                    case 3: return 'Processing THB';
                    case 4: return 'Completed';
                    default: return 'Waiting';
                }
            } else {
                switch(step) {
                    case 1: return 'USDT ì „ì†¡ ëŒ€ê¸°';
                    case 2: return 'ì…ê¸ˆ í™•ì¸ ì¤‘';
                    case 3: return 'THB ì²˜ë¦¬ ì¤‘';
                    case 4: return 'ì™„ë£Œ';
                    default: return 'ëŒ€ê¸°ì¤‘';
                }
            }
        }

        // ==================== ì§€ê°‘ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ====================
        function updateWallets() {
            const statusFilter = document.getElementById('walletStatusFilter').value;
            const networkFilter = document.getElementById('walletNetworkFilter').value;
            
            let filteredWallets = [...allWallets];
            
            // ìƒíƒœ í•„í„°ë§
            if (statusFilter !== 'all') {
                filteredWallets = filteredWallets.filter(w => 
                    statusFilter === 'active' ? w.isActive : !w.isActive
                );
            }
            
            // ë„¤íŠ¸ì›Œí¬ í•„í„°ë§
            if (networkFilter !== 'all') {
                filteredWallets = filteredWallets.filter(w => w.network === networkFilter);
            }
            
            // ìƒì„±ì¼ ê¸°ì¤€ ì •ë ¬
            filteredWallets.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            const walletsTableBody = document.getElementById('walletsTableBody');
            
            if (filteredWallets.length === 0) {
                const trans = translations[currentLang];
                walletsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-wallets">${trans.noWalletsText}</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredWallets.forEach(wallet => {
                const networkClass = `network-${wallet.network.toLowerCase()}`;
                const createdDate = new Date(wallet.createdAt).toLocaleDateString('ko-KR');
                
                // ìƒíƒœ í‘œì‹œ
                const statusText = wallet.isActive ? 
                    (currentLang === 'en' ? 'Active' : 'í™œì„±') : 
                    (currentLang === 'en' ? 'Inactive' : 'ë¹„í™œì„±');
                const statusClass = wallet.isActive ? 'wallet-active' : 'wallet-inactive';
                
                // ê¸°ë³¸ ì§€ê°‘ ë°°ì§€
                const defaultBadgeText = currentLang === 'en' ? 'Default' : 'ê¸°ë³¸';
                const defaultBadge = wallet.isDefault ? `<span class="default-wallet-badge">${defaultBadgeText}</span>` : '';
                
                // QR ì½”ë“œ í‘œì‹œ
                let qrDisplay = '';
if (wallet.qrCode && 
    wallet.qrCode !== 'null' && 
    wallet.qrCode !== '' && 
    wallet.qrCode !== null &&
    wallet.qrCode.startsWith('data:image/')) {
    
    console.log('QR ì½”ë“œ í‘œì‹œ:', wallet.id, 'ê¸¸ì´:', wallet.qrCode.length);
    
    qrDisplay = `
        <div class="qr-code-small">
            <img src="${wallet.qrCode}" 
                 alt="QR Code" 
                 style="max-width: 80px; max-height: 80px;"
                 onerror="this.style.display='none';this.parentElement.innerHTML='<div style=\'color:#999;font-size:12px;\'>ì´ë¯¸ì§€ ì˜¤ë¥˜</div>'">
        </div>
    `;
} else {
    console.log('QR ì½”ë“œ ì—†ìŒ:', wallet.id);
    qrDisplay = '<div style="text-align: center; color: #999; font-size: 12px;">ì—†ìŒ</div>';
}
                
                // ì£¼ì†Œ ë‹¨ì¶•
                const shortAddress = wallet.address.length > 20 ? 
                    wallet.address.substring(0, 10) + '...' + wallet.address.substring(wallet.address.length - 10) : 
                    wallet.address;
                
                // ì•¡ì…˜ ë²„íŠ¼ í…ìŠ¤íŠ¸
                const editText = currentLang === 'en' ? 'Edit' : 'ìˆ˜ì •';
                const deleteText = currentLang === 'en' ? 'Delete' : 'ì‚­ì œ';
                const deactivateText = currentLang === 'en' ? 'Deactivate' : 'ë¹„í™œì„±í™”';
                const activateText = currentLang === 'en' ? 'Activate' : 'í™œì„±í™”';
                const setDefaultText = currentLang === 'en' ? 'Set Default' : 'ê¸°ë³¸ ì„¤ì •';
                
                html += `
                    <tr>
                        <td>
                            <div style="font-weight: bold; color: #2c3e50;">
                                ${wallet.name} ${defaultBadge}
                            </div>
                            ${wallet.memo ? `<div style="font-size: 12px; color: #718096; margin-top: 5px;">${wallet.memo}</div>` : ''}
                        </td>
                        <td>
                            <span class="network-badge ${networkClass}">${wallet.network}</span>
                        </td>
                        <td>
                            <div style="font-size: 12px; color: #2c3e50;">${shortAddress}</div>
                            <div class="wallet-address" title="${wallet.address}">
                                ${wallet.address}
                            </div>
                        </td>
                        <td>${qrDisplay}</td>
                        <td>
                            <span class="wallet-status ${statusClass}">
                                ${wallet.isActive ? '<span class="active-wallet-indicator"></span>' : ''}
                                ${statusText}
                            </span>
                        </td>
                        <td>${createdDate}</td>
                        <td>
                            <div class="wallet-actions">
                                <button class="action-button action-edit" onclick="editWallet('${wallet.id}')">${editText}</button>
                                ${!wallet.isDefault ? `
                                    <button class="action-button action-delete" onclick="deleteWallet('${wallet.id}')">${deleteText}</button>
                                ` : ''}
                                ${wallet.isActive ? 
                                    `<button class="action-button action-deactivate" onclick="toggleWalletStatus('${wallet.id}', false)">${deactivateText}</button>` :
                                    `<button class="action-button action-activate" onclick="toggleWalletStatus('${wallet.id}', true)">${activateText}</button>`
                                }
                                ${!wallet.isDefault ? 
                                    `<button class="action-button action-setdefault" onclick="setDefaultWallet('${wallet.id}')">${setDefaultText}</button>` : 
                                    ''
                                }
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            walletsTableBody.innerHTML = html;
        }

        // ==================== ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ====================
        function updateOrderStatus(orderId, newStatus) {
            // ìƒíƒœ í…ìŠ¤íŠ¸ ë²ˆì—­
            const statusText = {
                'ì…ê¸ˆëŒ€ê¸°': currentLang === 'en' ? 'Waiting Deposit' : 'ì…ê¸ˆëŒ€ê¸°',
                'ì…ê¸ˆí™•ì¸': currentLang === 'en' ? 'Deposit Confirmed' : 'ì…ê¸ˆí™•ì¸',
                'ì²˜ë¦¬ì¤‘': currentLang === 'en' ? 'Processing' : 'ì²˜ë¦¬ì¤‘',
                'ì™„ë£Œ': currentLang === 'en' ? 'Completed' : 'ì™„ë£Œ',
                'ì·¨ì†Œ': currentLang === 'en' ? 'Cancelled' : 'ì·¨ì†Œ'
            }[newStatus] || newStatus;
            
            const confirmMessage = currentLang === 'en' ?
                `Change order ${orderId} status to "${statusText}"?` :
                `ì£¼ë¬¸ ${orderId}ì˜ ìƒíƒœë¥¼ "${statusText}"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // ì£¼ë¬¸ ì°¾ê¸°
            let orderIndex = allOrders.findIndex(o => o.id === orderId);
            
            if (orderIndex === -1) {
                alert(currentLang === 'en' ? 'Order not found' : 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            const newStep = getStepFromStatus(newStatus);
            allOrders[orderIndex] = {
                ...allOrders[orderIndex],
                status: newStatus,
                step: newStep,
                updated: new Date().toISOString()
            };
            
            // ì €ì¥
            dataManager.saveOrders(allOrders);
            
            // ì‚¬ìš©ì í˜ì´ì§€ì— ì•Œë¦¼
            dataManager.notifyUserPage(orderId, newStatus);
            
            // ê´€ë¦¬ì í˜ì´ì§€ ì—…ë°ì´íŠ¸
            updateStats();
            updateOrders();
            
            const successMessage = currentLang === 'en' ?
                `Order status changed to "${statusText}"` :
                `ì£¼ë¬¸ ìƒíƒœê°€ "${statusText}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`;
            alert(successMessage);
            
            // ìƒì„¸ ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
            if (selectedOrder && selectedOrder.id === orderId) {
                selectedOrder = allOrders[orderIndex];
                showOrderDetail(orderId);
            }
        }

        function getStepFromStatus(status) {
            switch(status) {
                case 'ì…ê¸ˆëŒ€ê¸°': return 1;
                case 'ì…ê¸ˆí™•ì¸': return 2;
                case 'ì²˜ë¦¬ì¤‘': return 3;
                case 'ì™„ë£Œ': return 4;
                case 'ì·¨ì†Œ': return 1;
                default: return 1;
            }
        }

        // ==================== ì¦ëª…ì„œ ë³´ê¸° ====================
        function viewProof(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order || !order.proof || !order.proof.data) {
                alert(currentLang === 'en' ? 'No proof document' : 'ì¦ëª…ì„œê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const proofWindow = window.open('', '_blank');
            const title = currentLang === 'en' ? 'Payment Proof' : 'ê²°ì œ ì¦ëª…ì„œ';
            
            proofWindow.document.write(`
                <html>
                <head>
                    <title>${title} - ${order.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .info { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <p>${currentLang === 'en' ? 'Order ID:' : 'ì£¼ë¬¸ ID:'} ${order.id}</p>
                    </div>
                    <div class="info">
                        <p><strong>${currentLang === 'en' ? 'Amount:' : 'ê¸ˆì•¡:'}</strong> ${order.amount.toLocaleString()} THB</p>
                        <p><strong>USDT:</strong> ${order.usdt.toFixed(4)} USDT</p>
                        <p><strong>${currentLang === 'en' ? 'Upload Time:' : 'ì—…ë¡œë“œ ì‹œê°„:'}</strong> ${new Date(order.time).toLocaleString()}</p>
                    </div>
                    ${order.proof.type.startsWith('image/') ? 
                        `<img src="${order.proof.data}" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px;">` : 
                        `<p>${currentLang === 'en' ? 'File Name:' : 'íŒŒì¼ëª…:'} ${order.proof.name}</p><p>${currentLang === 'en' ? 'File Size:' : 'íŒŒì¼ í¬ê¸°:'} ${(order.proof.size / 1024).toFixed(1)}KB</p>`
                    }
                </body>
                </html>
            `);
        }

        // ==================== íƒ­ ì „í™˜ ====================
        function switchTab(e) {
            const tabId = e.target.dataset.tab;
            currentTab = tabId;
            
            // íƒ­ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // íƒ­ ë‚´ìš© ì—…ë°ì´íŠ¸
            document.getElementById('ordersTab').classList.remove('active');
            document.getElementById('walletsTab').classList.remove('active');
            
            if (tabId === 'orders') {
                document.getElementById('ordersTab').classList.add('active');
            } else if (tabId === 'wallets') {
                document.getElementById('walletsTab').classList.add('active');
            }
        }

        // ==================== ì£¼ë¬¸ ìƒì„¸ ì •ë³´ ====================
        function showOrderDetail(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) {
                alert(currentLang === 'en' ? 'Order not found' : 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            selectedOrder = order;
            
            const createdTime = new Date(order.time).toLocaleString('ko-KR');
            const updatedTime = order.updated ? new Date(order.updated).toLocaleString('ko-KR') : 
                (currentLang === 'en' ? 'None' : 'ì—†ìŒ');
            
            // ì¦ëª…ì„œ ì •ë³´
            let proofInfo = currentLang === 'en' ? 'None' : 'ì—†ìŒ';
            if (order.proof && order.proof.data) {
                proofInfo = order.proof.type.startsWith('image/') ? 
                    (currentLang === 'en' ? 'Image file' : 'ì´ë¯¸ì§€ íŒŒì¼') : 
                    order.proof.name;
            }
            
            // ìƒíƒœ í…ìŠ¤íŠ¸
            const statusText = {
                'ì…ê¸ˆëŒ€ê¸°': currentLang === 'en' ? 'Waiting Deposit' : 'ì…ê¸ˆëŒ€ê¸°',
                'ì…ê¸ˆí™•ì¸': currentLang === 'en' ? 'Deposit Confirmed' : 'ì…ê¸ˆí™•ì¸',
                'ì²˜ë¦¬ì¤‘': currentLang === 'en' ? 'Processing' : 'ì²˜ë¦¬ì¤‘',
                'ì™„ë£Œ': currentLang === 'en' ? 'Completed' : 'ì™„ë£Œ',
                'ì·¨ì†Œ': currentLang === 'en' ? 'Cancelled' : 'ì·¨ì†Œ'
            }[order.status] || order.status;
            
            // ë ˆì´ë¸” í…ìŠ¤íŠ¸
            const orderIdLabel = currentLang === 'en' ? 'Order ID:' : 'ì£¼ë¬¸ ID:';
            const createdLabel = currentLang === 'en' ? 'Created Time:' : 'ìƒì„± ì‹œê°„:';
            const updatedLabel = currentLang === 'en' ? 'Last Updated:' : 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:';
            const amountLabel = currentLang === 'en' ? 'Payment Amount:' : 'ê²°ì œ ê¸ˆì•¡:';
            const usdtLabel = currentLang === 'en' ? 'USDT Amount:' : 'USDT ê¸ˆì•¡:';
            const statusLabel = currentLang === 'en' ? 'Current Status:' : 'í˜„ì¬ ìƒíƒœ:';
            const stepLabel = currentLang === 'en' ? 'Current Step:' : 'í˜„ì¬ ë‹¨ê³„:';
            const walletLabel = currentLang === 'en' ? 'Deposit Wallet:' : 'ì…ê¸ˆ ì§€ê°‘:';
            const proofLabel = currentLang === 'en' ? 'Payment Proof:' : 'ê²°ì œ ì¦ëª…ì„œ:';
            const viewProofText = currentLang === 'en' ? 'View' : 'ë³´ê¸°';
            
            // ìƒì„¸ ë‚´ìš© ìƒì„±
            let detailHtml = `
                <div class="form-group">
                    <label class="form-label">${orderIdLabel}</label>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">${order.id}</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">${createdLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">${createdTime}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${updatedLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">${updatedTime}</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">${amountLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px; font-weight: bold;">
                            ${order.amount.toLocaleString()} THB
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${usdtLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            ${order.usdt.toFixed(4)} USDT
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">${statusLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            <span class="status-badge ${order.status === 'ì…ê¸ˆëŒ€ê¸°' ? 'status-waiting' : 
                                order.status === 'ì…ê¸ˆí™•ì¸' ? 'status-confirmed' : 
                                order.status === 'ì²˜ë¦¬ì¤‘' ? 'status-processing' : 
                                order.status === 'ì™„ë£Œ' ? 'status-completed' : 'status-cancelled'}">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${stepLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            ${getStepText(order.step || 1)}
                        </div>
                    </div>
                </div>
                
                ${order.wallet ? `
                <div class="form-group">
                    <label class="form-label">${walletLabel}</label>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        ${order.wallet.name} (${order.wallet.network})<br>
                        <small style="color: #718096;">${order.wallet.address}</small>
                    </div>
                </div>
                ` : ''}
                
                <div class="form-group">
                    <label class="form-label">${proofLabel}</label>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        ${proofInfo}
                        ${order.proof && order.proof.data ? 
                            `<button class="action-button action-view" style="margin-top: 5px;" onclick="viewProof('${order.id}')">${viewProofText}</button>` : ''
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('orderDetailContent').innerHTML = detailHtml;
            
            // ì•¡ì…˜ ë²„íŠ¼ ìƒì„±
            let actionsHtml = '';
            
            if (order.status === 'ì…ê¸ˆëŒ€ê¸°') {
                const confirmText = currentLang === 'en' ? 'Confirm Deposit' : 'ì…ê¸ˆ í™•ì¸';
                const cancelText = currentLang === 'en' ? 'Cancel Payment' : 'ê²°ì œ ì·¨ì†Œ';
                actionsHtml = `
                    <button class="modal-button primary" onclick="updateOrderStatus('${order.id}', 'ì…ê¸ˆí™•ì¸')">${confirmText}</button>
                    <button class="modal-button secondary" onclick="updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                `;
            } else if (order.status === 'ì…ê¸ˆí™•ì¸') {
                const processText = currentLang === 'en' ? 'Start Process' : 'ì²˜ë¦¬ ì‹œì‘';
                const cancelText = currentLang === 'en' ? 'Cancel Process' : 'ì²˜ë¦¬ ì·¨ì†Œ';
                actionsHtml = `
                    <button class="modal-button primary" onclick="updateOrderStatus('${order.id}', 'ì²˜ë¦¬ì¤‘')">${processText}</button>
                    <button class="modal-button secondary" onclick="updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                `;
            } else if (order.status === 'ì²˜ë¦¬ì¤‘') {
                const completeText = currentLang === 'en' ? 'Complete Process' : 'ì²˜ë¦¬ ì™„ë£Œ';
                actionsHtml = `
                    <button class="modal-button success" onclick="updateOrderStatus('${order.id}', 'ì™„ë£Œ')">${completeText}</button>
                `;
            } else {
                const resetText = currentLang === 'en' ? 'Reset Status' : 'ìƒíƒœ ì¬ì„¤ì •';
                actionsHtml = `
                    <button class="modal-button primary" onclick="updateOrderStatus('${order.id}', 'ì…ê¸ˆëŒ€ê¸°')">${resetText}</button>
                `;
            }
            
            document.getElementById('orderDetailActions').innerHTML = actionsHtml;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('orderDetailModal').classList.remove('hidden');
        }

        function closeOrderDetail() {
            document.getElementById('orderDetailModal').classList.add('hidden');
            selectedOrder = null;
        }

        // ==================== ì§€ê°‘ ê´€ë¦¬ ====================
        function openAddWalletModal() {
            const trans = translations[currentLang];
            document.getElementById('walletModalTitle').textContent = trans.walletModalTitle;
            document.getElementById('walletForm').reset();
            document.getElementById('walletId').value = '';
            qrCodeFile = null;
            
            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('walletStatus').value = 'active';
            
            document.getElementById('walletModal').classList.remove('hidden');
        }

        function editWallet(walletId) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            selectedWallet = wallet;
            
            const trans = translations[currentLang];
            document.getElementById('walletModalTitle').textContent = currentLang === 'en' ? 'âœï¸ Edit Wallet' : 'âœï¸ ì§€ê°‘ ìˆ˜ì •';
            document.getElementById('walletId').value = wallet.id;
            document.getElementById('walletName').value = wallet.name;
            document.getElementById('walletNetwork').value = wallet.network;
            document.getElementById('walletStatus').value = wallet.isActive ? 'active' : 'inactive';
            document.getElementById('walletAddress').value = wallet.address;
            document.getElementById('walletMemo').value = wallet.memo || '';
            qrCodeFile = null;
            
            document.getElementById('walletModal').classList.remove('hidden');
        }

        function handleQRCodeUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = 2 * 1024 * 1024;
            if (file.size > maxSize) {
                alert(currentLang === 'en' ? 
                    'File size must be less than 2MB' : 
                    'íŒŒì¼ í¬ê¸°ëŠ” 2MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                alert(currentLang === 'en' ? 
                    'Only image files can be uploaded' : 
                    'ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                event.target.value = '';
                return;
            }
            
            qrCodeFile = file;
        }

        function saveWallet() {
            console.log('ì§€ê°‘ ì €ì¥ ì‹œì‘');
            
            // í¼ ê²€ì¦
            if (!document.getElementById('walletName').value.trim()) {
                alert(currentLang === 'en' ? 
                    'Please enter wallet name' : 
                    'ì§€ê°‘ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            if (!document.getElementById('walletNetwork').value) {
                alert(currentLang === 'en' ? 
                    'Please select network' : 
                    'ë„¤íŠ¸ì›Œí¬ë¥¼ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            if (!document.getElementById('walletAddress').value.trim()) {
                alert(currentLang === 'en' ? 
                    'Please enter wallet address' : 
                    'ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            const walletId = document.getElementById('walletId').value;
            const isEdit = !!walletId;
            
            // QR ì½”ë“œ íŒŒì¼ ì²˜ë¦¬
            // QR ì½”ë“œ íŒŒì¼ ì²˜ë¦¬ ë¶€ë¶„
if (qrCodeFile) {
    const reader = new FileReader();
    reader.onload = function(e) {
        // âœ… base64 ë°ì´í„°ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
        const qrCodeData = e.target.result;
        console.log('QR ì½”ë“œ ë°ì´í„° ê¸¸ì´:', qrCodeData.length);
        
        if (!qrCodeData.startsWith('data:image/')) {
            console.error('ì˜ëª»ëœ QR ì½”ë“œ í˜•ì‹');
            alert('QR ì½”ë“œ ì´ë¯¸ì§€ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            return;
        }
        
        saveWalletData(qrCodeData);
    };
    
    reader.onerror = function(e) {
        console.error('QR ì½”ë“œ ì½ê¸° ì˜¤ë¥˜:', e);
        alert('QR ì½”ë“œ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    };
    
    reader.readAsDataURL(qrCodeFile);
} else {
    // ê¸°ì¡´ QR ì½”ë“œ ìœ ì§€
    saveWalletData(isEdit ? (selectedWallet?.qrCode || null) : null);
}
            
            function saveWalletData(qrCodeData) {
                const walletData = {
                    id: isEdit ? walletId : 'wallet_' + Date.now(),
                    name: document.getElementById('walletName').value.trim(),
                    network: document.getElementById('walletNetwork').value,
                    address: document.getElementById('walletAddress').value.trim(),
                    qrCode: qrCodeData,
                    isActive: document.getElementById('walletStatus').value === 'active',
                    isDefault: isEdit ? (selectedWallet?.isDefault || false) : false,
                    memo: document.getElementById('walletMemo').value.trim(),
                    createdAt: isEdit ? (selectedWallet?.createdAt || new Date().toISOString()) : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                console.log('ì§€ê°‘ ë°ì´í„°:', walletData);
                
                // ì§€ê°‘ ëª©ë¡ ì—…ë°ì´íŠ¸
                let updatedWallets = [...allWallets];
                
                if (isEdit) {
                    const index = updatedWallets.findIndex(w => w.id === walletId);
                    if (index > -1) {
                        updatedWallets[index] = walletData;
                    }
                } else {
                    updatedWallets.push(walletData);
                }
                
                // í™œì„±í™”ëœ ì§€ê°‘ì´ ì—¬ëŸ¬ ê°œì¸ì§€ í™•ì¸
                const activeWallets = updatedWallets.filter(w => w.isActive);
                if (activeWallets.length === 0 && updatedWallets.length > 0) {
                    updatedWallets[0].isActive = true;
                }
                
                // ì €ì¥
                dataManager.saveWallets(updatedWallets);
                
                // ì‚¬ìš©ì í˜ì´ì§€ì— ì•Œë¦¼
                dataManager.notifyUserPageWallets(updatedWallets);
                
                // í˜ì´ì§€ ì—…ë°ì´íŠ¸
                allWallets = updatedWallets;
                updateStats();
                updateWallets();
                
                // ëª¨ë‹¬ ë‹«ê¸°
                closeWalletModal();
                
                const successMessage = currentLang === 'en' ?
                    `Wallet ${isEdit ? 'updated' : 'added'} successfully` :
                    `ì§€ê°‘ì´ ì„±ê³µì ìœ¼ë¡œ ${isEdit ? 'ìˆ˜ì •' : 'ì¶”ê°€'}ë˜ì—ˆìŠµë‹ˆë‹¤`;
                alert(successMessage);
            }
        }

        function toggleWalletStatus(walletId, activate) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            if (wallet.isDefault && !activate) {
                alert(currentLang === 'en' ?
                    'Default wallet cannot be deactivated' :
                    'ê¸°ë³¸ ì§€ê°‘ì€ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const action = activate ? 
                (currentLang === 'en' ? 'Activate' : 'í™œì„±í™”') : 
                (currentLang === 'en' ? 'Deactivate' : 'ë¹„í™œì„±í™”');
            const confirmMessage = currentLang === 'en' ?
                `${action} this wallet?` :
                `ì´ ì§€ê°‘ì„ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // ì§€ê°‘ ìƒíƒœ ì—…ë°ì´íŠ¸
            const updatedWallets = allWallets.map(w => {
                if (w.id === walletId) {
                    return { ...w, isActive: activate };
                }
                return w;
            });
            
            // ì €ì¥
            dataManager.saveWallets(updatedWallets);
            
            // ì‚¬ìš©ì í˜ì´ì§€ì— ì•Œë¦¼
            dataManager.notifyUserPageWallets(updatedWallets);
            
            // í˜ì´ì§€ ì—…ë°ì´íŠ¸
            allWallets = updatedWallets;
            updateStats();
            updateWallets();
            
            const successMessage = currentLang === 'en' ?
                `Wallet ${action.toLowerCase()}d` :
                `ì§€ê°‘ì´ ${action}ë˜ì—ˆìŠµë‹ˆë‹¤`;
            alert(successMessage);
        }

        function setDefaultWallet(walletId) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            const confirmMessage = currentLang === 'en' ?
                `Set this wallet as default?\n\nDefault wallet cannot be deleted and is always active.` :
                `ì´ ì§€ê°‘ì„ ê¸°ë³¸ ì§€ê°‘ìœ¼ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ë³¸ ì§€ê°‘ì€ ì‚­ì œí•  ìˆ˜ ì—†ìœ¼ë©° í•­ìƒ í™œì„± ìƒíƒœì…ë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // ëª¨ë“  ì§€ê°‘ì˜ ê¸°ë³¸ ì„¤ì • í•´ì œ í›„ ì„ íƒí•œ ì§€ê°‘ë§Œ ê¸°ë³¸ ì„¤ì •
            const updatedWallets = allWallets.map(w => {
                if (w.id === walletId) {
                    return { ...w, isDefault: true, isActive: true };
                } else {
                    return { ...w, isDefault: false };
                }
            });
            
            // ì €ì¥
            dataManager.saveWallets(updatedWallets);
            
            // ì‚¬ìš©ì í˜ì´ì§€ì— ì•Œë¦¼
            dataManager.notifyUserPageWallets(updatedWallets);
            
            // í˜ì´ì§€ ì—…ë°ì´íŠ¸
            allWallets = updatedWallets;
            updateStats();
            updateWallets();
            
            alert(currentLang === 'en' ? 'Default wallet set' : 'ê¸°ë³¸ ì§€ê°‘ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function deleteWallet(walletId) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            if (wallet.isDefault) {
                alert(currentLang === 'en' ? 
                    'Default wallet cannot be deleted' : 
                    'ê¸°ë³¸ ì§€ê°‘ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ì´ ì§€ê°‘ì„ ì‚¬ìš©í•˜ëŠ” ì£¼ë¬¸ì´ ìˆëŠ”ì§€ í™•ì¸
            const ordersUsingWallet = allOrders.filter(o => 
                o.wallet && o.wallet.id === walletId && o.status !== 'ì™„ë£Œ' && o.status !== 'ì·¨ì†Œ'
            );
            
            if (ordersUsingWallet.length > 0) {
                alert(currentLang === 'en' ?
                    `There are ${ordersUsingWallet.length} active orders using this wallet.\nPlease change their status first.` :
                    `ì´ ì§€ê°‘ì„ ì‚¬ìš©í•˜ëŠ” ${ordersUsingWallet.length}ê°œì˜ í™œì„± ì£¼ë¬¸ì´ ìˆìŠµë‹ˆë‹¤.\në¨¼ì € ìƒíƒœë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            const confirmMessage = currentLang === 'en' ?
                `Delete this wallet?\n\nCannot be recovered after deletion.` :
                `ì´ ì§€ê°‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // ì§€ê°‘ ì‚­ì œ
            const updatedWallets = allWallets.filter(w => w.id !== walletId);
            
            // í™œì„±í™”ëœ ì§€ê°‘ì´ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì§€ê°‘ í™œì„±í™”
            const activeWallets = updatedWallets.filter(w => w.isActive);
            if (activeWallets.length === 0 && updatedWallets.length > 0) {
                updatedWallets[0].isActive = true;
            }
            
            // ì €ì¥
            dataManager.saveWallets(updatedWallets);
            
            // ì‚¬ìš©ì í˜ì´ì§€ì— ì•Œë¦¼
            dataManager.notifyUserPageWallets(updatedWallets);
            
            // í˜ì´ì§€ ì—…ë°ì´íŠ¸
            allWallets = updatedWallets;
            updateStats();
            updateWallets();
            
            alert(currentLang === 'en' ? 'Wallet deleted' : 'ì§€ê°‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function closeWalletModal() {
            document.getElementById('walletModal').classList.add('hidden');
            selectedWallet = null;
            qrCodeFile = null;
        }

        // ==================== ë°ì´í„° ë™ê¸°í™” ====================
        function startSyncCheck() {
    if (syncCheckInterval) clearInterval(syncCheckInterval);
    
    console.log('ê´€ë¦¬ì: ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œì‘ (1ì´ˆ ê°„ê²©)');
    
    // âœ… ì¦‰ì‹œ í•œë²ˆ ì‹¤í–‰
    checkDataSync();
    
    syncCheckInterval = setInterval(() => {
        checkDataSync();
    }, 1000); // 1ì´ˆë§ˆë‹¤ ì²´í¬
}

        function checkDataSync() {
    // í•­ìƒ ë°ì´í„° ì²´í¬ (ê°•ì œ ì—…ë°ì´íŠ¸)
    const syncKey = localStorage.getItem('payment_sync_flag');
    const lastCheck = localStorage.getItem('admin_last_check') || '0';
    
    console.log('ê´€ë¦¬ì: ë™ê¸°í™” ì²´í¬', {
        syncKey: syncKey,
        lastCheck: lastCheck,
        needsUpdate: syncKey !== lastCheck
    });
    
    if (syncKey !== lastCheck) {
        console.log('ğŸ”” ê´€ë¦¬ì: ë°ì´í„° ë³€ê²½ ê°ì§€!');
        
        // ë°ì´í„° ê°•ì œ ë¡œë“œ
        allOrders = dataManager.getOrders();
        allWallets = dataManager.getWallets();
        
        // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
        updateStats();
        updateOrders();
        updateWallets();
        
        // ì²´í¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        localStorage.setItem('admin_last_check', syncKey || '0');
        
        // ë³€ê²½ ì•Œë¦¼
        if (allOrders.length > 0) {
            showNotification(`ìƒˆë¡œìš´ ì£¼ë¬¸ ${allOrders.length}ê°œ`);
        }
    }
}

// âœ… ë³€ê²½ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜ ì¶”ê°€
function showNotification(message) {
    console.log('ì•Œë¦¼:', message);
    
    // ê°„ë‹¨í•œ ì•Œë¦¼ í‘œì‹œ
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 60px;
        right: 20px;
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        z-index: 9999;
        animation: slideIn 0.3s ease;
    `;
    notification.textContent = message;
    notification.id = 'temp-notification';
    
    document.body.appendChild(notification);
    
    // 3ì´ˆ í›„ ì œê±°
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

        // ==================== ë‚´ë³´ë‚´ê¸° ====================
        function exportOrdersToExcel() {
            try {
                let csv = '';
                
                if (currentLang === 'en') {
                    csv = 'Order ID,Created Time,Amount(THB),USDT Amount,Status,Step,Wallet,Network,Proof,Updated Time\n';
                } else {
                    csv = 'ì£¼ë¬¸ ID,ìƒì„± ì‹œê°„,ê¸ˆì•¡(THB),USDT ê¸ˆì•¡,ìƒíƒœ,ë‹¨ê³„,ì§€ê°‘,ë„¤íŠ¸ì›Œí¬,ì¦ëª…ì„œ,ì—…ë°ì´íŠ¸ ì‹œê°„\n';
                }
                
                allOrders.forEach(order => {
                    const time = new Date(order.time).toLocaleString('ko-KR');
                    const updated = order.updated ? new Date(order.updated).toLocaleString('ko-KR') : '';
                    const stepText = getStepText(order.step || 1);
                    const walletInfo = order.wallet ? `${order.wallet.name} (${order.wallet.network})` : 
                        currentLang === 'en' ? 'Not specified' : 'ì§€ì •ë˜ì§€ ì•ŠìŒ';
                    const hasProof = order.proof && order.proof.data ? 
                        (currentLang === 'en' ? 'Yes' : 'ì˜ˆ') : 
                        (currentLang === 'en' ? 'No' : 'ì•„ë‹ˆì˜¤');
                    
                    csv += `"${order.id}","${time}","${order.amount}","${order.usdt || 0}","${order.status}","${stepText}","${walletInfo}","${order.wallet?.network || ''}","${hasProof}","${updated}"\n`;
                });
                
                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                const fileName = `orders_${new Date().toISOString().split('T')[0]}.csv`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                const message = currentLang === 'en' ?
                    `File saved as: ${fileName}\n\nIt will be saved to your default download folder.` :
                    `íŒŒì¼ ì €ì¥ë¨: ${fileName}\n\nê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.`;
                showSaveStatus(message);
                
            } catch (error) {
                console.error('Export failed:', error);
                alert(currentLang === 'en' ? 'Export failed' : 'ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨');
            }
        }

        function showSaveStatus(message) {
            const saveStatus = document.getElementById('saveStatus');
            saveStatus.textContent = message;
            saveStatus.classList.add('show');
            
            setTimeout(() => {
                saveStatus.classList.remove('show');
            }, 3000);
        }

        // ==================== í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ====================
        window.createTestOrder = function() {
            const activeWallet = allWallets.find(w => w.isActive) || allWallets[0];
            const testOrder = {
                id: 'ORD-' + Date.now().toString().slice(-6) + Math.random().toString(36).substr(2, 3).toUpperCase(),
                amount: Math.floor(Math.random() * 10000) + 1000,
                usdt: Math.random() * 100 + 10,
                status: 'ì…ê¸ˆëŒ€ê¸°',
                step: 1,
                time: new Date().toISOString(),
                wallet: activeWallet ? {
                    id: activeWallet.id,
                    name: activeWallet.name,
                    address: activeWallet.address,
                    network: activeWallet.network
                } : null,
                proof: {
                    name: 'test.png',
                    type: 'image/png',
                    size: 1024,
                    data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='
                }
            };
            
            allOrders.unshift(testOrder);
            dataManager.saveOrders(allOrders);
            loadAllData();
            
            alert(currentLang === 'en' ?
                `Test order ${testOrder.id} created` :
                `í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ${testOrder.id} ìƒì„±ë¨`);
        };

        window.clearAllOrders = function() {
            const confirmMessage = currentLang === 'en' ?
                'Delete all order records? This cannot be undone.' :
                'ëª¨ë“  ì£¼ë¬¸ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            
            if (confirm(confirmMessage)) {
                allOrders = [];
                dataManager.saveOrders([]);
                updateStats();
                updateOrders();
                alert(currentLang === 'en' ? 'All order records deleted' : 'ëª¨ë“  ì£¼ë¬¸ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        };

        window.clearAllWallets = function() {
            const confirmMessage = currentLang === 'en' ?
                'Delete all wallets except default wallet? This cannot be undone.' :
                'ê¸°ë³¸ ì§€ê°‘ì„ ì œì™¸í•œ ëª¨ë“  ì§€ê°‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            
            if (confirm(confirmMessage)) {
                const defaultWallet = allWallets.find(w => w.isDefault);
                const updatedWallets = defaultWallet ? [defaultWallet] : [];
                
                dataManager.saveWallets(updatedWallets);
                allWallets = updatedWallets;
                updateStats();
                updateWallets();
                dataManager.notifyUserPageWallets(updatedWallets);
                
                alert(currentLang === 'en' ?
                    'All wallets deleted (except default wallet)' :
                    'ëª¨ë“  ì§€ê°‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤ (ê¸°ë³¸ ì§€ê°‘ ì œì™¸)');
            }
        };

        // ==================== ì´ˆê¸°í™” ì™„ë£Œ ====================
        console.log('ê´€ë¦¬ì í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
