<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Order & Wallet Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Apple SD Gothic Neo', -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .admin-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .admin-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .admin-title {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .admin-subtitle {
            color: #7f8c8d;
            font-size: 16px;
            text-align: center;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 25px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .lang-switch-btn {
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .lang-switch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .logout-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .lang-icon {
            font-size: 16px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-button {
            flex: 1;
            padding: 18px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab-button:hover {
            background: #f8f9fa;
        }

        .tab-button.active {
            color: #3498db;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 14px;
            color: #27ae60;
        }

        .stat-change.negative {
            color: #e74c3c;
        }

        .orders-section, .wallets-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select, .search-box {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .search-box {
            width: 250px;
        }

        .refresh-button, .add-button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .add-button {
            background: #27ae60;
        }

        .refresh-button:hover {
            background: #2980b9;
        }

        .add-button:hover {
            background: #219653;
        }

        .export-button {
            padding: 10px 20px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .export-button:hover {
            background: #8e44ad;
        }

        .orders-table-container, .wallets-table-container {
            overflow-x: auto;
        }

        .orders-table, .wallets-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .wallets-table {
            min-width: 800px;
        }

        .orders-table th, .wallets-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #dee2e6;
        }

        .orders-table td, .wallets-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .orders-table tr:hover, .wallets-table tr:hover {
            background: #f8f9fa;
        }

        .order-id, .wallet-id {
            font-weight: bold;
            color: #2c3e50;
            font-family: monospace;
        }

        .order-time {
            font-size: 12px;
            color: #7f8c8d;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-align: center;
            min-width: 80px;
        }

        .status-waiting { background: #f39c12; }
        .status-confirmed { background: #3498db; }
        .status-processing { background: #9b59b6; }
        .status-completed { background: #27ae60; }
        .status-cancelled { background: #e74c3c; }

        .wallet-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-align: center;
            min-width: 80px;
        }

        .wallet-active { background: #27ae60; }
        .wallet-inactive { background: #95a5a6; }

        .network-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }

        .network-trc20 { background: #e74c3c; }
        .network-erc20 { background: #3498db; }
        .network-bep20 { background: #2ecc71; }
        .network-solana { background: #9b59b6; }
        .network-polygon { background: #8e44ad; }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .action-view { background: #3498db; color: white; }
        .action-confirm { background: #2ecc71; color: white; }
        .action-process { background: #9b59b6; color: white; }
        .action-complete { background: #27ae60; color: white; }
        .action-cancel { background: #e74c3c; color: white; }
        .action-reset { background: #f39c12; color: white; }
        .action-edit { background: #3498db; color: white; }
        .action-delete { background: #e74c3c; color: white; }
        .action-activate { background: #2ecc71; color: white; }
        .action-deactivate { background: #95a5a6; color: white; }
        .action-setdefault { background: #f39c12; color: white; }

        .no-orders, .no-wallets {
            text-align: center;
            padding: 50px;
            color: #95a5a6;
            font-size: 16px;
        }

        .amount-display {
            font-weight: bold;
            color: #2c3e50;
        }

        .progress-indicator {
            width: 100px;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-bar {
            height: 100%;
            background: #3498db;
            border-radius: 3px;
            transition: width 0.3s;
        }

        .wallet-address {
            font-family: monospace;
            font-size: 12px;
            color: #2c3e50;
            word-break: break-all;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
            margin-top: 5px;
            border: 1px solid #e9ecef;
        }

        .qr-code-small {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #dee2e6;
            margin: 0 auto;
        }

        .qr-code-small img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #95a5a6;
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-button.primary {
            background: #3498db;
            color: white;
        }

        .modal-button.secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .modal-button.success {
            background: #27ae60;
            color: white;
        }

        .modal-button.danger {
            background: #e74c3c;
            color: white;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .hidden {
            display: none;
        }

        .time-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .active-wallet-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .default-wallet-badge {
            display: inline-block;
            padding: 2px 8px;
            background: #f39c12;
            color: white;
            font-size: 10px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .wallet-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .total-row {
            background: #f8f9fa;
            font-weight: bold;
        }

        .save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
        }

        .save-status.show {
            display: block;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(20px); }
        }

        .sync-badge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 1000;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .filter-controls {
                width: 100%;
                flex-wrap: wrap;
            }
            
            .search-box {
                width: 100%;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .language-switcher {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 15px;
                text-align: center;
            }
        }

        /* í…”ë ˆê·¸ë¨ ì„¤ì • ìŠ¤íƒ€ì¼ */
        .telegram-settings {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .telegram-settings h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .telegram-settings h3::before {
            content: "ğŸ¤–";
            font-size: 20px;
        }

        .save-telegram-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            width: 100%;
            transition: all 0.3s;
        }

        .save-telegram-btn:hover {
            background: #219653;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .test-telegram-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            width: 100%;
            transition: all 0.3s;
        }

        .test-telegram-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .telegram-settings small {
            color: #718096;
            display: block;
            margin-top: 10px;
            line-height: 1.5;
        }

        .telegram-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }

        .telegram-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .telegram-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        /* ë‹¤ì¤‘ í…”ë ˆê·¸ë¨ ë´‡ ê´€ë¦¬ */
        .telegram-bots-list {
            margin: 20px 0;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .telegram-bot-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8f9fa;
        }

        .telegram-bot-item:last-child {
            border-bottom: none;
        }

        .telegram-bot-info {
            flex: 1;
        }

        .telegram-bot-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .telegram-bot-details {
            font-size: 12px;
            color: #718096;
        }

        .telegram-bot-actions {
            display: flex;
            gap: 10px;
        }

        .bot-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bot-test-btn {
            background: #3498db;
            color: white;
        }

        .bot-edit-btn {
            background: #f39c12;
            color: white;
        }

        .bot-delete-btn {
            background: #e74c3c;
            color: white;
        }

        .bot-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .add-bot-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .add-bot-btn:hover {
            background: #27ae60;
        }

        /* í…”ë ˆê·¸ë¨ ë´‡ ëª¨ë‹¬ */
        .bot-form-group {
            margin-bottom: 15px;
        }

        .bot-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .bot-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bot-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        /* ë¡œê·¸ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #loginContainer {
            width: 100%;
            max-width: 400px;
            margin: 100px auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-title {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .login-form-group {
            margin-bottom: 20px;
        }
        
        .login-label {
            display: block;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .login-input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .login-help {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #718096;
            border: 1px solid #e2e8f0;
        }
        
        .login-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .login-error {
            margin-top: 15px;
            padding: 10px;
            background: #fed7d7;
            color: #c53030;
            border-radius: 8px;
            display: none;
            font-size: 14px;
            border: 1px solid #fc8181;
        }
    </style>
</head>
<body>
    <!-- ë™ê¸°í™” ë°°ì§€ -->
    <div class="sync-badge" id="syncBadge">
        <div class="sync-dot"></div>
        <span id="syncStatusText">ì‹¤ì‹œê°„ ë™ê¸°í™”</span>
    </div>
    
    <!-- ë¡œê·¸ì¸ í™”ë©´ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
    <div id="loginContainer" class="hidden">
        <div class="login-header">
            <h2 class="login-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <p class="login-subtitle">ì£¼ë¬¸ ë° ì§€ê°‘ ê´€ë¦¬ ì‹œìŠ¤í…œì— ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
        </div>
        
        <form id="loginForm">
            <div class="login-form-group">
                <label class="login-label">ì•„ì´ë””</label>
                <input type="text" 
                       id="loginUsername" 
                       class="login-input" 
                       placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                       required>
            </div>
            
            <div class="login-form-group">
                <label class="login-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" 
                       id="loginPassword" 
                       class="login-input" 
                       placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                       required>
            </div>
            
            <div class="login-help">
                <strong>ê¸°ë³¸ ë¡œê·¸ì¸ ì •ë³´:</strong><br>
                ì•„ì´ë””: <code>admin</code><br>
                ë¹„ë°€ë²ˆí˜¸: <code>1234</code>
            </div>
            
            <button type="submit" class="login-button">ë¡œê·¸ì¸</button>
        </form>
        
        <div id="loginError" class="login-error"></div>
    </div>

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
    <div class="admin-container" id="adminDashboard" style="display: none;">
        <!-- í—¤ë” -->
        <div class="admin-header">
            <div class="language-switcher">
                <button class="lang-switch-btn" id="langSwitchBtn">
                    <span class="lang-icon">ğŸŒ</span>
                    <span id="langSwitchText">English</span>
                </button>
                <button class="lang-switch-btn logout-btn" id="logoutBtn">
                    <span class="lang-icon">ğŸšª</span>
                    <span id="logoutText">ë¡œê·¸ì•„ì›ƒ</span>
                </button>
            </div>
            <h1 class="admin-title" id="adminTitle">ğŸ“Š ì£¼ë¬¸ ë° ì§€ê°‘ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p class="admin-subtitle" id="adminSubtitle">í•œ ê³³ì—ì„œ ì‚¬ìš©ì ì£¼ë¬¸ê³¼ ì§€ê°‘ ì„¤ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- í…”ë ˆê·¸ë¨ ì„¤ì • -->
        <div class="telegram-settings">
            <h3>í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì„¤ì • (ë‹¤ì¤‘ ë´‡ ì§€ì›)</h3>
            
            <!-- í…”ë ˆê·¸ë¨ ë´‡ ëª©ë¡ -->
            <div class="telegram-bots-list" id="telegramBotsList">
                <!-- ë´‡ ëª©ë¡ ë™ì  ìƒì„± -->
            </div>
            
            <button class="add-bot-btn" id="addTelegramBot">
                <span>â•</span> ìƒˆ í…”ë ˆê·¸ë¨ ë´‡ ì¶”ê°€
            </button>
            
            <div class="telegram-status" id="telegramStatus"></div>
            
            <small>
                * ì—¬ëŸ¬ ê°œì˜ í…”ë ˆê·¸ë¨ ë´‡ì„ ì¶”ê°€í•˜ì—¬ ì—¬ëŸ¬ ì±„íŒ…ë°©ì— ì•Œë¦¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                * ë´‡ ìƒì„± ë°©ë²•: @BotFather ê²€ìƒ‰ â†’ /newbot â†’ í† í° ë°œê¸‰<br>
                * ì±„íŒ… ID í™•ì¸: @getidsbot ë˜ëŠ” @RawDataBot ê²€ìƒ‰
            </small>
        </div>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab-button active" data-tab="orders">ğŸ“‹ ì£¼ë¬¸ ê´€ë¦¬</button>
            <button class="tab-button" data-tab="wallets">ğŸ‘› ì§€ê°‘ ê´€ë¦¬</button>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-cards">
            <div class="stat-card">
                <h3 id="statTotalOrders">ì´ ì£¼ë¬¸</h3>
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-change" id="statTotalChange">ì „ì²´ ì£¼ë¬¸</div>
            </div>
            <div class="stat-card">
                <h3 id="statWaiting">ì…ê¸ˆ ëŒ€ê¸°</h3>
                <div class="stat-value" id="waitingOrders">0</div>
                <div class="stat-change" id="waitingChange">ëŒ€ê¸°ì¤‘</div>
            </div>
            <div class="stat-card">
                <h3 id="statActiveWallets">í™œì„± ì§€ê°‘</h3>
                <div class="stat-value" id="activeWallets">0</div>
                <div class="stat-change" id="walletsChange">ì‚¬ìš© ê°€ëŠ¥</div>
            </div>
            <div class="stat-card">
                <h3 id="statTodayRevenue">ì˜¤ëŠ˜ ìˆ˜ìµ</h3>
                <div class="stat-value" id="todayRevenue">0 THB</div>
                <div class="stat-change" id="revenueChange">ìˆ˜ìˆ˜ë£Œ 3%</div>
                <div class="stat-value" style="font-size: 16px; color: #7f8c8d; margin-top: 5px;" id="todayRevenueUSDT">(0 USDT)</div>
            </div>
            <div class="stat-card">
                <h3 id="statTodayAmount">ì˜¤ëŠ˜ ê±°ë˜ì•¡</h3>
                <div class="stat-value" id="todayAmount">0 THB</div>
                <div class="stat-change" id="amountChange">ì´ ê±°ë˜ì•¡</div>
                <div class="stat-value" style="font-size: 16px; color: #7f8c8d; margin-top: 5px;" id="todayAmountUSDT">(0 USDT)</div>
            </div>
        </div>

        <!-- ì£¼ë¬¸ ê´€ë¦¬ íƒ­ -->
        <div id="ordersTab" class="tab-content active">
            <div class="orders-section">
                <div class="section-header">
                    <h2 class="section-title" id="ordersTitle">ğŸ“‹ ì£¼ë¬¸ ëª©ë¡</h2>
                    <div class="filter-controls">
                        <input type="text" class="search-box" id="searchOrder" placeholder="ì£¼ë¬¸ ID ê²€ìƒ‰...">
                        <select class="filter-select" id="statusFilter">
                            <option value="all">ëª¨ë“  ìƒíƒœ</option>
                            <option value="ì…ê¸ˆëŒ€ê¸°">ì…ê¸ˆ ëŒ€ê¸°</option>
                            <option value="ì…ê¸ˆí™•ì¸">ì…ê¸ˆ í™•ì¸</option>
                            <option value="ì²˜ë¦¬ì¤‘">ì²˜ë¦¬ì¤‘</option>
                            <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                            <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                        </select>
                        <div class="time-filter">
                            <input type="date" class="time-input" id="dateFrom">
                            <span>~</span>
                            <input type="date" class="time-input" id="dateTo">
                        </div>
                        <button class="export-button" id="exportOrders">ğŸ“¥ ì €ì¥í•˜ê¸°</button>
                        <button class="refresh-button" id="refreshOrders">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>

                <div class="orders-table-container">
                    <table class="orders-table" id="ordersTable">
                        <thead>
                            <tr>
                                <th id="thOrderId">ì£¼ë¬¸ ID</th>
                                <th id="thTime">ì‹œê°„</th>
                                <th id="thAmount">ê¸ˆì•¡ (THB)</th>
                                <th id="thWallet">ì…ê¸ˆ ì§€ê°‘</th>
                                <th id="thStatus">ìƒíƒœ</th>
                                <th id="thStep">ì§„í–‰ ë‹¨ê³„</th>
                                <th id="thProof">ìœ ì € ìš”ì²­ì„œ</th>
                                <th id="thAction">ê²°ì œ ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <tr>
                                <td colspan="8" class="no-orders" id="noOrdersText">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ì§€ê°‘ ê´€ë¦¬ íƒ­ -->
        <div id="walletsTab" class="tab-content">
            <div class="wallets-section">
                <div class="section-header">
                    <h2 class="section-title" id="walletsTitle">ğŸ‘› ì§€ê°‘ ëª©ë¡</h2>
                    <div class="filter-controls">
                        <select class="filter-select" id="walletStatusFilter">
                            <option value="all">ëª¨ë“  ìƒíƒœ</option>
                            <option value="active">í™œì„±</option>
                            <option value="inactive">ë¹„í™œì„±</option>
                        </select>
                        <select class="filter-select" id="walletNetworkFilter">
                            <option value="all">ëª¨ë“  ë„¤íŠ¸ì›Œí¬</option>
                            <option value="TRC20">TRC20</option>
                            <option value="ERC20">ERC20</option>
                            <option value="BEP20">BEP20</option>
                            <option value="Solana">Solana</option>
                            <option value="Polygon">Polygon</option>
                        </select>
                        <button class="add-button" id="addWallet">â• ìƒˆ ì§€ê°‘ ì¶”ê°€</button>
                        <button class="refresh-button" id="refreshWallets">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>

                <div class="wallets-table-container">
                    <table class="wallets-table" id="walletsTable">
                        <thead>
                            <tr>
                                <th id="thWalletName">ì´ë¦„</th>
                                <th id="thNetwork">ë„¤íŠ¸ì›Œí¬</th>
                                <th id="thAddress">ì£¼ì†Œ</th>
                                <th id="thQRCode">QR ì½”ë“œ</th>
                                <th id="thWalletStatus">ìƒíƒœ</th>
                                <th id="thCreated">ìƒì„±ì¼</th>
                                <th id="thWalletAction">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="walletsTableBody">
                            <tr>
                                <td colspan="7" class="no-wallets" id="noWalletsText">ì§€ê°‘ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì§€ê°‘ì„ ì¶”ê°€í•˜ì„¸ìš”.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;" id="walletGuideTitle">ğŸ’¡ ì§€ê°‘ ê´€ë¦¬ ì•ˆë‚´</h3>
                    <ul style="color: #4a5568; line-height: 1.6; padding-left: 20px;" id="walletGuideList">
                        <li>ì—¬ëŸ¬ ê°œì˜ ì§€ê°‘ì„ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li><strong>í™œì„± ì§€ê°‘</strong>ì€ ì‚¬ìš©ì í˜ì´ì§€ì— í‘œì‹œë©ë‹ˆë‹¤.</li>
                        <li><strong>ê¸°ë³¸ ì§€ê°‘</strong>ì€ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ í™œì„± ìƒíƒœëŠ” ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>ê° ì§€ê°‘ì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>ë„¤íŠ¸ì›Œí¬ ìœ í˜•ë³„ë¡œ ì§€ê°‘ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ì €ì¥ ìƒíƒœ í‘œì‹œ -->
    <div class="save-status" id="saveStatus">
        íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
    </div>

    <!-- ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay hidden" id="orderDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="orderDetailTitle">ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h3>
                <button class="modal-close" id="closeDetailModal">âœ•</button>
            </div>
            <div class="modal-body" id="orderDetailContent">
                <!-- ë™ì  ë‚´ìš© -->
            </div>
            <div class="modal-actions" id="orderDetailActions">
                <!-- ë™ì  ì•¡ì…˜ ë²„íŠ¼ -->
            </div>
        </div>
    </div>

    <!-- ì§€ê°‘ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay hidden" id="walletModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="walletModalTitle">ğŸ‘› ìƒˆ ì§€ê°‘ ì¶”ê°€</h3>
                <button class="modal-close" id="closeWalletModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="walletForm">
                    <div class="form-group">
                        <label class="form-label" id="labelWalletName">ì§€ê°‘ ì´ë¦„ *</label>
                        <input type="text" class="form-input" id="walletName" 
                               placeholder="ì˜ˆ: ë©”ì¸ TRC20 ì§€ê°‘" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" id="labelNetwork">ë„¤íŠ¸ì›Œí¬ *</label>
                            <select class="form-select" id="walletNetwork" required>
                                <option value="">ì„ íƒ</option>
                                <option value="TRC20">TRC20 (íŠ¸ë¡ )</option>
                                <option value="ERC20">ERC20 (ì´ë”ë¦¬ì›€)</option>
                                <option value="BEP20">BEP20 (BNB ìŠ¤ë§ˆíŠ¸ ì²´ì¸)</option>
                                <option value="Solana">Solana</option>
                                <option value="Polygon">Polygon</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" id="labelStatus">ìƒíƒœ</label>
                            <select class="form-select" id="walletStatus">
                                <option value="active">í™œì„±</option>
                                <option value="inactive">ë¹„í™œì„±</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="labelAddress">ì§€ê°‘ ì£¼ì†Œ *</label>
                        <textarea class="form-textarea" id="walletAddress" 
                                  placeholder="ì§€ê°‘ ì£¼ì†Œ ì…ë ¥" 
                                  rows="3" required></textarea>
                        <small style="color: #718096; font-size: 12px;" id="addressHelp">
                            * ì˜¬ë°”ë¥¸ ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”. í˜•ì‹ì€ ë„¤íŠ¸ì›Œí¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="labelQRCode">QR ì½”ë“œ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)</label>
                        <input type="file" class="form-input" id="walletQRCode" 
                               accept="image/*">
                        <small style="color: #718096; font-size: 12px;" id="qrCodeHelp">
                            * ì§€ê°‘ ì£¼ì†Œì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”. (ê¶Œì¥ í¬ê¸°: 200x200px)
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="labelMemo">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
                        <textarea class="form-textarea" id="walletMemo" 
                                  placeholder="ì§€ê°‘ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´" 
                                  rows="2"></textarea>
                    </div>

                    <input type="hidden" id="walletId">
                </form>
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" id="cancelWalletModal">ì·¨ì†Œ</button>
                <button class="modal-button primary" id="saveWallet">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- í…”ë ˆê·¸ë¨ ë´‡ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay hidden" id="telegramBotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="telegramBotModalTitle">ğŸ¤– í…”ë ˆê·¸ë¨ ë´‡ ì¶”ê°€</h3>
                <button class="modal-close" id="closeTelegramBotModal">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="telegramBotForm">
                    <div class="bot-form-group">
                        <label class="form-label">ë´‡ ì´ë¦„ *</label>
                        <input type="text" class="form-input" id="botName" 
                               placeholder="ì˜ˆ: ë©”ì¸ ê´€ë¦¬ ì•Œë¦¼ë´‡" required>
                    </div>

                    <div class="bot-form-group">
                        <label class="form-label">ë´‡ í† í° (Bot Token) *</label>
                        <input type="text" class="form-input" id="botToken" 
                               placeholder="ì˜ˆ: 1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ" required>
                    </div>

                    <div class="bot-form-group">
                        <label class="form-label">ì±„íŒ… ID (Chat ID) *</label>
                        <input type="text" class="form-input" id="botChatId" 
                               placeholder="ì˜ˆ: 1234567890" required>
                        <small style="color: #718096; font-size: 12px;">
                            * ì—¬ëŸ¬ ì±„íŒ… IDë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: 123456,789012,345678)
                        </small>
                    </div>

                    <div class="bot-form-group">
                        <label class="form-label">ì•Œë¦¼ ìœ í˜•</label>
                        <div class="bot-checkbox-group">
                            <label class="bot-checkbox">
                                <input type="checkbox" id="notifyNewOrders" checked>
                                <span>ìƒˆ ì£¼ë¬¸ ì•Œë¦¼</span>
                            </label>
                            <label class="bot-checkbox">
                                <input type="checkbox" id="notifyStatusChanges" checked>
                                <span>ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì•Œë¦¼</span>
                            </label>
                            <label class="bot-checkbox">
                                <input type="checkbox" id="notifyTestMessages" checked>
                                <span>í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì•Œë¦¼</span>
                            </label>
                        </div>
                    </div>

                    <div class="bot-form-group">
                        <label class="form-label">í™œì„±í™”</label>
                        <label class="bot-checkbox">
                            <input type="checkbox" id="botEnabled" checked>
                            <span>ì´ ë´‡ì„ í™œì„±í™”í•©ë‹ˆë‹¤</span>
                        </label>
                    </div>

                    <input type="hidden" id="botId">
                </form>
            </div>
            <div class="modal-actions">
                <button class="modal-button secondary" id="cancelTelegramBotModal">ì·¨ì†Œ</button>
                <button class="modal-button primary" id="saveTelegramBot">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== ë¡œê·¸ì¸ ê´€ë¦¬ í´ë˜ìŠ¤ ====================
        class LoginManager {
            constructor() {
                this.ADMIN_CREDENTIALS_KEY = 'admin_credentials';
                this.CURRENT_ADMIN_KEY = 'current_admin';
                this.DEFAULT_ADMIN = {
                    username: 'admin',
                    password: '1234',
                    isDefault: true
                };
            }

            debugLoginState() {
                console.log('=== ë¡œê·¸ì¸ ìƒíƒœ ë””ë²„ê¹… ===');
                console.log('Session Storage current_admin:', sessionStorage.getItem('current_admin'));
                console.log('Local Storage admin_credentials:', localStorage.getItem('admin_credentials'));
                console.log('isLoggedIn():', this.isLoggedIn());
                console.log('getCurrentAdmin():', this.getCurrentAdmin());
                console.log('========================');
            }

            saveAdminCredentials(credentials) {
                try {
                    const admins = this.getAdminCredentials();
                    const index = admins.findIndex(a => a.username === credentials.username);
                    
                    if (index > -1) {
                        admins[index] = credentials;
                    } else {
                        admins.push(credentials);
                    }
                    
                    localStorage.setItem(this.ADMIN_CREDENTIALS_KEY, JSON.stringify(admins));
                    return true;
                } catch (error) {
                    console.error('Error saving admin credentials:', error);
                    return false;
                }
            }

            getAdminCredentials() {
                try {
                    const admins = JSON.parse(localStorage.getItem(this.ADMIN_CREDENTIALS_KEY) || '[]');
                    
                    if (!admins.some(a => a.username === this.DEFAULT_ADMIN.username)) {
                        admins.push(this.DEFAULT_ADMIN);
                        this.saveAdminCredentials(this.DEFAULT_ADMIN);
                    }
                    
                    return admins;
                } catch (error) {
                    console.error('Error loading admin credentials:', error);
                    return [this.DEFAULT_ADMIN];
                }
            }

            login(username, password) {
                const admins = this.getAdminCredentials();
                const admin = admins.find(a => a.username === username && a.password === password);
                
                if (admin) {
                    sessionStorage.setItem(this.CURRENT_ADMIN_KEY, JSON.stringify(admin));
                    return { success: true, admin: admin };
                }
                
                return { success: false, message: 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' };
            }

            logout() {
                sessionStorage.removeItem(this.CURRENT_ADMIN_KEY);
            }

            getCurrentAdmin() {
                try {
                    return JSON.parse(sessionStorage.getItem(this.CURRENT_ADMIN_KEY));
                } catch (error) {
                    return null;
                }
            }

            isLoggedIn() {
                return this.getCurrentAdmin() !== null;
            }

            changePassword(username, oldPassword, newPassword) {
                const admins = this.getAdminCredentials();
                const adminIndex = admins.findIndex(a => a.username === username && a.password === oldPassword);
                
                if (adminIndex > -1) {
                    admins[adminIndex].password = newPassword;
                    localStorage.setItem(this.ADMIN_CREDENTIALS_KEY, JSON.stringify(admins));
                    
                    const currentAdmin = this.getCurrentAdmin();
                    if (currentAdmin && currentAdmin.username === username) {
                        currentAdmin.password = newPassword;
                        sessionStorage.setItem(this.CURRENT_ADMIN_KEY, JSON.stringify(currentAdmin));
                    }
                    
                    return { success: true };
                }
                
                return { success: false, message: 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' };
            }
        }

        // ==================== ë°ì´í„° ê´€ë¦¬ì í´ë˜ìŠ¤ ====================
        class DataManager {
            constructor() {
                this.ORDERS_KEY = 'payment_orders';
                this.WALLETS_KEY = 'payment_wallets';
                this.SYNC_KEY = 'payment_sync_flag';
                this.ADMIN_SYNC_KEY = 'admin_sync_check';
                this.TELEGRAM_BOTS_KEY = 'telegram_bots';
                this.LAST_NOTIFICATION_KEY = 'last_notification_time';
            }

            getOrders() {
                try {
                    return JSON.parse(localStorage.getItem(this.ORDERS_KEY) || '[]');
                } catch (error) {
                    console.error('Error loading orders:', error);
                    return [];
                }
            }

            saveOrders(orders) {
                try {
                    localStorage.setItem(this.ORDERS_KEY, JSON.stringify(orders));
                    localStorage.setItem(this.SYNC_KEY, Date.now().toString());
                    return true;
                } catch (error) {
                    console.error('Error saving orders:', error);
                    return false;
                }
            }

            getWallets() {
                try {
                    let wallets = JSON.parse(localStorage.getItem(this.WALLETS_KEY) || '[]');
                    
                    if (wallets.length === 0) {
                        wallets = [this.createDefaultWallet()];
                        this.saveWallets(wallets);
                    }
                    
                    return wallets;
                } catch (error) {
                    console.error('Error loading wallets:', error);
                    return [];
                }
            }

            saveWallets(wallets) {
                try {
                    localStorage.setItem(this.WALLETS_KEY, JSON.stringify(wallets));
                    localStorage.setItem(this.SYNC_KEY, Date.now().toString());
                    return true;
                } catch (error) {
                    console.error('Error saving wallets:', error);
                    return false;
                }
            }

            createDefaultWallet() {
                return {
                    id: 'wallet_1',
                    name: 'ê¸°ë³¸ ì§€ê°‘ (TRC20)',
                    address: 'TXYZ1234567890abcdefghijklmnopqrstuvw',
                    network: 'TRC20',
                    qrCode: null,
                    isActive: true,
                    isDefault: true,
                    createdAt: new Date().toISOString()
                };
            }

            saveTelegramBots(bots) {
                try {
                    localStorage.setItem(this.TELEGRAM_BOTS_KEY, JSON.stringify(bots));
                    return true;
                } catch (error) {
                    console.error('Error saving telegram bots:', error);
                    return false;
                }
            }

            getTelegramBots() {
                try {
                    const bots = JSON.parse(localStorage.getItem(this.TELEGRAM_BOTS_KEY) || '[]');
                    
                    if (bots.length === 0) {
                        const oldSettings = JSON.parse(localStorage.getItem('telegram_settings') || '{}');
                        if (oldSettings.botToken && oldSettings.chatId) {
                            const newBot = {
                                id: 'bot_1',
                                name: 'ê¸°ë³¸ ì•Œë¦¼ë´‡',
                                token: oldSettings.botToken,
                                chatIds: [oldSettings.chatId],
                                notifyNewOrders: true,
                                notifyStatusChanges: true,
                                notifyTestMessages: true,
                                enabled: oldSettings.enabled !== false,
                                createdAt: new Date().toISOString()
                            };
                            this.saveTelegramBots([newBot]);
                            return [newBot];
                        }
                    }
                    
                    return bots;
                } catch (error) {
                    console.error('Error loading telegram bots:', error);
                    return [];
                }
            }

            saveLastNotificationTime() {
                localStorage.setItem(this.LAST_NOTIFICATION_KEY, Date.now().toString());
            }

            getLastNotificationTime() {
                return parseInt(localStorage.getItem(this.LAST_NOTIFICATION_TIME) || '0');
            }

            getNewOrdersSinceLastNotification() {
                const lastNotificationTime = this.getLastNotificationTime();
                const allOrders = this.getOrders();
                
                const newOrders = allOrders.filter(order => {
                    const orderTime = new Date(order.time).getTime();
                    return orderTime > lastNotificationTime;
                });
                
                return newOrders;
            }

            checkSync() {
                return localStorage.getItem(this.SYNC_KEY);
            }

            updateAdminSync() {
                const syncTime = this.checkSync();
                localStorage.setItem(this.ADMIN_SYNC_KEY, syncTime || '0');
                return syncTime;
            }

            needsSync() {
                const lastSync = this.checkSync();
                const lastAdminSync = localStorage.getItem(this.ADMIN_SYNC_KEY) || '0';
                return lastSync !== lastAdminSync;
            }

            notifyUserPage(orderId, newStatus) {
                try {
                    if (window.updateOrderStatusFromAdmin) {
                        window.updateOrderStatusFromAdmin(orderId, newStatus);
                    }
                } catch (e) {
                    console.log('ì‚¬ìš©ì í˜ì´ì§€ ì•Œë¦¼ ì‹¤íŒ¨');
                }
            }

            notifyUserPageWallets(wallets) {
                try {
                    if (window.updateWalletsFromAdmin) {
                        window.updateWalletsFromAdmin(wallets);
                    }
                } catch (e) {
                    console.log('ì‚¬ìš©ì í˜ì´ì§€ ì§€ê°‘ ì•Œë¦¼ ì‹¤íŒ¨');
                }
            }
        }

        // ==================== í…”ë ˆê·¸ë¨ ì•Œë¦¼ í´ë˜ìŠ¤ ====================
        class TelegramMultiNotifier {
    constructor() {
        // this.dataManagerë¥¼ ë°”ë¡œ ì •ì˜
        this.dataManager = new DataManager();
        this.bots = this.dataManager.getTelegramBots();
        this.lastSentOrders = new Set();
        this.localStorageKey = 'telegram_sent_orders';
        this.initializeSentOrders();
    }

            initializeSentOrders() {
                try {
                    const saved = JSON.parse(localStorage.getItem(this.localStorageKey) || '[]');
                    this.lastSentOrders = new Set(saved);
                    console.log(`ğŸ“‹ ë¡œë“œëœ ì•Œë¦¼ ê¸°ë¡: ${this.lastSentOrders.size}ê°œ ì£¼ë¬¸`);
                    
                    const twentyFourHoursAgo = Date.now() - 24 * 60 * 60 * 1000;
                    const cleanOrders = saved.filter(orderId => {
                        const match = orderId.match(/ORD-(\d+)/);
                        if (match) {
                            const orderTime = parseInt(match[1]);
                            return orderTime > twentyFourHoursAgo;
                        }
                        return true;
                    });
                    
                    if (cleanOrders.length !== saved.length) {
                        localStorage.setItem(this.localStorageKey, JSON.stringify(cleanOrders));
                        this.lastSentOrders = new Set(cleanOrders);
                    }
                } catch (error) {
                    console.error('ì•Œë¦¼ ê¸°ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                    this.lastSentOrders = new Set();
                }
            }

            saveSentOrders() {
                try {
                    const orders = Array.from(this.lastSentOrders);
                    localStorage.setItem(this.localStorageKey, JSON.stringify(orders));
                } catch (error) {
                    console.error('ì•Œë¦¼ ê¸°ë¡ ì €ì¥ ì˜¤ë¥˜:', error);
                }
            }

            hasOrderBeenSent(orderId) {
                return this.lastSentOrders.has(orderId);
            }

            markOrderAsSent(orderId) {
                this.lastSentOrders.add(orderId);
                this.saveSentOrders();
                
                setTimeout(() => {
                    this.lastSentOrders.delete(orderId);
                    this.saveSentOrders();
                }, 24 * 60 * 60 * 1000);
            }

            async sendToAllBots(message, options = {}) {
                const results = [];
                const activeBots = this.bots.filter(bot => bot.enabled);
                
                if (activeBots.length === 0) {
                    console.warn('í™œì„±í™”ëœ í…”ë ˆê·¸ë¨ ë´‡ì´ ì—†ìŠµë‹ˆë‹¤');
                    return [];
                }

                for (const bot of activeBots) {
                    if (options.notificationType === 'newOrder' && !bot.notifyNewOrders) {
                        continue;
                    }
                    if (options.notificationType === 'statusChange' && !bot.notifyStatusChanges) {
                        continue;
                    }
                    if (options.notificationType === 'test' && !bot.notifyTestMessages) {
                        continue;
                    }

                    try {
                        let imageResult = null;
                        if (options.imageData) {
                            console.log(`ğŸ“¤ ${bot.name}ì— ì´ë¯¸ì§€ ì „ì†¡ ì‹œë„...`);
                            imageResult = await this.sendImageToBot(bot, options.imageData, options.imageCaption || message);
                            console.log(`ğŸ–¼ï¸ ${bot.name} ì´ë¯¸ì§€ ì „ì†¡ ê²°ê³¼:`, imageResult.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                        }
                        
                        const textResult = await this.sendMessageToBot(bot, message);
                        console.log(`ğŸ’¬ ${bot.name} í…ìŠ¤íŠ¸ ì „ì†¡ ê²°ê³¼:`, textResult.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                        
                        results.push({
                            botName: bot.name,
                            textSuccess: textResult.success,
                            imageSuccess: imageResult ? imageResult.success : null,
                            error: textResult.error || (imageResult ? imageResult.error : null),
                            data: { text: textResult.data, image: imageResult ? imageResult.data : null }
                        });
                    } catch (error) {
                        console.error(`âŒ ${bot.name} ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨:`, error);
                        results.push({
                            botName: bot.name,
                            textSuccess: false,
                            imageSuccess: false,
                            error: error.message
                        });
                    }
                }

                return results;
            }

            async sendMessageToBot(bot, message) {
                if (!bot.token || !bot.chatIds || bot.chatIds.length === 0) {
                    return { success: false, error: 'ë´‡ ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' };
                }

                const results = [];
                
                for (const chatId of bot.chatIds) {
                    try {
                        console.log(`ğŸ“¨ ${bot.name} â†’ ì±„íŒ… ${chatId} ë©”ì‹œì§€ ì „ì†¡...`);
                        const result = await this.sendTextMessage(bot.token, chatId, message);
                        results.push({
                            chatId: chatId,
                            success: result.success,
                            error: result.error
                        });
                        
                        await new Promise(resolve => setTimeout(resolve, 100));
                    } catch (error) {
                        console.error(`âŒ ${bot.name} â†’ ì±„íŒ… ${chatId} ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:`, error);
                        results.push({
                            chatId: chatId,
                            success: false,
                            error: error.message
                        });
                    }
                }

                const allSuccess = results.every(r => r.success);
                const errors = results.filter(r => !r.success).map(r => `ì±„íŒ… ${r.chatId}: ${r.error}`);

                return {
                    success: allSuccess,
                    error: errors.length > 0 ? errors.join(' | ') : null,
                    details: results
                };
            }

            async sendImageToBot(bot, imageData, caption = '') {
    if (!bot.token || !bot.chatIds || bot.chatIds.length === 0) {
        return { success: false, error: 'ë´‡ ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤' };
    }

    const results = [];
    
    for (const chatId of bot.chatIds) {
        try {
            console.log(`ğŸ“¤ ${bot.name} â†’ ì±„íŒ… ${chatId} ì´ë¯¸ì§€+ë©”ì‹œì§€ ì „ì†¡...`);
            
            // ì´ë¯¸ì§€ì™€ í•¨ê»˜ caption(ë©”ì‹œì§€) ì „ì†¡
            const result = await this.sendImage(bot.token, chatId, imageData, caption);
            
            results.push({
                chatId: chatId,
                success: result.success,
                error: result.error
            });
            
            await new Promise(resolve => setTimeout(resolve, 500));
        } catch (error) {
            console.error(`âŒ ${bot.name} â†’ ì±„íŒ… ${chatId} ì´ë¯¸ì§€ ì „ì†¡ ì‹¤íŒ¨:`, error);
            results.push({
                chatId: chatId,
                success: false,
                error: error.message
            });
        }
    }

    const allSuccess = results.every(r => r.success);
    const errors = results.filter(r => !r.success).map(r => `ì±„íŒ… ${r.chatId}: ${r.error}`);

    return {
        success: allSuccess,
        error: errors.length > 0 ? errors.join(' | ') : null,
        details: results
    };
}

    const allSuccess = results.every(r => r.success);
    const errors = results.filter(r => !r.success).map(r => `ì±„íŒ… ${r.chatId}: ${r.error}`);

    return {
        success: allSuccess,
        error: errors.length > 0 ? errors.join(' | ') : null,
        details: results
    };
}

            async sendTextMessage(botToken, chatId, message) {
                try {
                    const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
                    
                    console.log(`ğŸŒ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ API í˜¸ì¶œ: ${url.substring(0, 50)}...`);
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: chatId,
                            text: message,
                            parse_mode: 'HTML'
                        })
                    });

                    const data = await response.json();
                    
                    if (response.ok && data.ok) {
                        console.log('âœ… í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ');
                        return { success: true, data: data };
                    } else {
                        let errorMessage = data.description || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                        
                        if (errorMessage.includes('Forbidden')) {
                            errorMessage = 'ë´‡ì´ ì±„íŒ…ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë´‡ì„ ë¨¼ì € ì±„íŒ…ì— ì´ˆëŒ€í•´ì£¼ì„¸ìš”.';
                        } else if (errorMessage.includes('chat not found')) {
                            errorMessage = 'ì±„íŒ…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì±„íŒ… IDë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        } else if (errorMessage.includes('Bad Request')) {
                            errorMessage = 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤. ë´‡ í† í°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        }
                        
                        console.error('âŒ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:', errorMessage);
                        return { success: false, error: errorMessage };
                    }
                } catch (error) {
                    console.error('ğŸŒ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
                    return { 
                        success: false, 
                        error: `ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜: ${error.message}` 
                    };
                }
            }

            async sendImage(botToken, chatId, imageData, caption = '') {
    try {
        console.log('ğŸ–¼ï¸ ì´ë¯¸ì§€+ë©”ì‹œì§€ ì „ì†¡ ì‹œì‘:', botToken.substring(0, 10) + '...', 'ì±„íŒ… ID:', chatId);
        
        let base64Data;
        if (typeof imageData === 'string') {
            if (imageData.includes('data:image/')) {
                base64Data = imageData.split(',')[1];
            } else {
                base64Data = imageData;
            }
        } else {
            throw new Error('ì´ë¯¸ì§€ ë°ì´í„°ê°€ ë¬¸ìì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤');
        }
        
        const byteCharacters = atob(base64Data);
        const byteNumbers = new Array(byteCharacters.length);
        
        for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        
        const byteArray = new Uint8Array(byteNumbers);
        
        let mimeType = 'image/jpeg';
        if (typeof imageData === 'string' && imageData.includes('data:image/')) {
            mimeType = 'image/' + imageData.split('data:image/')[1].split(';')[0];
        }
        
        console.log('ğŸ“ ì´ë¯¸ì§€ ì •ë³´:', 'MIME:', mimeType, 'í¬ê¸°:', byteArray.length, 'ë°”ì´íŠ¸');
        
        const blob = new Blob([byteArray], { type: mimeType });
        const fileExtension = mimeType.split('/')[1] || 'jpg';
        
        const formData = new FormData();
        formData.append('chat_id', chatId);
        formData.append('photo', blob, `payment_proof.${fileExtension}`);
        
        // ë©”ì‹œì§€ë¥¼ captionìœ¼ë¡œ ì„¤ì •
        if (caption) {
            formData.append('caption', caption);
            formData.append('parse_mode', 'HTML'); // HTML í˜•ì‹ ì§€ì›
        }
        
        console.log('ğŸ“¦ FormData ìƒì„± ì™„ë£Œ, caption í¬í•¨:', caption.substring(0, 50) + '...');
        
        const url = `https://api.telegram.org/bot${botToken}/sendPhoto`;
        console.log('ğŸš€ API ìš”ì²­:', url);
        
        const response = await fetch(url, {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        
        if (response.ok && data.ok) {
            console.log('âœ… ì´ë¯¸ì§€+ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ:', data.result.photo.length, 'ì¥ì˜ ì´ë¯¸ì§€ ì „ì†¡ë¨');
            return { success: true, data: data };
        } else {
            console.error('âŒ ì´ë¯¸ì§€ ì „ì†¡ ì‹¤íŒ¨:', data);
            let errorMessage = data.description || 'ì´ë¯¸ì§€ ì „ì†¡ ì‹¤íŒ¨';
            
            if (errorMessage.includes('file is too big')) {
                errorMessage = 'ì´ë¯¸ì§€ íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤ (20MB ì œí•œ)';
            } else if (errorMessage.includes('wrong file type')) {
                errorMessage = 'ì§€ì›ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ í˜•ì‹ì…ë‹ˆë‹¤';
            } else if (errorMessage.includes('caption is too long')) {
                // captionì´ ë„ˆë¬´ ê¸¸ ê²½ìš°, ì§§ê²Œ ì¤„ì—¬ì„œ ë‹¤ì‹œ ì‹œë„
                console.log('âš ï¸ captionì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ë‹¨ìˆœí™”ëœ ë©”ì‹œì§€ë¡œ ì¬ì‹œë„...');
                const simpleCaption = 
                    '<b>ğŸš¨ ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</b>\n\n' +
                    'ğŸ“‹ <b>ì£¼ë¬¸ ID:</b> ' + (caption.match(/ì£¼ë¬¸ ID: (ORD-[^<]+)/)?.[1] || 'í™•ì¸ í•„ìš”') + '\n' +
                    'ğŸ’° <b>ê¸ˆì•¡:</b> ' + (caption.match(/ê²°ì œ ê¸ˆì•¡: ([^<]+)/)?.[1] || 'í™•ì¸ í•„ìš”') + '\n' +
                    'âœ… <b>ì´ë¯¸ì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</b>';
                
                return await this.sendImage(botToken, chatId, imageData, simpleCaption);
            }
            
            return { success: false, error: errorMessage };
        }
    } catch (error) {
        console.error('ğŸŒ ì´ë¯¸ì§€ ì „ì†¡ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
        return { success: false, error: `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}` };
    }
}

            async sendTestNotification(botId = null) {
                const message = 
                    '<b>âœ… í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ (ì´ë¯¸ì§€ í¬í•¨)</b>\n\n' +
                    'ê´€ë¦¬ì ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤!\n' +
                    'ì‹œê°„: ' + new Date().toLocaleString('ko-KR') + '\n\n' +
                    'âœ… í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ í™•ì¸\n' +
                    'ğŸ“¸ ì´ë¯¸ì§€ ì „ì†¡ ê¸°ëŠ¥ í™•ì¸';
                
                const testImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
                
                if (botId) {
                    const bot = this.bots.find(b => b.id === botId);
                    if (!bot) {
                        return { success: false, error: 'ë´‡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' };
                    }
                    
                    const textResult = await this.sendMessageToBot(bot, message);
                    const imageResult = await this.sendImageToBot(bot, testImage, 'í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€');
                    
                    return {
                        success: textResult.success && imageResult.success,
                        textSuccess: textResult.success,
                        imageSuccess: imageResult.success,
                        error: textResult.error || imageResult.error,
                        botName: bot.name
                    };
                } else {
                    const textResults = await this.sendToAllBots(message, { notificationType: 'test' });
                    const imageResults = await this.sendToAllBots('í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€', { 
                        notificationType: 'test',
                        imageData: testImage,
                        imageCaption: 'í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€'
                    });
                    
                    return {
                        success: true,
                        message: 'í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ (í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€)'
                    };
                }
            }

            
// TelegramMultiNotifier í´ë˜ìŠ¤ì˜ sendNewOrderNotification í•¨ìˆ˜ ìˆ˜ì •:
async sendNewOrderNotification(order) {
    // ì´ë¯¸ ì•Œë¦¼ ë³´ë‚¸ ì£¼ë¬¸ì¸ì§€ í™•ì¸
    if (this.hasOrderBeenSent(order.id)) {
        console.log('â­ï¸ ì´ë¯¸ ì•Œë¦¼ ë³´ë‚¸ ì£¼ë¬¸: ' + order.id);
        return {
            alreadySent: true,
            message: 'ì´ë¯¸ ì•Œë¦¼ì„ ë³´ë‚¸ ì£¼ë¬¸ì…ë‹ˆë‹¤'
        };
    }

    const statusText = {
        'ì…ê¸ˆëŒ€ê¸°': 'ì…ê¸ˆ ëŒ€ê¸°',
        'ì…ê¸ˆí™•ì¸': 'ì…ê¸ˆ í™•ì¸',
        'ì²˜ë¦¬ì¤‘': 'ì²˜ë¦¬ ì¤‘',
        'ì™„ë£Œ': 'ì™„ë£Œ',
        'ì·¨ì†Œ': 'ì·¨ì†Œ'
    }[order.status] || order.status;

    const fee = order.usdt * 0.03;
    const netAmount = order.usdt - fee;
    
    const message = 
        '<b>ğŸš¨ ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</b>\n\n' +
        'ğŸ“‹ <b>ì£¼ë¬¸ ID:</b> ' + order.id + '\n' +
        'ğŸ’° <b>ê²°ì œ ê¸ˆì•¡:</b> ' + order.amount.toLocaleString() + ' THB\n' +
        'ğŸ’µ <b>USDT ê¸ˆì•¡:</b> ' + netAmount.toFixed(4) + ' USDT\n' +
        'ğŸ“Š <b>ìˆ˜ìˆ˜ë£Œ (3%):</b> ' + fee.toFixed(4) + ' USDT\n' +
        'â° <b>ìš”ì²­ ì‹œê°„:</b> ' + new Date(order.time).toLocaleString('ko-KR') + '\n' +
        'ğŸ“ˆ <b>ìƒíƒœ:</b> ' + statusText + '\n\n' +
        'ğŸ‘› <b>ì…ê¸ˆ ì§€ê°‘:</b> ' + (order.wallet ? order.wallet.name : 'ì§€ì •ë˜ì§€ ì•ŠìŒ') + '\n' +
        'ğŸ”— <b>ì£¼ì†Œ:</b> ' + (order.wallet ? (order.wallet.address.length > 30 ? 
            order.wallet.address.substring(0, 15) + '...' + order.wallet.address.substring(order.wallet.address.length - 15) : 
            order.wallet.address) : 'ì—†ìŒ') + '\n\n' +
        'âœ… <b>ë¹ ë¥¸ ì²˜ë¦¬ ìš”ë§</b>';

    console.log('ğŸ“¨ ìƒˆ ì£¼ë¬¸ ì•Œë¦¼ ì¤€ë¹„:', order.id);
    
    if (order.proof && order.proof.data && order.proof.type.startsWith('image/')) {
        // ì´ë¯¸ì§€ê°€ ìˆì„ ê²½ìš°: ì´ë¯¸ì§€ì™€ í•¨ê»˜ ë©”ì‹œì§€ ì „ì†¡ (í•œ ë²ˆë§Œ)
        console.log('ğŸ–¼ï¸ ê²°ì œ ì¦ëª…ì„œ ì´ë¯¸ì§€ ìˆìŒ - ì´ë¯¸ì§€ì™€ í•¨ê»˜ ë©”ì‹œì§€ ì „ì†¡');
        
        const results = await this.sendToAllBots(message, {
            notificationType: 'newOrder',
            imageData: order.proof.data,
            imageCaption: message // ì´ë¯¸ì§€ captionìœ¼ë¡œ ë©”ì‹œì§€ ë‚´ìš©ì„ í•¨ê»˜ ì „ì†¡
        });
        
        // ì•Œë¦¼ ë³´ë‚¸ ê¸°ë¡ ì €ì¥
        if (results.length > 0 && results.some(r => r.imageSuccess || r.textSuccess)) {
            this.markOrderAsSent(order.id);
        }
        
        return {
            results: results,
            hasImage: true,
            sentWithImage: true,
            alreadySent: false
        };
    } else {
        // ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš°: í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë§Œ ì „ì†¡
        console.log('ğŸ“„ ê²°ì œ ì¦ëª…ì„œ ì—†ìŒ - í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë§Œ ì „ì†¡');
        
        const results = await this.sendToAllBots(message, { notificationType: 'newOrder' });
        
        // ì•Œë¦¼ ë³´ë‚¸ ê¸°ë¡ ì €ì¥
        if (results.length > 0 && results.some(r => r.textSuccess)) {
            this.markOrderAsSent(order.id);
        }

        return {
            results: results,
            hasImage: false,
            sentWithImage: false,
            alreadySent: false
        };
    }
}

// sendToAllBots í•¨ìˆ˜ë„ ìˆ˜ì • í•„ìš” (ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ë¥¼ ê°™ì´ ë³´ë‚´ì§€ ì•Šë„ë¡)
async sendToAllBots(message, options = {}) {
    const results = [];
    const activeBots = this.bots.filter(bot => bot.enabled);
    
    if (activeBots.length === 0) {
        console.warn('í™œì„±í™”ëœ í…”ë ˆê·¸ë¨ ë´‡ì´ ì—†ìŠµë‹ˆë‹¤');
        return [];
    }

    for (const bot of activeBots) {
        // ì•Œë¦¼ íƒ€ì… í•„í„°ë§
        if (options.notificationType === 'newOrder' && !bot.notifyNewOrders) {
            continue;
        }
        if (options.notificationType === 'statusChange' && !bot.notifyStatusChanges) {
            continue;
        }
        if (options.notificationType === 'test' && !bot.notifyTestMessages) {
            continue;
        }

        try {
            if (options.imageData) {
                // ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€ì™€ í•¨ê»˜ ë©”ì‹œì§€ ì „ì†¡ (í…ìŠ¤íŠ¸ ë©”ì‹œì§€ëŠ” ë³„ë„ë¡œ ë³´ë‚´ì§€ ì•ŠìŒ)
                console.log(`ğŸ“¤ ${bot.name}ì— ì´ë¯¸ì§€ì™€ í•¨ê»˜ ë©”ì‹œì§€ ì „ì†¡...`);
                const imageResult = await this.sendImageToBot(bot, options.imageData, options.imageCaption || message);
                console.log(`ğŸ–¼ï¸ ${bot.name} ì´ë¯¸ì§€+ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼:`, imageResult.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                
                results.push({
                    botName: bot.name,
                    textSuccess: false, // í…ìŠ¤íŠ¸ëŠ” ì´ë¯¸ì§€ captionìœ¼ë¡œ ì „ì†¡ë¨
                    imageSuccess: imageResult.success,
                    error: imageResult.error,
                    data: { image: imageResult.data }
                });
            } else {
                // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë§Œ ì „ì†¡
                const textResult = await this.sendMessageToBot(bot, message);
                console.log(`ğŸ’¬ ${bot.name} í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼:`, textResult.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                
                results.push({
                    botName: bot.name,
                    textSuccess: textResult.success,
                    imageSuccess: null,
                    error: textResult.error,
                    data: { text: textResult.data }
                });
            }
        } catch (error) {
            console.error(`âŒ ${bot.name} ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨:`, error);
            results.push({
                botName: bot.name,
                textSuccess: false,
                imageSuccess: false,
                error: error.message
            });
        }
    }

    return results;
}

        // ==================== ì „ì—­ ë³€ìˆ˜ ====================
        const dataManager = new DataManager();
        const telegramNotifier = new TelegramMultiNotifier();
        const loginManager = new LoginManager();
        
        let allOrders = [];
        let allWallets = [];
        let currentFilter = 'all';
        let selectedOrder = null;
        let selectedWallet = null;
        let selectedBot = null;
        let currentTab = 'orders';
        let qrCodeFile = null;
        let currentLang = 'ko';
        let syncCheckInterval = null;
        let notificationCheckInterval = null;

        // ë²ˆì—­ ë°ì´í„°
        const translations = {
            en: {
                adminTitle: "ğŸ“Š Order & Wallet Management System",
                adminSubtitle: "Manage user orders and wallet settings in one place",
                langSwitchText: "í•œêµ­ì–´",
                logoutText: "Logout",
                statTotalOrders: "Total Orders",
                statWaiting: "Waiting Deposit",
                statActiveWallets: "Active Wallets",
                statTodayRevenue: "Today's Revenue",
                statTodayAmount: "Today's Transaction",
                ordersTitle: "ğŸ“‹ Order List",
                walletsTitle: "ğŸ‘› Wallet List",
                thOrderId: "Order ID",
                thTime: "Time",
                thAmount: "Amount (THB)",
                thWallet: "Wallet",
                thStatus: "Status",
                thStep: "Step",
                thProof: "Proof",
                thAction: "Action",
                thWalletName: "Name",
                thNetwork: "Network",
                thAddress: "Address",
                thQRCode: "QR Code",
                thWalletStatus: "Status",
                thCreated: "Created",
                thWalletAction: "Action",
                noOrdersText: "No orders",
                noWalletsText: "No wallets. Please add a new wallet.",
                searchPlaceholder: "Search order ID...",
                statusAll: "All Status",
                statusWaiting: "Waiting Deposit",
                statusConfirmed: "Deposit Confirmed",
                statusProcessing: "Processing",
                statusCompleted: "Completed",
                statusCancelled: "Cancelled",
                exportBtn: "ğŸ“¥ Export",
                refreshBtn: "ğŸ”„ Refresh",
                addWalletBtn: "â• Add New Wallet",
                walletGuideTitle: "ğŸ’¡ Wallet Management Guide",
                walletGuideList: [
                    "You can add, edit, and delete multiple wallets.",
                    "<strong>Active wallets</strong> are displayed on the user page.",
                    "<strong>Default wallet</strong> cannot be deleted, but its active status can be changed.",
                    "You can upload QR code images for each wallet.",
                    "Manage wallets by network type."
                ],
                orderDetailTitle: "ğŸ“‹ Order Details",
                walletModalTitle: "ğŸ‘› Add New Wallet",
                labelWalletName: "Wallet Name *",
                labelNetwork: "Network *",
                labelStatus: "Status",
                labelAddress: "Wallet Address *",
                addressHelp: "* Enter correct wallet address. Format varies by network.",
                labelQRCode: "QR Code Image (Optional)",
                qrCodeHelp: "* Upload QR code image for wallet address. (Recommended size: 200x200px)",
                labelMemo: "Memo (Optional)",
                saveBtn: "Save",
                cancelBtn: "Cancel",
                statTotalChange: "All orders",
                waitingChange: "waiting",
                walletsChange: "available",
                revenueChange: "Fee 3%",
                amountChange: "Total amount",
                syncStatusText: "Real-time Sync",
                telegramBotModalTitle: "ğŸ¤– Add Telegram Bot",
                botNameLabel: "Bot Name *",
                botTokenLabel: "Bot Token *",
                botChatIdLabel: "Chat ID *",
                botNotificationTypes: "Notification Types",
                botNotifyNewOrders: "New order notifications",
                botNotifyStatusChanges: "Order status change notifications",
                botNotifyTestMessages: "Test message notifications",
                botEnabledLabel: "Enable",
                botEnabledText: "Enable this bot",
                botTestButton: "Test",
                botEditButton: "Edit",
                botDeleteButton: "Delete",
                botActiveStatus: "Active",
                botInactiveStatus: "Inactive",
                noBotsText: "No Telegram bots added. Add a new bot to receive notifications."
            },
            ko: {
                adminTitle: "ğŸ“Š ì£¼ë¬¸ ë° ì§€ê°‘ ê´€ë¦¬ ì‹œìŠ¤í…œ",
                adminSubtitle: "í•œ ê³³ì—ì„œ ì‚¬ìš©ì ì£¼ë¬¸ê³¼ ì§€ê°‘ ì„¤ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”",
                langSwitchText: "English",
                logoutText: "ë¡œê·¸ì•„ì›ƒ",
                statTotalOrders: "ì´ ì£¼ë¬¸",
                statWaiting: "ì…ê¸ˆ ëŒ€ê¸°",
                statActiveWallets: "í™œì„± ì§€ê°‘",
                statTodayRevenue: "ì˜¤ëŠ˜ ìˆ˜ìµ",
                statTodayAmount: "ì˜¤ëŠ˜ ê±°ë˜ì•¡",
                ordersTitle: "ğŸ“‹ ì£¼ë¬¸ ëª©ë¡",
                walletsTitle: "ğŸ‘› ì§€ê°‘ ëª©ë¡",
                thOrderId: "ì£¼ë¬¸ ID",
                thTime: "ì‹œê°„",
                thAmount: "ê¸ˆì•¡ (THB)",
                thWallet: "ì§€ê°‘",
                thStatus: "ìƒíƒœ",
                thStep: "ë‹¨ê³„",
                thProof: "ì¦ëª…ì„œ",
                thAction: "ì‘ì—…",
                thWalletName: "ì´ë¦„",
                thNetwork: "ë„¤íŠ¸ì›Œí¬",
                thAddress: "ì£¼ì†Œ",
                thQRCode: "QR ì½”ë“œ",
                thWalletStatus: "ìƒíƒœ",
                thCreated: "ìƒì„±ì¼",
                thWalletAction: "ì‘ì—…",
                noOrdersText: "ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤",
                noWalletsText: "ì§€ê°‘ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì§€ê°‘ì„ ì¶”ê°€í•˜ì„¸ìš”.",
                searchPlaceholder: "ì£¼ë¬¸ ID ê²€ìƒ‰...",
                statusAll: "ëª¨ë“  ìƒíƒœ",
                statusWaiting: "ì…ê¸ˆ ëŒ€ê¸°",
                statusConfirmed: "ì…ê¸ˆ í™•ì¸",
                statusProcessing: "ì²˜ë¦¬ì¤‘",
                statusCompleted: "ì™„ë£Œ",
                statusCancelled: "ì·¨ì†Œ",
                exportBtn: "ğŸ“¥ ë‚´ë³´ë‚´ê¸°",
                refreshBtn: "ğŸ”„ ìƒˆë¡œê³ ì¹¨",
                addWalletBtn: "â• ìƒˆ ì§€ê°‘ ì¶”ê°€",
                walletGuideTitle: "ğŸ’¡ ì§€ê°‘ ê´€ë¦¬ ì•ˆë‚´",
                walletGuideList: [
                    "ì—¬ëŸ¬ ê°œì˜ ì§€ê°‘ì„ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "<strong>í™œì„± ì§€ê°‘</strong>ì€ ì‚¬ìš©ì í˜ì´ì§€ì— í‘œì‹œë©ë‹ˆë‹¤.",
                    "<strong>ê¸°ë³¸ ì§€ê°‘</strong>ì€ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ í™œì„± ìƒíƒœëŠ” ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "ê° ì§€ê°‘ì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                    "ë„¤íŠ¸ì›Œí¬ ìœ í˜•ë³„ë¡œ ì§€ê°‘ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                ],
                orderDetailTitle: "ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´",
                walletModalTitle: "ğŸ‘› ìƒˆ ì§€ê°‘ ì¶”ê°€",
                labelWalletName: "ì§€ê°‘ ì´ë¦„ *",
                labelNetwork: "ë„¤íŠ¸ì›Œí¬ *",
                labelStatus: "ìƒíƒœ",
                labelAddress: "ì§€ê°‘ ì£¼ì†Œ *",
                addressHelp: "* ì˜¬ë°”ë¥¸ ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”. í˜•ì‹ì€ ë„¤íŠ¸ì›Œí¬ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.",
                labelQRCode: "QR ì½”ë“œ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)",
                qrCodeHelp: "* ì§€ê°‘ ì£¼ì†Œì— ëŒ€í•œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”. (ê¶Œì¥ í¬ê¸°: 200x200px)",
                labelMemo: "ë©”ëª¨ (ì„ íƒì‚¬í•­)",
                saveBtn: "ì €ì¥",
                cancelBtn: "ì·¨ì†Œ",
                statTotalChange: "ì „ì²´ ì£¼ë¬¸",
                waitingChange: "ëŒ€ê¸°ì¤‘",
                walletsChange: "ì‚¬ìš© ê°€ëŠ¥",
                revenueChange: "ìˆ˜ìˆ˜ë£Œ 3%",
                amountChange: "ì´ ê±°ë˜ì•¡",
                syncStatusText: "ì‹¤ì‹œê°„ ë™ê¸°í™”",
                telegramBotModalTitle: "ğŸ¤– í…”ë ˆê·¸ë¨ ë´‡ ì¶”ê°€",
                botNameLabel: "ë´‡ ì´ë¦„ *",
                botTokenLabel: "ë´‡ í† í° *",
                botChatIdLabel: "ì±„íŒ… ID *",
                botNotificationTypes: "ì•Œë¦¼ ìœ í˜•",
                botNotifyNewOrders: "ìƒˆ ì£¼ë¬¸ ì•Œë¦¼",
                botNotifyStatusChanges: "ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì•Œë¦¼",
                botNotifyTestMessages: "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì•Œë¦¼",
                botEnabledLabel: "í™œì„±í™”",
                botEnabledText: "ì´ ë´‡ì„ í™œì„±í™”í•©ë‹ˆë‹¤",
                botTestButton: "í…ŒìŠ¤íŠ¸",
                botEditButton: "ìˆ˜ì •",
                botDeleteButton: "ì‚­ì œ",
                botActiveStatus: "í™œì„±",
                botInactiveStatus: "ë¹„í™œì„±",
                noBotsText: "í…”ë ˆê·¸ë¨ ë´‡ì´ ì—†ìŠµë‹ˆë‹¤. ì•Œë¦¼ì„ ë°›ìœ¼ë ¤ë©´ ìƒˆ ë´‡ì„ ì¶”ê°€í•˜ì„¸ìš”."
            }
        };

        // ==================== í˜ì´ì§€ ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ê´€ë¦¬ì í˜ì´ì§€ ë¡œë“œë¨');
            
            loginManager.debugLoginState();
            
            const isLoggedIn = loginManager.isLoggedIn();
            console.log('ë¡œê·¸ì¸ ìƒíƒœ:', isLoggedIn);
            
            if (!isLoggedIn) {
                console.log('ë¡œê·¸ì¸ í•„ìš” - ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ');
                document.getElementById('loginContainer').classList.remove('hidden');
                document.getElementById('adminDashboard').style.display = 'none';
                
                document.getElementById('loginForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('loginUsername').value.trim();
                    const password = document.getElementById('loginPassword').value.trim();
                    console.log('ë¡œê·¸ì¸ ì‹œë„:', username, password);
                    
                    const result = loginManager.login(username, password);
                    console.log('ë¡œê·¸ì¸ ê²°ê³¼:', result);
                    
                    if (result.success) {
                        console.log('ë¡œê·¸ì¸ ì„±ê³µ - ëŒ€ì‹œë³´ë“œ í‘œì‹œ');
                        document.getElementById('loginContainer').classList.add('hidden');
                        document.getElementById('adminDashboard').style.display = 'block';
                        initializeAdminDashboard();
                    } else {
                        const errorElement = document.getElementById('loginError');
                        errorElement.textContent = result.message;
                        errorElement.style.display = 'block';
                        
                        setTimeout(() => {
                            errorElement.style.display = 'none';
                        }, 3000);
                    }
                });
            } else {
                console.log('ì´ë¯¸ ë¡œê·¸ì¸ë¨ - ëŒ€ì‹œë³´ë“œ í‘œì‹œ');
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('adminDashboard').style.display = 'block';
                initializeAdminDashboard();
            }
        });

        function showLoginScreen() {
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('adminDashboard').style.display = 'none';
            
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                const result = loginManager.login(username, password);
                
                if (result.success) {
                    document.getElementById('loginContainer').classList.add('hidden');
                    document.getElementById('adminDashboard').style.display = 'block';
                    initializeAdminDashboard();
                } else {
                    const errorElement = document.getElementById('loginError');
                    errorElement.textContent = result.message;
                    errorElement.style.display = 'block';
                    
                    setTimeout(() => {
                        errorElement.style.display = 'none';
                    }, 3000);
                }
            });
        }

        // ==================== ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ====================
        function initializeAdminDashboard() {
            console.log('ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
            
            if (!document.getElementById('ordersTableBody')) {
                console.error('DOM ìš”ì†Œê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. 100ms í›„ ì¬ì‹œë„');
                setTimeout(initializeAdminDashboard, 100);
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const dateFrom = document.getElementById('dateFrom');
            const dateTo = document.getElementById('dateTo');
            
            if (dateFrom) dateFrom.value = today;
            if (dateTo) dateTo.value = today;
            
            currentLang = 'ko';
            
            updateTelegramBotsList();
            
            setupEventListeners();
            
            loadAllData();
            
            try {
                updateAllText();
            } catch (error) {
                console.error('í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì—ëŸ¬:', error);
                setTimeout(updateAllText, 100);
            }
            
            startSyncCheck();
            startNotificationCheck();
            console.log('ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        function startSyncCheck() {
            if (syncCheckInterval) clearInterval(syncCheckInterval);
            
            checkDataSync();
            
            syncCheckInterval = setInterval(() => {
                checkDataSync();
            }, 3000);
        }

        function showNotification(message) {
            console.log('ğŸ”” ì•Œë¦¼:', message);
        }

        // ==================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ====================
        function setupEventListeners() {
            document.getElementById('langSwitchBtn').addEventListener('click', toggleLanguage);
            
            document.getElementById('logoutBtn').addEventListener('click', function() {
                const confirmMessage = currentLang === 'en' ? 
                    'Are you sure you want to logout?' : 
                    'ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
                
                if (confirm(confirmMessage)) {
                    loginManager.logout();
                    showLoginScreen();
                }
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', switchTab);
            });
            
            document.getElementById('statusFilter').addEventListener('change', updateOrders);
            document.getElementById('searchOrder').addEventListener('input', updateOrders);
            document.getElementById('dateFrom').addEventListener('change', updateOrders);
            document.getElementById('dateTo').addEventListener('change', updateOrders);
            document.getElementById('refreshOrders').addEventListener('click', () => loadAllData());
            document.getElementById('exportOrders').addEventListener('click', exportOrdersToExcel);
            
            document.getElementById('walletStatusFilter').addEventListener('change', updateWallets);
            document.getElementById('walletNetworkFilter').addEventListener('change', updateWallets);
            document.getElementById('refreshWallets').addEventListener('click', () => loadAllData());
            document.getElementById('addWallet').addEventListener('click', openAddWalletModal);
            
            document.getElementById('closeDetailModal').addEventListener('click', closeOrderDetail);
            document.getElementById('closeWalletModal').addEventListener('click', closeWalletModal);
            document.getElementById('cancelWalletModal').addEventListener('click', closeWalletModal);
            document.getElementById('closeTelegramBotModal').addEventListener('click', closeTelegramBotModal);
            document.getElementById('cancelTelegramBotModal').addEventListener('click', closeTelegramBotModal);
            
            document.getElementById('saveWallet').addEventListener('click', saveWallet);
            document.getElementById('walletQRCode').addEventListener('change', handleQRCodeUpload);
            
            document.getElementById('saveTelegramBot').addEventListener('click', saveTelegramBot);
            
            document.getElementById('addTelegramBot').addEventListener('click', openAddTelegramBotModal);
            
            document.getElementById('walletForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveWallet();
            });
            
            document.getElementById('telegramBotForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveTelegramBot();
            });
        }

        // ==================== ì–¸ì–´ ê´€ë ¨ ====================
        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ko' : 'en';
            updateAllText();
        }

        function updateAllText() {
            const trans = translations[currentLang];
            
            const elements = [
                { id: 'adminTitle', prop: 'textContent', value: trans.adminTitle },
                { id: 'adminSubtitle', prop: 'textContent', value: trans.adminSubtitle },
                { id: 'langSwitchText', prop: 'textContent', value: trans.langSwitchText },
                { id: 'logoutText', prop: 'textContent', value: trans.logoutText },
                { id: 'statTotalOrders', prop: 'textContent', value: trans.statTotalOrders },
                { id: 'statWaiting', prop: 'textContent', value: trans.statWaiting },
                { id: 'statActiveWallets', prop: 'textContent', value: trans.statActiveWallets },
                { id: 'statTodayRevenue', prop: 'textContent', value: trans.statTodayRevenue },
                { id: 'statTodayAmount', prop: 'textContent', value: trans.statTodayAmount },
                { id: 'ordersTitle', prop: 'textContent', value: trans.ordersTitle },
                { id: 'walletsTitle', prop: 'textContent', value: trans.walletsTitle },
                { id: 'noOrdersText', prop: 'textContent', value: trans.noOrdersText },
                { id: 'noWalletsText', prop: 'textContent', value: trans.noWalletsText },
                { id: 'exportOrders', prop: 'textContent', value: trans.exportBtn },
                { id: 'refreshOrders', prop: 'textContent', value: trans.refreshBtn },
                { id: 'addWallet', prop: 'textContent', value: trans.addWalletBtn },
                { id: 'walletGuideTitle', prop: 'textContent', value: trans.walletGuideTitle },
                { id: 'orderDetailTitle', prop: 'textContent', value: trans.orderDetailTitle },
                { id: 'walletModalTitle', prop: 'textContent', value: trans.walletModalTitle },
                { id: 'labelWalletName', prop: 'textContent', value: trans.labelWalletName },
                { id: 'labelNetwork', prop: 'textContent', value: trans.labelNetwork },
                { id: 'labelStatus', prop: 'textContent', value: trans.labelStatus },
                { id: 'labelAddress', prop: 'textContent', value: trans.labelAddress },
                { id: 'addressHelp', prop: 'textContent', value: trans.addressHelp },
                { id: 'labelQRCode', prop: 'textContent', value: trans.labelQRCode },
                { id: 'qrCodeHelp', prop: 'textContent', value: trans.qrCodeHelp },
                { id: 'labelMemo', prop: 'textContent', value: trans.labelMemo },
                { id: 'saveWallet', prop: 'textContent', value: trans.saveBtn },
                { id: 'cancelWalletModal', prop: 'textContent', value: trans.cancelBtn },
                { id: 'syncStatusText', prop: 'textContent', value: trans.syncStatusText },
                { id: 'statTotalChange', prop: 'textContent', value: trans.statTotalChange },
                { id: 'waitingChange', prop: 'textContent', value: trans.waitingChange },
                { id: 'walletsChange', prop: 'textContent', value: trans.walletsChange },
                { id: 'revenueChange', prop: 'textContent', value: trans.revenueChange },
                { id: 'amountChange', prop: 'textContent', value: trans.amountChange },
                { id: 'telegramBotModalTitle', prop: 'textContent', value: trans.telegramBotModalTitle }
            ];
            
            elements.forEach(element => {
                const el = document.getElementById(element.id);
                if (el) {
                    el[element.prop] = element.value;
                }
            });
            
            const tabButtons = document.querySelectorAll('.tab-button');
            if (tabButtons[0]) tabButtons[0].textContent = 'ğŸ“‹ ' + (currentLang === 'en' ? 'Order Management' : 'ì£¼ë¬¸ ê´€ë¦¬');
            if (tabButtons[1]) tabButtons[1].textContent = 'ğŸ‘› ' + (currentLang === 'en' ? 'Wallet Management' : 'ì§€ê°‘ ê´€ë¦¬');
            
            const searchOrder = document.getElementById('searchOrder');
            if (searchOrder) searchOrder.placeholder = trans.searchPlaceholder;
            
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.innerHTML = `
                    <option value="all">${trans.statusAll}</option>
                    <option value="ì…ê¸ˆëŒ€ê¸°">${trans.statusWaiting}</option>
                    <option value="ì…ê¸ˆí™•ì¸">${trans.statusConfirmed}</option>
                    <option value="ì²˜ë¦¬ì¤‘">${trans.statusProcessing}</option>
                    <option value="ì™„ë£Œ">${trans.statusCompleted}</option>
                    <option value="ì·¨ì†Œ">${trans.statusCancelled}</option>
                `;
            }
            
            const walletGuideList = document.getElementById('walletGuideList');
            if (walletGuideList) {
                let guideListHtml = '';
                trans.walletGuideList.forEach(item => {
                    guideListHtml += `<li>${item}</li>`;
                });
                walletGuideList.innerHTML = guideListHtml;
            }
            
            const headers = [
                { id: 'thOrderId', value: trans.thOrderId },
                { id: 'thTime', value: trans.thTime },
                { id: 'thAmount', value: trans.thAmount },
                { id: 'thWallet', value: trans.thWallet },
                { id: 'thStatus', value: trans.thStatus },
                { id: 'thStep', value: trans.thStep },
                { id: 'thProof', value: trans.thProof },
                { id: 'thAction', value: trans.thAction },
                { id: 'thWalletName', value: trans.thWalletName },
                { id: 'thNetwork', value: trans.thNetwork },
                { id: 'thAddress', value: trans.thAddress },
                { id: 'thQRCode', value: trans.thQRCode },
                { id: 'thWalletStatus', value: trans.thWalletStatus },
                { id: 'thCreated', value: trans.thCreated },
                { id: 'thWalletAction', value: trans.thWalletAction }
            ];
            
            headers.forEach(header => {
                const el = document.getElementById(header.id);
                if (el) el.textContent = header.value;
            });
            
            const botModalLabels = [
                { selector: '#telegramBotModalTitle', value: trans.telegramBotModalTitle },
                { selector: '#telegramBotForm label[for="botName"]', value: trans.botNameLabel },
                { selector: '#telegramBotForm label[for="botToken"]', value: trans.botTokenLabel },
                { selector: '#telegramBotForm label[for="botChatId"]', value: trans.botChatIdLabel },
                { selector: '#telegramBotForm label[for="notifyNewOrders"]', value: trans.botNotifyNewOrders },
                { selector: '#telegramBotForm label[for="notifyStatusChanges"]', value: trans.botNotifyStatusChanges },
                { selector: '#telegramBotForm label[for="notifyTestMessages"]', value: trans.botNotifyTestMessages },
                { selector: '#telegramBotForm label[for="botEnabled"]', value: trans.botEnabledText }
            ];
            
            botModalLabels.forEach(label => {
                const el = document.querySelector(label.selector);
                if (el) {
                    if (el.tagName === 'LABEL') {
                        el.textContent = label.value;
                    } else {
                        el.textContent = label.value;
                    }
                }
            });
            
            updateOrders();
            updateWallets();
            updateTelegramBotsList();
        }

        // ==================== í…”ë ˆê·¸ë¨ ë´‡ ê´€ë¦¬ ====================
        function updateTelegramBotsList() {
            const botsList = document.getElementById('telegramBotsList');
            if (!botsList) return;
            
            const bots = telegramNotifier.bots;
            const trans = translations[currentLang];
            
            if (bots.length === 0) {
                botsList.innerHTML = `
                    <div class="telegram-bot-item">
                        <div class="telegram-bot-info">
                            <div class="telegram-bot-name">${trans.noBotsText}</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            bots.forEach(bot => {
                const statusText = bot.enabled ? trans.botActiveStatus : trans.botInactiveStatus;
                const statusClass = bot.enabled ? 'bot-active' : 'bot-inactive';
                const chatCount = Array.isArray(bot.chatIds) ? bot.chatIds.length : 1;
                
                const notificationTypes = [];
                if (bot.notifyNewOrders) notificationTypes.push(trans.botNotifyNewOrders);
                if (bot.notifyStatusChanges) notificationTypes.push(trans.botNotifyStatusChanges);
                if (bot.notifyTestMessages) notificationTypes.push(trans.botNotifyTestMessages);
                
                html += `
                    <div class="telegram-bot-item">
                        <div class="telegram-bot-info">
                            <div class="telegram-bot-name">
                                ${bot.name}
                                <span style="font-size: 12px; color: ${bot.enabled ? '#27ae60' : '#95a5a6'}; margin-left: 10px;">
                                    ${statusText}
                                </span>
                            </div>
                            <div class="telegram-bot-details">
                                ì±„íŒ…ë°©: ${chatCount}ê°œ | ì•Œë¦¼: ${notificationTypes.join(', ')}
                            </div>
                        </div>
                        <div class="telegram-bot-actions">
                            <button class="bot-action-btn bot-test-btn" onclick="testTelegramBot('${bot.id}')">
                                ${trans.botTestButton}
                            </button>
                            <button class="bot-action-btn bot-edit-btn" onclick="editTelegramBot('${bot.id}')">
                                ${trans.botEditButton}
                            </button>
                            <button class="bot-action-btn bot-delete-btn" onclick="deleteTelegramBot('${bot.id}')">
                                ${trans.botDeleteButton}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            botsList.innerHTML = html;
        }

        function openAddTelegramBotModal() {
            const trans = translations[currentLang];
            const title = document.getElementById('telegramBotModalTitle');
            if (title) title.textContent = trans.telegramBotModalTitle;
            
            const form = document.getElementById('telegramBotForm');
            if (form) form.reset();
            
            const botId = document.getElementById('botId');
            if (botId) botId.value = '';
            
            selectedBot = null;
            
            document.getElementById('notifyNewOrders').checked = true;
            document.getElementById('notifyStatusChanges').checked = true;
            document.getElementById('notifyTestMessages').checked = true;
            document.getElementById('botEnabled').checked = true;
            
            const modal = document.getElementById('telegramBotModal');
            if (modal) modal.classList.remove('hidden');
        }

        function editTelegramBot(botId) {
            const bot = telegramNotifier.bots.find(b => b.id === botId);
            if (!bot) return;
            
            selectedBot = bot;
            
            const trans = translations[currentLang];
            const title = document.getElementById('telegramBotModalTitle');
            if (title) title.textContent = trans.telegramBotModalTitle + ' ìˆ˜ì •';
            
            const botIdInput = document.getElementById('botId');
            if (botIdInput) botIdInput.value = bot.id;
            
            document.getElementById('botName').value = bot.name;
            document.getElementById('botToken').value = bot.token;
            document.getElementById('botChatId').value = Array.isArray(bot.chatIds) ? bot.chatIds.join(', ') : bot.chatIds;
            document.getElementById('notifyNewOrders').checked = bot.notifyNewOrders !== false;
            document.getElementById('notifyStatusChanges').checked = bot.notifyStatusChanges !== false;
            document.getElementById('notifyTestMessages').checked = bot.notifyTestMessages !== false;
            document.getElementById('botEnabled').checked = bot.enabled !== false;
            
            const modal = document.getElementById('telegramBotModal');
            if (modal) modal.classList.remove('hidden');
        }

        async function saveTelegramBot() {
            const botName = document.getElementById('botName').value.trim();
            const botToken = document.getElementById('botToken').value.trim();
            const botChatId = document.getElementById('botChatId').value.trim();
            const notifyNewOrders = document.getElementById('notifyNewOrders').checked;
            const notifyStatusChanges = document.getElementById('notifyStatusChanges').checked;
            const notifyTestMessages = document.getElementById('notifyTestMessages').checked;
            const botEnabled = document.getElementById('botEnabled').checked;
            
            if (!botName || !botToken || !botChatId) {
                showTelegramStatus('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const chatIds = botChatId.split(',').map(id => id.trim()).filter(id => id);
            
            const botData = {
                id: selectedBot ? selectedBot.id : 'bot_' + Date.now(),
                name: botName,
                token: botToken,
                chatIds: chatIds,
                notifyNewOrders: notifyNewOrders,
                notifyStatusChanges: notifyStatusChanges,
                notifyTestMessages: notifyTestMessages,
                enabled: botEnabled,
                createdAt: selectedBot ? selectedBot.createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            let success;
            if (selectedBot) {
                success = telegramNotifier.updateBot(selectedBot.id, botData);
            } else {
                success = telegramNotifier.addBot(botData);
            }
            
            if (success) {
                updateTelegramBotsList();
                closeTelegramBotModal();
                
                const message = selectedBot ? 
                    'í…”ë ˆê·¸ë¨ ë´‡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 
                    'í…”ë ˆê·¸ë¨ ë´‡ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                showTelegramStatus(message, 'success');
            } else {
                showTelegramStatus('í…”ë ˆê·¸ë¨ ë´‡ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        async function testTelegramBot(botId) {
            const result = await telegramNotifier.sendTestNotification(botId);
            
            if (result.success) {
                showTelegramStatus(`âœ… ${result.botName} í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            } else {
                showTelegramStatus(`âŒ ${result.botName} í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨: ${result.error}`, 'error');
            }
        }

        async function testAllTelegramBots() {
            const result = await telegramNotifier.sendTestNotification();
            
            if (result.success) {
                showTelegramStatus(`âœ… ${result.successCount}/${result.totalCount} ê°œì˜ ë´‡ì—ì„œ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            } else if (result.successCount > 0) {
                showTelegramStatus(`âš ï¸ ${result.successCount}/${result.totalCount} ê°œì˜ ë´‡ì—ì„œ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì¼ë¶€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`, 'error');
            } else {
                showTelegramStatus('âŒ ëª¨ë“  ë´‡ì—ì„œ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function deleteTelegramBot(botId) {
            const bot = telegramNotifier.bots.find(b => b.id === botId);
            if (!bot) return;
            
            const confirmMessage = currentLang === 'en' ?
                `Delete this Telegram bot?\n\nBot: ${bot.name}` :
                `ì´ í…”ë ˆê·¸ë¨ ë´‡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në´‡: ${bot.name}`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const success = telegramNotifier.deleteBot(botId);
            
            if (success) {
                updateTelegramBotsList();
                showTelegramStatus('í…”ë ˆê·¸ë¨ ë´‡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                showTelegramStatus('í…”ë ˆê·¸ë¨ ë´‡ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function closeTelegramBotModal() {
            const modal = document.getElementById('telegramBotModal');
            if (modal) modal.classList.add('hidden');
            selectedBot = null;
        }

        function showTelegramStatus(message, type) {
            const statusElement = document.getElementById('telegramStatus');
            statusElement.textContent = message;
            statusElement.className = 'telegram-status ' + type;
            
            setTimeout(() => {
                statusElement.className = 'telegram-status';
                statusElement.textContent = '';
            }, 3000);
        }

        // ==================== ë°ì´í„° ë¡œë“œ ====================
        function loadAllData() {
            allOrders = dataManager.getOrders();
            console.log('ê´€ë¦¬ì: ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ', allOrders.length, 'ê°œ');
            
            allWallets = dataManager.getWallets();
            console.log('ê´€ë¦¬ì: ì§€ê°‘ ë°ì´í„° ë¡œë“œ', allWallets.length, 'ê°œ');
            
            updateStats();
            updateOrders();
            updateWallets();
            
            dataManager.updateAdminSync();
            dataManager.saveLastNotificationTime();
        }

        // ==================== í†µê³„ ì—…ë°ì´íŠ¸ ====================
        function updateStats() {
            const totalOrders = allOrders.length;
            const waitingOrders = allOrders.filter(o => o.status === 'ì…ê¸ˆëŒ€ê¸°').length;
            const activeWallets = allWallets.filter(w => w.isActive).length;
            
            const today = new Date().toISOString().split('T')[0];
            
            const todayOrders = allOrders.filter(o => {
                const orderDate = o.time.split('T')[0];
                return orderDate === today && o.status === 'ì™„ë£Œ';
            });
            
            let todayAmountTHB = 0;
            let todayAmountUSDT = 0;
            let todayRevenueUSDT = 0;
            
            todayOrders.forEach(order => {
                todayAmountTHB += order.amount;
                todayAmountUSDT += order.usdt;
                const feeUSDT = order.usdt * 0.03;
                todayRevenueUSDT += feeUSDT;
            });
            
            const exchangeRate = 35;
            const todayRevenueTHB = Math.round(todayRevenueUSDT * exchangeRate);
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('waitingOrders').textContent = waitingOrders;
            document.getElementById('activeWallets').textContent = activeWallets;
            
            const revenueElement = document.getElementById('todayRevenue');
            if (revenueElement) {
                revenueElement.textContent = todayRevenueTHB.toLocaleString() + ' THB';
            }
            
            const revenueUSDTElement = document.getElementById('todayRevenueUSDT');
            if (revenueUSDTElement) {
                revenueUSDTElement.textContent = '(' + todayRevenueUSDT.toFixed(2) + ' USDT)';
            } else {
                const statCard = document.querySelector('.stat-card:nth-child(4)');
                if (statCard) {
                    const usdtElement = document.createElement('div');
                    usdtElement.id = 'todayRevenueUSDT';
                    usdtElement.style.fontSize = '16px';
                    usdtElement.style.color = '#7f8c8d';
                    usdtElement.style.marginTop = '5px';
                    statCard.appendChild(usdtElement);
                    usdtElement.textContent = '(' + todayRevenueUSDT.toFixed(2) + ' USDT)';
                }
            }
            
            const amountElement = document.getElementById('todayAmount');
            if (amountElement) {
                amountElement.textContent = todayAmountTHB.toLocaleString() + ' THB';
            }
            
            const amountUSDTElement = document.getElementById('todayAmountUSDT');
            if (amountUSDTElement) {
                amountUSDTElement.textContent = '(' + todayAmountUSDT.toFixed(2) + ' USDT)';
            } else {
                const statCard = document.querySelector('.stat-card:nth-child(5)');
                if (statCard) {
                    const usdtElement = document.createElement('div');
                    usdtElement.id = 'todayAmountUSDT';
                    usdtElement.style.fontSize = '16px';
                    usdtElement.style.color = '#7f8c8d';
                    usdtElement.style.marginTop = '5px';
                    statCard.appendChild(usdtElement);
                    usdtElement.textContent = '(' + todayAmountUSDT.toFixed(2) + ' USDT)';
                }
            }
            
            const trans = translations[currentLang];
            document.getElementById('waitingChange').textContent = `${waitingOrders} ${trans.waitingChange}`;
            document.getElementById('walletsChange').textContent = `${activeWallets} ${trans.walletsChange}`;
            
            if (waitingOrders > 0) {
                document.getElementById('waitingChange').classList.remove('negative');
            } else {
                document.getElementById('waitingChange').classList.add('negative');
            }
        }

        // ==================== ì£¼ë¬¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ====================
        function updateOrders() {
            currentFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchOrder').value.toLowerCase();
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let filteredOrders = [...allOrders];
            
            if (currentFilter !== 'all') {
                filteredOrders = filteredOrders.filter(o => o.status === currentFilter);
            }
            
            if (searchTerm) {
                filteredOrders = filteredOrders.filter(o => 
                    o.id.toLowerCase().includes(searchTerm)
                );
            }
            
            if (dateFrom && dateTo) {
                filteredOrders = filteredOrders.filter(o => {
                    const orderDate = o.time.split('T')[0];
                    return orderDate >= dateFrom && orderDate <= dateTo;
                });
            }
            
            filteredOrders.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            const ordersTableBody = document.getElementById('ordersTableBody');
            
            if (!ordersTableBody) return;
            
            if (filteredOrders.length === 0) {
                const trans = translations[currentLang];
                ordersTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="no-orders">${trans.noOrdersText}</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredOrders.forEach(order => {
                const time = new Date(order.time).toLocaleString('ko-KR', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusClass = {
                    'ì…ê¸ˆëŒ€ê¸°': 'status-waiting',
                    'ì…ê¸ˆí™•ì¸': 'status-confirmed',
                    'ì²˜ë¦¬ì¤‘': 'status-processing',
                    'ì™„ë£Œ': 'status-completed',
                    'ì·¨ì†Œ': 'status-cancelled'
                }[order.status] || 'status-waiting';
                
                const statusText = {
                    'ì…ê¸ˆëŒ€ê¸°': currentLang === 'en' ? 'Waiting Deposit' : 'ì…ê¸ˆëŒ€ê¸°',
                    'ì…ê¸ˆí™•ì¸': currentLang === 'en' ? 'Deposit Confirmed' : 'ì…ê¸ˆí™•ì¸',
                    'ì²˜ë¦¬ì¤‘': currentLang === 'en' ? 'Processing' : 'ì²˜ë¦¬ì¤‘',
                    'ì™„ë£Œ': currentLang === 'en' ? 'Completed' : 'ì™„ë£Œ',
                    'ì·¨ì†Œ': currentLang === 'en' ? 'Cancelled' : 'ì·¨ì†Œ'
                }[order.status] || order.status;
                
                const stepProgress = Math.min(100, (order.step || 1) * 25);
                
                const hasProof = order.proof && order.proof.data;
                const proofText = currentLang === 'en' ? 'View' : 'ë³´ê¸°';
                const proofButton = hasProof ? 
                    `<button class="action-button action-view" onclick="event.stopPropagation(); viewProof('${order.id}')">${proofText}</button>` :
                    currentLang === 'en' ? 'None' : 'ì—†ìŒ';
                
                const walletInfo = order.wallet ? 
                    `${order.wallet.name} (${order.wallet.network})` : 
                    currentLang === 'en' ? 'Not specified' : 'ì§€ì •ë˜ì§€ ì•ŠìŒ';
                
                const stepText = getStepText(order.step || 1);
                
                const confirmText = currentLang === 'en' ? 'Confirm Deposit' : 'ì…ê¸ˆ í™•ì¸';
                const cancelText = currentLang === 'en' ? 'Cancel' : 'ì·¨ì†Œ';
                const processText = currentLang === 'en' ? 'Start Process' : 'ì²˜ë¦¬ ì‹œì‘';
                const completeText = currentLang === 'en' ? 'Complete' : 'ì™„ë£Œ';
                const resetText = currentLang === 'en' ? 'Reset' : 'ì¬ì„¤ì •';
                
                html += `
                    <tr onclick="showOrderDetail('${order.id}')" style="cursor: pointer;">
                        <td>
                            <div class="order-id">${order.id}</div>
                        </td>
                        <td>
                            <div class="order-time">${time}</div>
                        </td>
                        <td>
                            <div class="amount-display">${order.amount.toLocaleString()} THB</div>
                        </td>
                        <td>
                            <div>${walletInfo}</div>
                        </td>
                        <td>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </td>
                        <td>
                            <div>${stepText}</div>
                            <div class="progress-indicator">
                                <div class="progress-bar" style="width: ${stepProgress}%"></div>
                            </div>
                        </td>
                        <td>
                            ${proofButton}
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${order.status === 'ì…ê¸ˆëŒ€ê¸°' ? `
                                    <button class="action-button action-confirm" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì…ê¸ˆí™•ì¸')">${confirmText}</button>
                                    <button class="action-button action-cancel" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                                ` : ''}
                                ${order.status === 'ì…ê¸ˆí™•ì¸' ? `
                                    <button class="action-button action-process" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì²˜ë¦¬ì¤‘')">${processText}</button>
                                    <button class="action-button action-cancel" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                                ` : ''}
                                ${order.status === 'ì²˜ë¦¬ì¤‘' ? `
                                    <button class="action-button action-complete" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì™„ë£Œ')">${completeText}</button>
                                ` : ''}
                                ${['ì™„ë£Œ', 'ì·¨ì†Œ'].includes(order.status) ? `
                                    <button class="action-button action-reset" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ì…ê¸ˆëŒ€ê¸°')">${resetText}</button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            ordersTableBody.innerHTML = html;
        }

        function getStepText(step) {
            if (currentLang === 'en') {
                switch(step) {
                    case 1: return 'Waiting USDT Transfer';
                    case 2: return 'Verifying Deposit';
                    case 3: return 'Processing THB';
                    case 4: return 'Completed';
                    default: return 'Waiting';
                }
            } else {
                switch(step) {
                    case 1: return 'USDT ì „ì†¡ ëŒ€ê¸°';
                    case 2: return 'ì…ê¸ˆ í™•ì¸ ì¤‘';
                    case 3: return 'THB ì²˜ë¦¬ ì¤‘';
                    case 4: return 'ì™„ë£Œ';
                    default: return 'ëŒ€ê¸°ì¤‘';
                }
            }
        }

        // ==================== ì§€ê°‘ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ====================
        function updateWallets() {
            const statusFilter = document.getElementById('walletStatusFilter').value;
            const networkFilter = document.getElementById('walletNetworkFilter').value;
            
            let filteredWallets = [...allWallets];
            
            if (statusFilter !== 'all') {
                filteredWallets = filteredWallets.filter(w => 
                    statusFilter === 'active' ? w.isActive : !w.isActive
                );
            }
            
            if (networkFilter !== 'all') {
                filteredWallets = filteredWallets.filter(w => w.network === networkFilter);
            }
            
            filteredWallets.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            const walletsTableBody = document.getElementById('walletsTableBody');
            if (!walletsTableBody) return;
            
            if (filteredWallets.length === 0) {
                const trans = translations[currentLang];
                walletsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-wallets">${trans.noWalletsText}</td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredWallets.forEach(wallet => {
                const networkClass = `network-${wallet.network.toLowerCase()}`;
                const createdDate = new Date(wallet.createdAt).toLocaleDateString('ko-KR');
                
                const statusText = wallet.isActive ? 
                    (currentLang === 'en' ? 'Active' : 'í™œì„±') : 
                    (currentLang === 'en' ? 'Inactive' : 'ë¹„í™œì„±');
                const statusClass = wallet.isActive ? 'wallet-active' : 'wallet-inactive';
                
                const defaultBadgeText = currentLang === 'en' ? 'Default' : 'ê¸°ë³¸';
                const defaultBadge = wallet.isDefault ? `<span class="default-wallet-badge">${defaultBadgeText}</span>` : '';
                
                let qrDisplay = '';
                if (wallet.qrCode && 
                    wallet.qrCode !== 'null' && 
                    wallet.qrCode !== '' && 
                    wallet.qrCode !== null &&
                    typeof wallet.qrCode === 'string' && 
                    wallet.qrCode.startsWith('data:image/')) {
                    
                    qrDisplay = `
                        <div class="qr-code-small">
                            <img src="${wallet.qrCode}" 
                                 alt="Wallet QR Code" 
                                 style="max-width: 80px; max-height: 80px;"
                                 onerror="this.style.display='none';this.parentElement.innerHTML='<div style=\"color:#999;font-size:12px;\">ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜</div>'">
                        </div>
                    `;
                } else {
                    qrDisplay = '<div style="text-align: center; color: #999; font-size: 12px;">ì—†ìŒ</div>';
                }
                
                const shortAddress = wallet.address.length > 20 ? 
                    wallet.address.substring(0, 10) + '...' + wallet.address.substring(wallet.address.length - 10) : 
                    wallet.address;
                
                const editText = currentLang === 'en' ? 'Edit' : 'ìˆ˜ì •';
                const deleteText = currentLang === 'en' ? 'Delete' : 'ì‚­ì œ';
                const deactivateText = currentLang === 'en' ? 'Deactivate' : 'ë¹„í™œì„±í™”';
                const activateText = currentLang === 'en' ? 'Activate' : 'í™œì„±í™”';
                const setDefaultText = currentLang === 'en' ? 'Set Default' : 'ê¸°ë³¸ ì„¤ì •';
                
                html += `
                    <tr>
                        <td>
                            <div style="font-weight: bold; color: #2c3e50;">
                                ${wallet.name} ${defaultBadge}
                            </div>
                            ${wallet.memo ? `<div style="font-size: 12px; color: #718096; margin-top: 5px;">${wallet.memo}</div>` : ''}
                        </td>
                        <td>
                            <span class="network-badge ${networkClass}">${wallet.network}</span>
                        </td>
                        <td>
                            <div style="font-size: 12px; color: #2c3e50;">${shortAddress}</div>
                            <div class="wallet-address" title="${wallet.address}">
                                ${wallet.address}
                            </div>
                        </td>
                        <td>${qrDisplay}</td>
                        <td>
                            <span class="wallet-status ${statusClass}">
                                ${wallet.isActive ? '<span class="active-wallet-indicator"></span>' : ''}
                                ${statusText}
                            </span>
                        </td>
                        <td>${createdDate}</td>
                        <td>
                            <div class="wallet-actions">
                                <button class="action-button action-edit" onclick="editWallet('${wallet.id}')">${editText}</button>
                                ${!wallet.isDefault ? `
                                    <button class="action-button action-delete" onclick="deleteWallet('${wallet.id}')">${deleteText}</button>
                                ` : ''}
                                ${wallet.isActive ? 
                                    `<button class="action-button action-deactivate" onclick="toggleWalletStatus('${wallet.id}', false)">${deactivateText}</button>` :
                                    `<button class="action-button action-activate" onclick="toggleWalletStatus('${wallet.id}', true)">${activateText}</button>`
                                }
                                ${!wallet.isDefault ? 
                                    `<button class="action-button action-setdefault" onclick="setDefaultWallet('${wallet.id}')">${setDefaultText}</button>` : 
                                    ''
                                }
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            walletsTableBody.innerHTML = html;
        }

        // ==================== ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ====================
        async function updateOrderStatus(orderId, newStatus) {
            const statusText = {
                'ì…ê¸ˆëŒ€ê¸°': currentLang === 'en' ? 'Waiting Deposit' : 'ì…ê¸ˆëŒ€ê¸°',
                'ì…ê¸ˆí™•ì¸': currentLang === 'en' ? 'Deposit Confirmed' : 'ì…ê¸ˆí™•ì¸',
                'ì²˜ë¦¬ì¤‘': currentLang === 'en' ? 'Processing' : 'ì²˜ë¦¬ì¤‘',
                'ì™„ë£Œ': currentLang === 'en' ? 'Completed' : 'ì™„ë£Œ',
                'ì·¨ì†Œ': currentLang === 'en' ? 'Cancelled' : 'ì·¨ì†Œ'
            }[newStatus] || newStatus;
            
            const confirmMessage = currentLang === 'en' ?
                `Change order ${orderId} status to "${statusText}"?` :
                `ì£¼ë¬¸ ${orderId}ì˜ ìƒíƒœë¥¼ "${statusText}"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            let orderIndex = allOrders.findIndex(o => o.id === orderId);
            
            if (orderIndex === -1) {
                alert(currentLang === 'en' ? 'Order not found' : 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const oldStatus = allOrders[orderIndex].status;
            const newStep = getStepFromStatus(newStatus);
            
            allOrders[orderIndex] = {
                ...allOrders[orderIndex],
                status: newStatus,
                step: newStep,
                updated: new Date().toISOString()
            };
            
            dataManager.saveOrders(allOrders);
            
            if (newStatus === 'ì…ê¸ˆí™•ì¸' && oldStatus !== 'ì…ê¸ˆí™•ì¸') {
                console.log(`ğŸ“¨ ì£¼ë¬¸ ${orderId} ì…ê¸ˆí™•ì¸ - í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì „ì†¡`);
                
                try {
                    await telegramNotifier.sendNewOrderNotification(allOrders[orderIndex]);
                } catch (error) {
                    console.error('í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨:', error);
                }
            }
            
            if (oldStatus !== newStatus && newStatus !== 'ì…ê¸ˆí™•ì¸') {
                await telegramNotifier.sendStatusChangeNotification(orderId, oldStatus, newStatus);
            }
            
            updateStats();
            updateOrders();
            dataManager.notifyUserPage(orderId, newStatus);
            
            const successMessage = currentLang === 'en' ?
                `Order status changed to "${statusText}"` :
                `ì£¼ë¬¸ ìƒíƒœê°€ "${statusText}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`;
            alert(successMessage);
            
            if (selectedOrder && selectedOrder.id === orderId) {
                closeOrderDetail();
            }
        }

        function getStepFromStatus(status) {
            switch(status) {
                case 'ì…ê¸ˆëŒ€ê¸°': return 1;
                case 'ì…ê¸ˆí™•ì¸': return 2;
                case 'ì²˜ë¦¬ì¤‘': return 3;
                case 'ì™„ë£Œ': return 4;
                case 'ì·¨ì†Œ': return 1;
                default: return 1;
            }
        }

        // ==================== ì¦ëª…ì„œ ë³´ê¸° ====================
        function viewProof(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order || !order.proof || !order.proof.data) {
                alert(currentLang === 'en' ? 'No proof document' : 'ì¦ëª…ì„œê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const proofWindow = window.open('', '_blank');
            const title = currentLang === 'en' ? 'Payment Proof' : 'ê²°ì œ ì¦ëª…ì„œ';
            
            proofWindow.document.write(`
                <html>
                <head>
                    <title>${title} - ${order.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .info { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${title}</h1>
                        <p>${currentLang === 'en' ? 'Order ID:' : 'ì£¼ë¬¸ ID:'} ${order.id}</p>
                    </div>
                    <div class="info">
                        <p><strong>${currentLang === 'en' ? 'Amount:' : 'ê¸ˆì•¡:'}</strong> ${order.amount.toLocaleString()} THB</p>
                        <p><strong>USDT:</strong> ${order.usdt.toFixed(4)} USDT</p>
                        <p><strong>${currentLang === 'en' ? 'Upload Time:' : 'ì—…ë¡œë“œ ì‹œê°„:'}</strong> ${new Date(order.time).toLocaleString()}</p>
                    </div>
                    ${order.proof.type.startsWith('image/') ? 
                        `<img src="${order.proof.data}" style="max-width: 100%; border: 1px solid #ddd; border-radius: 8px;">` : 
                        `<p>${currentLang === 'en' ? 'File Name:' : 'íŒŒì¼ëª…:'} ${order.proof.name}</p><p>${currentLang === 'en' ? 'File Size:' : 'íŒŒì¼ í¬ê¸°:'} ${(order.proof.size / 1024).toFixed(1)}KB</p>`
                    }
                </body>
                </html>
            `);
        }

        // ==================== íƒ­ ì „í™˜ ====================
        function switchTab(e) {
            const tabId = e.target.dataset.tab;
            currentTab = tabId;
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            e.target.classList.add('active');
            
            document.getElementById('ordersTab').classList.remove('active');
            document.getElementById('walletsTab').classList.remove('active');
            
            if (tabId === 'orders') {
                document.getElementById('ordersTab').classList.add('active');
            } else if (tabId === 'wallets') {
                document.getElementById('walletsTab').classList.add('active');
            }
        }

        // ==================== ì£¼ë¬¸ ìƒì„¸ ì •ë³´ ====================
        function showOrderDetail(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) {
                alert(currentLang === 'en' ? 'Order not found' : 'ì£¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            selectedOrder = order;
            
            const createdTime = new Date(order.time).toLocaleString('ko-KR');
            const updatedTime = order.updated ? new Date(order.updated).toLocaleString('ko-KR') : 
                (currentLang === 'en' ? 'None' : 'ì—†ìŒ');
            
            let proofInfo = currentLang === 'en' ? 'None' : 'ì—†ìŒ';
            if (order.proof && order.proof.data) {
                proofInfo = order.proof.type.startsWith('image/') ? 
                    (currentLang === 'en' ? 'Image file' : 'ì´ë¯¸ì§€ íŒŒì¼') : 
                    order.proof.name;
            }
            
            const statusText = {
                'ì…ê¸ˆëŒ€ê¸°': currentLang === 'en' ? 'Waiting Deposit' : 'ì…ê¸ˆëŒ€ê¸°',
                'ì…ê¸ˆí™•ì¸': currentLang === 'en' ? 'Deposit Confirmed' : 'ì…ê¸ˆí™•ì¸',
                'ì²˜ë¦¬ì¤‘': currentLang === 'en' ? 'Processing' : 'ì²˜ë¦¬ì¤‘',
                'ì™„ë£Œ': currentLang === 'en' ? 'Completed' : 'ì™„ë£Œ',
                'ì·¨ì†Œ': currentLang === 'en' ? 'Cancelled' : 'ì·¨ì†Œ'
            }[order.status] || order.status;
            
            const orderIdLabel = currentLang === 'en' ? 'Order ID:' : 'ì£¼ë¬¸ ID:';
            const createdLabel = currentLang === 'en' ? 'Created Time:' : 'ìƒì„± ì‹œê°„:';
            const updatedLabel = currentLang === 'en' ? 'Last Updated:' : 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:';
            const amountLabel = currentLang === 'en' ? 'Payment Amount:' : 'ê²°ì œ ê¸ˆì•¡:';
            const usdtLabel = currentLang === 'en' ? 'USDT Amount:' : 'USDT ê¸ˆì•¡:';
            const statusLabel = currentLang === 'en' ? 'Current Status:' : 'í˜„ì¬ ìƒíƒœ:';
            const stepLabel = currentLang === 'en' ? 'Current Step:' : 'í˜„ì¬ ë‹¨ê³„:';
            const walletLabel = currentLang === 'en' ? 'Deposit Wallet:' : 'ì…ê¸ˆ ì§€ê°‘:';
            const proofLabel = currentLang === 'en' ? 'Payment Proof:' : 'ê²°ì œ ì¦ëª…ì„œ:';
            const viewProofText = currentLang === 'en' ? 'View' : 'ë³´ê¸°';
            
            let detailHtml = `
                <div class="form-group">
                    <label class="form-label">${orderIdLabel}</label>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">${order.id}</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">${createdLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">${createdTime}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${updatedLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">${updatedTime}</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">${amountLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px; font-weight: bold;">
                            ${order.amount.toLocaleString()} THB
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${usdtLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            ${order.usdt.toFixed(4)} USDT
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">${statusLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            <span class="status-badge ${order.status === 'ì…ê¸ˆëŒ€ê¸°' ? 'status-waiting' : 
                                order.status === 'ì…ê¸ˆí™•ì¸' ? 'status-confirmed' : 
                                order.status === 'ì²˜ë¦¬ì¤‘' ? 'status-processing' : 
                                order.status === 'ì™„ë£Œ' ? 'status-completed' : 'status-cancelled'}">
                                ${statusText}
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">${stepLabel}</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                            ${getStepText(order.step || 1)}
                        </div>
                    </div>
                </div>
                
                ${order.wallet ? `
                <div class="form-group">
                    <label class="form-label">${walletLabel}</label>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        ${order.wallet.name} (${order.wallet.network})<br>
                        <small style="color: #718096;">${order.wallet.address}</small>
                    </div>
                </div>
                ` : ''}
                
                <div class="form-group">
                    <label class="form-label">${proofLabel}</label>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;">
                        ${proofInfo}
                        ${order.proof && order.proof.data ? 
                            `<button class="action-button action-view" style="margin-top: 5px;" onclick="viewProof('${order.id}')">${viewProofText}</button>` : ''
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('orderDetailContent').innerHTML = detailHtml;
            
            let actionsHtml = '';
            
            if (order.status === 'ì…ê¸ˆëŒ€ê¸°') {
                const confirmText = currentLang === 'en' ? 'Confirm Deposit' : 'ì…ê¸ˆ í™•ì¸';
                const cancelText = currentLang === 'en' ? 'Cancel Payment' : 'ê²°ì œ ì·¨ì†Œ';
                actionsHtml = `
                    <button class="modal-button primary" onclick="updateOrderStatus('${order.id}', 'ì…ê¸ˆí™•ì¸')">${confirmText}</button>
                    <button class="modal-button secondary" onclick="updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                `;
            } else if (order.status === 'ì…ê¸ˆí™•ì¸') {
                const processText = currentLang === 'en' ? 'Start Process' : 'ì²˜ë¦¬ ì‹œì‘';
                const cancelText = currentLang === 'en' ? 'Cancel Process' : 'ì²˜ë¦¬ ì·¨ì†Œ';
                actionsHtml = `
                    <button class="modal-button primary" onclick="updateOrderStatus('${order.id}', 'ì²˜ë¦¬ì¤‘')">${processText}</button>
                    <button class="modal-button secondary" onclick="updateOrderStatus('${order.id}', 'ì·¨ì†Œ')">${cancelText}</button>
                `;
            } else if (order.status === 'ì²˜ë¦¬ì¤‘') {
                const completeText = currentLang === 'en' ? 'Complete Process' : 'ì²˜ë¦¬ ì™„ë£Œ';
                actionsHtml = `
                    <button class="modal-button success" onclick="updateOrderStatus('${order.id}', 'ì™„ë£Œ')">${completeText}</button>
                `;
            } else {
                const resetText = currentLang === 'en' ? 'Reset Status' : 'ìƒíƒœ ì¬ì„¤ì •';
                actionsHtml = `
                    <button class="modal-button primary" onclick="updateOrderStatus('${order.id}', 'ì…ê¸ˆëŒ€ê¸°')">${resetText}</button>
                `;
            }
            
            document.getElementById('orderDetailActions').innerHTML = actionsHtml;
            
            document.getElementById('orderDetailModal').classList.remove('hidden');
        }

        function closeOrderDetail() {
            document.getElementById('orderDetailModal').classList.add('hidden');
            selectedOrder = null;
        }

        // ==================== ì§€ê°‘ ê´€ë¦¬ ====================
        function openAddWalletModal() {
            const trans = translations[currentLang];
            const title = document.getElementById('walletModalTitle');
            if (title) title.textContent = trans.walletModalTitle;
            
            const form = document.getElementById('walletForm');
            if (form) form.reset();
            
            const walletId = document.getElementById('walletId');
            if (walletId) walletId.value = '';
            
            qrCodeFile = null;
            
            const statusSelect = document.getElementById('walletStatus');
            if (statusSelect) statusSelect.value = 'active';
            
            const modal = document.getElementById('walletModal');
            if (modal) modal.classList.remove('hidden');
        }

        function editWallet(walletId) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            selectedWallet = wallet;
            
            const trans = translations[currentLang];
            const title = document.getElementById('walletModalTitle');
            if (title) title.textContent = currentLang === 'en' ? 'âœï¸ Edit Wallet' : 'âœï¸ ì§€ê°‘ ìˆ˜ì •';
            
            const walletIdInput = document.getElementById('walletId');
            if (walletIdInput) walletIdInput.value = wallet.id;
            
            const nameInput = document.getElementById('walletName');
            if (nameInput) nameInput.value = wallet.name;
            
            const networkSelect = document.getElementById('walletNetwork');
            if (networkSelect) networkSelect.value = wallet.network;
            
            const statusSelect = document.getElementById('walletStatus');
            if (statusSelect) statusSelect.value = wallet.isActive ? 'active' : 'inactive';
            
            const addressInput = document.getElementById('walletAddress');
            if (addressInput) addressInput.value = wallet.address;
            
            const memoInput = document.getElementById('walletMemo');
            if (memoInput) memoInput.value = wallet.memo || '';
            
            qrCodeFile = null;
            
            const modal = document.getElementById('walletModal');
            if (modal) modal.classList.remove('hidden');
        }

        function handleQRCodeUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = 2 * 1024 * 1024;
            if (file.size > maxSize) {
                alert(currentLang === 'en' ? 
                    'File size must be less than 2MB' : 
                    'íŒŒì¼ í¬ê¸°ëŠ” 2MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                alert(currentLang === 'en' ? 
                    'Only image files can be uploaded' : 
                    'ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                event.target.value = '';
                return;
            }
            
            qrCodeFile = file;
        }

        function saveWallet() {
            console.log('ì§€ê°‘ ì €ì¥ ì‹œì‘');
            
            const nameInput = document.getElementById('walletName');
            const networkSelect = document.getElementById('walletNetwork');
            const addressInput = document.getElementById('walletAddress');
            
            if (!nameInput || !networkSelect || !addressInput) {
                console.error('í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }
            
            if (!nameInput.value.trim()) {
                alert(currentLang === 'en' ? 
                    'Please enter wallet name' : 
                    'ì§€ê°‘ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            if (!networkSelect.value) {
                alert(currentLang === 'en' ? 
                    'Please select network' : 
                    'ë„¤íŠ¸ì›Œí¬ë¥¼ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            if (!addressInput.value.trim()) {
                alert(currentLang === 'en' ? 
                    'Please enter wallet address' : 
                    'ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            const walletId = document.getElementById('walletId').value;
            const isEdit = !!walletId;
            
            if (qrCodeFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const qrCodeData = e.target.result;
                    console.log('QR ì½”ë“œ ë°ì´í„° ì½ê¸° ì™„ë£Œ, ê¸¸ì´:', qrCodeData.length);
                    
                    if (qrCodeData && qrCodeData.startsWith('data:image/')) {
                        saveWalletData(qrCodeData);
                    } else {
                        console.error('ì˜ëª»ëœ ì´ë¯¸ì§€ í˜•ì‹');
                        alert('ì´ë¯¸ì§€ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                };
                
                reader.onerror = function(e) {
                    console.error('ì´ë¯¸ì§€ ì½ê¸° ì˜¤ë¥˜:', e);
                    alert('ì´ë¯¸ì§€ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                };
                
                reader.readAsDataURL(qrCodeFile);
            } else {
                if (isEdit && selectedWallet && selectedWallet.qrCode) {
                    saveWalletData(selectedWallet.qrCode);
                } else {
                    saveWalletData(null);
                }
            }
            
            function saveWalletData(qrCodeData) {
                const walletData = {
                    id: isEdit ? walletId : 'wallet_' + Date.now(),
                    name: nameInput.value.trim(),
                    network: networkSelect.value,
                    address: addressInput.value.trim(),
                    qrCode: qrCodeData,
                    isActive: document.getElementById('walletStatus').value === 'active',
                    isDefault: isEdit ? (selectedWallet?.isDefault || false) : false,
                    memo: document.getElementById('walletMemo').value.trim(),
                    createdAt: isEdit ? (selectedWallet?.createdAt || new Date().toISOString()) : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                console.log('ì§€ê°‘ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ:', walletData);
                
                let updatedWallets = [...allWallets];
                
                if (isEdit) {
                    const index = updatedWallets.findIndex(w => w.id === walletId);
                    if (index > -1) {
                        updatedWallets[index] = walletData;
                        console.log('ì§€ê°‘ ìˆ˜ì • ì™„ë£Œ:', walletId);
                    }
                } else {
                    updatedWallets.push(walletData);
                    console.log('ìƒˆ ì§€ê°‘ ì¶”ê°€ ì™„ë£Œ:', walletData.id);
                }
                
                const activeWallets = updatedWallets.filter(w => w.isActive);
                if (activeWallets.length === 0 && updatedWallets.length > 0) {
                    updatedWallets[0].isActive = true;
                }
                
                const saveSuccess = dataManager.saveWallets(updatedWallets);
                
                if (saveSuccess) {
                    dataManager.notifyUserPageWallets(updatedWallets);
                    
                    allWallets = updatedWallets;
                    updateStats();
                    updateWallets();
                    
                    closeWalletModal();
                    
                    const successMessage = currentLang === 'en' ?
                        `Wallet ${isEdit ? 'updated' : 'added'} successfully` :
                        `ì§€ê°‘ì´ ì„±ê³µì ìœ¼ë¡œ ${isEdit ? 'ìˆ˜ì •' : 'ì¶”ê°€'}ë˜ì—ˆìŠµë‹ˆë‹¤`;
                    alert(successMessage);
                    
                    console.log('âœ… ì§€ê°‘ ì €ì¥ ë° ë™ê¸°í™” ì™„ë£Œ');
                } else {
                    alert(currentLang === 'en' ? 
                        'Failed to save wallet data' : 
                        'ì§€ê°‘ ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            }
        }

        function toggleWalletStatus(walletId, activate) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            if (wallet.isDefault && !activate) {
                alert(currentLang === 'en' ?
                    'Default wallet cannot be deactivated' :
                    'ê¸°ë³¸ ì§€ê°‘ì€ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const action = activate ? 
                (currentLang === 'en' ? 'Activate' : 'í™œì„±í™”') : 
                (currentLang === 'en' ? 'Deactivate' : 'ë¹„í™œì„±í™”');
            const confirmMessage = currentLang === 'en' ?
                `${action} this wallet?` :
                `ì´ ì§€ê°‘ì„ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const updatedWallets = allWallets.map(w => {
                if (w.id === walletId) {
                    return { ...w, isActive: activate };
                }
                return w;
            });
            
            dataManager.saveWallets(updatedWallets);
            
            dataManager.notifyUserPageWallets(updatedWallets);
            
            allWallets = updatedWallets;
            updateStats();
            updateWallets();
            
            const successMessage = currentLang === 'en' ?
                `Wallet ${action.toLowerCase()}d` :
                `ì§€ê°‘ì´ ${action}ë˜ì—ˆìŠµë‹ˆë‹¤`;
            alert(successMessage);
        }

        function setDefaultWallet(walletId) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            const confirmMessage = currentLang === 'en' ?
                `Set this wallet as default?\n\nDefault wallet cannot be deleted and is always active.` :
                `ì´ ì§€ê°‘ì„ ê¸°ë³¸ ì§€ê°‘ìœ¼ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ë³¸ ì§€ê°‘ì€ ì‚­ì œí•  ìˆ˜ ì—†ìœ¼ë©° í•­ìƒ í™œì„± ìƒíƒœì…ë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const updatedWallets = allWallets.map(w => {
                if (w.id === walletId) {
                    return { ...w, isDefault: true, isActive: true };
                } else {
                    return { ...w, isDefault: false };
                }
            });
            
            dataManager.saveWallets(updatedWallets);
            
            dataManager.notifyUserPageWallets(updatedWallets);
            
            allWallets = updatedWallets;
            updateStats();
            updateWallets();
            
            alert(currentLang === 'en' ? 'Default wallet set' : 'ê¸°ë³¸ ì§€ê°‘ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function deleteWallet(walletId) {
            const wallet = allWallets.find(w => w.id === walletId);
            if (!wallet) return;
            
            if (wallet.isDefault) {
                alert(currentLang === 'en' ? 
                    'Default wallet cannot be deleted' : 
                    'ê¸°ë³¸ ì§€ê°‘ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const ordersUsingWallet = allOrders.filter(o => 
                o.wallet && o.wallet.id === walletId && o.status !== 'ì™„ë£Œ' && o.status !== 'ì·¨ì†Œ'
            );
            
            if (ordersUsingWallet.length > 0) {
                alert(currentLang === 'en' ?
                    `There are ${ordersUsingWallet.length} active orders using this wallet.\nPlease change their status first.` :
                    `ì´ ì§€ê°‘ì„ ì‚¬ìš©í•˜ëŠ” ${ordersUsingWallet.length}ê°œì˜ í™œì„± ì£¼ë¬¸ì´ ìˆìŠµë‹ˆë‹¤.\në¨¼ì € ìƒíƒœë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.`);
                return;
            }
            
            const confirmMessage = currentLang === 'en' ?
                `Delete this wallet?\n\nCannot be recovered after deletion.` :
                `ì´ ì§€ê°‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const updatedWallets = allWallets.filter(w => w.id !== walletId);
            
            const activeWallets = updatedWallets.filter(w => w.isActive);
            if (activeWallets.length === 0 && updatedWallets.length > 0) {
                updatedWallets[0].isActive = true;
            }
            
            dataManager.saveWallets(updatedWallets);
            
            dataManager.notifyUserPageWallets(updatedWallets);
            
            allWallets = updatedWallets;
            updateStats();
            updateWallets();
            
            alert(currentLang === 'en' ? 'Wallet deleted' : 'ì§€ê°‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function closeWalletModal() {
            const modal = document.getElementById('walletModal');
            if (modal) modal.classList.add('hidden');
            selectedWallet = null;
            qrCodeFile = null;
        }

        // ==================== ë°ì´í„° ë™ê¸°í™” ====================
        function checkDataSync() {
            const syncKey = localStorage.getItem('payment_sync_flag');
            const lastCheck = localStorage.getItem('admin_last_check') || '0';
            
            if (syncKey !== lastCheck) {
                console.log('ğŸ”” ê´€ë¦¬ì: ë°ì´í„° ë³€ê²½ ê°ì§€!');
                
                allOrders = dataManager.getOrders();
                allWallets = dataManager.getWallets();
                
                updateStats();
                updateOrders();
                updateWallets();
                
                localStorage.setItem('admin_last_check', syncKey || '0');
            }
        }

        // ==================== ìƒˆë¡œìš´ ì£¼ë¬¸ ì•Œë¦¼ ì²´í¬ ====================
        function startNotificationCheck() {
            if (notificationCheckInterval) clearInterval(notificationCheckInterval);
            
            console.log('ğŸ”„ ìƒˆë¡œìš´ ì£¼ë¬¸ ì•Œë¦¼ ì²´í¬ ì‹œì‘ (5ì´ˆ ê°„ê²©)');
            
            checkNewOrders();
            
            notificationCheckInterval = setInterval(() => {
                checkNewOrders();
            }, 5000);
        }

        async function checkNewOrders() {
            try {
                const newOrders = dataManager.getNewOrdersSinceLastNotification();
                
                if (newOrders.length > 0) {
                    console.log(`ğŸ“¢ ${newOrders.length}ê°œì˜ ìƒˆë¡œìš´ ì£¼ë¬¸ ë°œê²¬!`);
                    
                    dataManager.saveLastNotificationTime();
                    
                    if (newOrders.length === 1) {
                        showNotification(`ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤: ${newOrders[0].id}`);
                    } else {
                        showNotification(`${newOrders.length}ê°œì˜ ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤`);
                    }
                    
                    updateStats();
                    updateOrders();
                }
            } catch (error) {
                console.error('ìƒˆë¡œìš´ ì£¼ë¬¸ ì²´í¬ ì˜¤ë¥˜:', error);
            }
        }

        // ==================== ë‚´ë³´ë‚´ê¸° ====================
        function exportOrdersToExcel() {
            try {
                let csv = '';
                
                if (currentLang === 'en') {
                    csv = 'Order ID,Created Time,Amount(THB),USDT Amount,Status,Step,Wallet,Network,Proof,Updated Time\n';
                } else {
                    csv = 'ì£¼ë¬¸ ID,ìƒì„± ì‹œê°„,ê¸ˆì•¡(THB),USDT ê¸ˆì•¡,ìƒíƒœ,ë‹¨ê³„,ì§€ê°‘,ë„¤íŠ¸ì›Œí¬,ì¦ëª…ì„œ,ì—…ë°ì´íŠ¸ ì‹œê°„\n';
                }
                
                allOrders.forEach(order => {
                    const time = new Date(order.time).toLocaleString('ko-KR');
                    const updated = order.updated ? new Date(order.updated).toLocaleString('ko-KR') : '';
                    const stepText = getStepText(order.step || 1);
                    const walletInfo = order.wallet ? `${order.wallet.name} (${order.wallet.network})` : 
                        currentLang === 'en' ? 'Not specified' : 'ì§€ì •ë˜ì§€ ì•ŠìŒ';
                    const hasProof = order.proof && order.proof.data ? 
                        (currentLang === 'en' ? 'Yes' : 'ì˜ˆ') : 
                        (currentLang === 'en' ? 'No' : 'ì•„ë‹ˆì˜¤');
                    
                    csv += `"${order.id}","${time}","${order.amount}","${order.usdt || 0}","${order.status}","${stepText}","${walletInfo}","${order.wallet?.network || ''}","${hasProof}","${updated}"\n`;
                });
                
                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                const fileName = `orders_${new Date().toISOString().split('T')[0]}.csv`;
                
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                const message = currentLang === 'en' ?
                    `File saved as: ${fileName}\n\nIt will be saved to your default download folder.` :
                    `íŒŒì¼ ì €ì¥ë¨: ${fileName}\n\nê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.`;
                showSaveStatus(message);
                
            } catch (error) {
                console.error('Export failed:', error);
                alert(currentLang === 'en' ? 'Export failed' : 'ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨');
            }
        }

        function showSaveStatus(message) {
            const saveStatus = document.getElementById('saveStatus');
            if (!saveStatus) return;
            
            saveStatus.textContent = message;
            saveStatus.classList.add('show');
            
            setTimeout(() => {
                saveStatus.classList.remove('show');
            }, 3000);
        }

        // ==================== í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ====================
        window.createTestOrder = async function() {
            const activeWallet = allWallets.find(w => w.isActive) || allWallets[0];
            const testOrder = {
                id: 'ORD-' + Date.now().toString().slice(-6) + Math.random().toString(36).substr(2, 3).toUpperCase(),
                amount: Math.floor(Math.random() * 10000) + 1000,
                usdt: Math.random() * 100 + 10,
                status: 'ì…ê¸ˆëŒ€ê¸°',
                step: 1,
                time: new Date().toISOString(),
                wallet: activeWallet ? {
                    id: activeWallet.id,
                    name: activeWallet.name,
                    address: activeWallet.address,
                    network: activeWallet.network
                } : null,
                proof: {
                    name: 'test.png',
                    type: 'image/png',
                    size: 1024,
                    data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='
                }
            };
            
            allOrders.unshift(testOrder);
            dataManager.saveOrders(allOrders);
            
            loadAllData();
            
            alert(currentLang === 'en' ?
                `Test order ${testOrder.id} created` :
                `í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ${testOrder.id} ìƒì„±ë¨`);
        };

        window.clearAllOrders = function() {
            const confirmMessage = currentLang === 'en' ?
                'Delete all order records? This cannot be undone.' :
                'ëª¨ë“  ì£¼ë¬¸ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            
            if (confirm(confirmMessage)) {
                allOrders = [];
                dataManager.saveOrders([]);
                updateStats();
                updateOrders();
                alert(currentLang === 'en' ? 'All order records deleted' : 'ëª¨ë“  ì£¼ë¬¸ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        };

        window.clearAllWallets = function() {
            const confirmMessage = currentLang === 'en' ?
                'Delete all wallets except default wallet? This cannot be undone.' :
                'ê¸°ë³¸ ì§€ê°‘ì„ ì œì™¸í•œ ëª¨ë“  ì§€ê°‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            
            if (confirm(confirmMessage)) {
                const defaultWallet = allWallets.find(w => w.isDefault);
                const updatedWallets = defaultWallet ? [defaultWallet] : [];
                
                dataManager.saveWallets(updatedWallets);
                allWallets = updatedWallets;
                updateStats();
                updateWallets();
                dataManager.notifyUserPageWallets(updatedWallets);
                
                alert(currentLang === 'en' ?
                    'All wallets deleted (except default wallet)' :
                    'ëª¨ë“  ì§€ê°‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤ (ê¸°ë³¸ ì§€ê°‘ ì œì™¸)');
            }
        };

        // ==================== ì‚¬ìš©ì í˜ì´ì§€ì—ì„œ ì£¼ë¬¸ ìƒì„± ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ ====================
        window.newOrderFromUser = async function(order) {
            console.log('ì‚¬ìš©ìë¡œë¶€í„° ìƒˆ ì£¼ë¬¸ ë°›ìŒ:', order.id);
            
            allOrders.unshift(order);
            dataManager.saveOrders(allOrders);
            
            updateStats();
            updateOrders();
            
            showNotification(`ìƒˆ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤: ${order.id}`);
            
            return { success: true, message: 'ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤' };
        };

        // ==================== í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ê¸€ë¡œë²Œ í•¨ìˆ˜ ====================
        window.testAllTelegramBots = testAllTelegramBots;

        console.log('ê´€ë¦¬ì í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
