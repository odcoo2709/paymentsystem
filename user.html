<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>USDT/THB Payment System - Anonymous Payment</title>
    
    <!-- ====== PWA Í¥ÄÎ†® Î©îÌÉÄ ÌÉúÍ∑∏ ÏãúÏûë ====== -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- ÌÖåÎßà Ïª¨Îü¨ -->
    <meta name="theme-color" content="#1a2980">
    
    <!-- iOS PWA ÏÑ§Ï†ï -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="USDT/THB Í≤∞Ï†ú">
    
    <!-- üíµ + USDT ÌÖçÏä§Ìä∏ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%231a2980'/><text x='50' y='75' font-size='60' text-anchor='middle' fill='white'>üíµ</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%231a2980'/><text x='50' y='75' font-size='60' text-anchor='middle' fill='white'>üíµ</text></svg>">
    
    <!-- ÏÑ§Î™Ö -->
    <meta name="description" content="Î°úÍ∑∏Ïù∏ ÏóÜÏù¥ USDTÎ°ú ÌÉúÍµ≠ Î∞îÌä∏(THB) Í≤∞Ï†úÌïòÍ∏∞">
    
    <!-- Windows/Microsoft ÌÉÄÏùº -->
    <meta name="msapplication-TileColor" content="#1a2980">
    <!-- ====== PWA Í¥ÄÎ†® Î©îÌÉÄ ÌÉúÍ∑∏ ÎÅù ====== -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Apple SD Gothic Neo', -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            padding: 15px;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Í∞ÑÌé∏Ìïú PWA ÏÑ§Ïπò Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .install-button-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .install-button {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 22px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            min-width: 120px;
            justify-content: center;
        }

        .install-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 161, 105, 0.4);
        }

        .install-button:active {
            transform: translateY(0);
        }

        .install-button.hidden {
            display: none !important;
        }

        .install-icon {
            font-size: 18px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Í∞ÑÎã®Ìïú ÏÑ§Ïπò ÏïàÎÇ¥ ÌÜ†Ïä§Ìä∏ */
        .install-toast {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #2d3748;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid #cbd5e0;
            display: none;
            z-index: 1001;
            backdrop-filter: blur(10px);
        }

        .install-toast.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        .install-toast.hide {
            animation: slideOutDown 0.3s ease forwards;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideOutDown {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(20px);
                opacity: 0;
            }
        }

        /* ÎÇòÎ®∏ÏßÄ CSSÎäî Ïù¥Ï†ÑÍ≥º ÎèôÏùºÌïòÍ≤å Ïú†ÏßÄ */
        .main-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .payment-column {
            flex: 1;
            min-width: 280px;
        }

        .orders-column {
            flex: 1;
            min-width: 280px;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            position: relative;
            padding-top: 40px;
            width: 100%;
        }

        .language-container {
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .language-toggle-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 18px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }

        .language-toggle-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .language-toggle-btn:active {
            transform: translateY(0);
        }

        .lang-icon {
            font-size: 14px;
        }

        .title {
            color: #1a2980;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #4a5568;
            font-size: 12px;
        }

        .exchange-section {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            color: #2d3748;
            text-align: center;
        }

        .rate-display {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin: 8px 0;
        }

        .rate-value {
            color: #e53e3e;
        }

        .payment-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-label {
            color: #2d3748;
            font-size: 14px;
            font-weight: 600;
        }

        .amount-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            text-align: center;
            outline: none;
        }

        .amount-input:focus {
            border-color: #667eea;
        }

        .amount-limit {
            font-size: 12px;
            color: #718096;
            text-align: center;
            margin-top: 3px;
        }

        .calculation-preview {
            background: #f7fafc;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            color: #4a5568;
        }

        .calc-total {
            font-weight: bold;
            color: #2d3748;
            font-size: 15px;
        }

        .upload-section {
            margin: 10px 0;
        }

        .upload-label {
            display: block;
            cursor: pointer;
            width: 100%;
        }

        .upload-button {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2d3748;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            border: 2px dashed #cbd5e0;
            text-align: center;
            cursor: pointer;
            width: 100%;
            display: block;
            transition: all 0.3s;
        }

        .upload-button:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.15);
        }

        .upload-input {
            display: none;
        }

        .upload-preview {
            margin-top: 8px;
            text-align: center;
        }

        .upload-preview-image {
            max-width: 150px;
            max-height: 150px;
            border-radius: 6px;
            border: 2px solid #cbd5e0;
            object-fit: contain;
        }

        .file-info {
            font-size: 11px;
            color: #718096;
            margin-top: 3px;
        }

        .pay-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .pay-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .pay-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Ï£ºÎ¨∏ Î™©Î°ù Ïä§ÌÉÄÏùº - ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ï†ÅÏö© */
        .orders-section {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            margin-top: 0;
        }

        .section-title {
            color: #2d3748;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
        }

        .toggle-receipt-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            cursor: pointer;
        }

        .orders-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 320px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .order-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 2px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .order-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        }

        .order-card.status-waiting { border-color: #f6ad55; }
        .order-card.status-confirmed { border-color: #4299e1; }
        .order-card.status-processing { border-color: #9f7aea; }
        .order-card.status-completed { border-color: #38a169; }
        .order-card.status-cancelled { border-color: #e53e3c; }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .order-id {
            font-weight: bold;
            color: #2d3748;
            font-size: 14px;
        }

        .order-time {
            font-size: 11px;
            color: #718096;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            color: white;
        }

        .status-waiting { background: #f6ad55; }
        .status-confirmed { background: #4299e1; }
        .status-processing { background: #9f7aea; }
        .status-completed { background: #38a169; }
        .status-cancelled { background: #e53e3c; }

        .order-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .order-amount {
            font-size: 16px;
            font-weight: bold;
            color: #2d3748;
            text-align: center;
            padding: 8px;
            background: #f1f5f9;
            border-radius: 6px;
        }

        .order-breakdown {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #4a5568;
        }

        /* ÏòÅÏàòÏ¶ù Ïù¥ÎØ∏ÏßÄ Ïä§ÌÉÄÏùº */
        .receipt-image-container {
            display: none;
            text-align: center;
            margin-top: 8px;
            animation: fadeIn 0.3s ease;
        }

        .receipt-image-container.show {
            display: block;
        }

        .receipt-image {
            max-width: 100%;
            max-height: 150px;
            border-radius: 6px;
            margin-top: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .no-orders {
            text-align: center;
            padding: 30px 15px;
            color: #a0aec0;
            font-size: 14px;
            background: white;
            border-radius: 8px;
            border: 2px dashed #cbd5e0;
        }

        /* ÏôÑÎ£åÎêú Ï£ºÎ¨∏ ÏÑπÏÖò */
        .completed-orders-section {
            background: #f0fff4;
            border: 2px solid #c6f6d5;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .completed-section-title {
            color: #38a169;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .completed-section-title::before {
            content: '‚úì';
            background: #38a169;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïä§ÌÉÄÏùº */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .page-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .page-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 12px;
            color: #4a5568;
        }

        /* Î™®Îã¨ Ïä§ÌÉÄÏùº - Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 10px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 15px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            max-height: 95vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .modal-title {
            color: #2d3748;
            font-size: 16px;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #718096;
            cursor: pointer;
            padding: 3px;
            line-height: 1;
        }

        .qr-container {
            text-align: center;
            margin: 8px 0;
        }

        .qr-code {
            width: 140px;
            height: 140px;
            margin: 0 auto 8px;
            background: #f7fafc;
            border-radius: 6px;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #e2e8f0;
        }

        .qr-code img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
        }

        .qr-placeholder {
            font-size: 40px;
        }

        .wallet-address {
            background: #f7fafc;
            padding: 10px;
            border-radius: 6px;
            margin: 12px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #e2e8f0;
            max-height: 60px;
            overflow-y: auto;
        }

        .wallet-info {
            margin: 6px 0;
            padding: 6px;
            background: #f0fff4;
            border-radius: 5px;
            border: 1px solid #c6f6d5;
            font-size: 12px;
        }

        .wallet-name {
            font-weight: bold;
            color: #2d3748;
        }

        .copy-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 6px;
            width: 100%;
            font-size: 13px;
        }

        .deposit-complete-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 12px;
            width: 100%;
        }

        .timer {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            color: white;
            font-weight: bold;
            text-align: center;
            margin: 12px 0;
        }

        .payment-info {
            background: #f8fafc;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 2px solid #e2e8f0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 12px;
        }

        .info-row:not(:last-child) {
            border-bottom: 1px solid #eee;
        }

        .info-label {
            font-weight: 600;
            color: #2d3748;
        }

        .info-value {
            color: #4a5568;
            font-weight: 500;
        }

        .hidden {
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner {
            width: 35px;
            height: 35px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 12px auto;
        }

        .wallet-selection {
            margin: 8px 0;
            padding: 8px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .wallet-selection-title {
            font-size: 12px;
            color: #4a5568;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .selected-wallet {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            background: white;
            border-radius: 5px;
            border: 1px solid #c6f6d5;
        }

        .wallet-icon {
            font-size: 16px;
        }

        .wallet-details {
            flex: 1;
        }

        .wallet-network {
            font-size: 11px;
            color: #718096;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .network-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }

        .network-trc20 { background: #f56565; }
        .network-erc20 { background: #4299e1; }
        .network-bep20 { background: #38a169; }

        .rate-loading {
            color: #718096;
            font-size: 14px;
        }
        
        .rate-error {
            color: #e53e3e;
            font-size: 14px;
        }
        
        .upload-required {
            color: #e53e3e;
            font-size: 11px;
            text-align: center;
            margin-top: 3px;
        }
        
        .sync-status {
            position: fixed;
            top: 8px;
            right: 8px;
            background: #38a169;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .sync-status.visible {
            opacity: 1;
        }
        
        .sync-pulse {
            width: 6px;
            height: 6px;
            background: #38a169;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.5); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .wallet-loading {
            text-align: center;
            color: #718096;
            font-size: 12px;
            padding: 12px;
        }

        .step-description {
            font-size: 12px;
            color: #4a5568;
            margin-bottom: 8px;
            text-align: center;
        }

        .status-update-message {
            font-size: 11px;
            color: #718096;
            text-align: center;
            margin-top: 8px;
            padding: 6px;
            background: #f7fafc;
            border-radius: 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (min-width: 769px) {
            /* PCÏóêÏÑúÎäî ÏÑ§Ïπò Î≤ÑÌäº Ïà®ÍπÄ */
            .install-button-container {
                display: flex !important;
            }
        }

        @media (max-width: 768px) {
            /* Î™®Î∞îÏùºÏóêÏÑúÎßå ÏÑ§Ïπò Î≤ÑÌäº ÌëúÏãú */
            .install-button-container {
                bottom: 15px;
                right: 15px;
            }
            
            .install-button {
                padding: 12px 18px;
                font-size: 14px;
                min-width: 110px;
            }
            
            .install-toast {
                bottom: 75px;
                right: 15px;
                max-width: 200px;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .payment-column, .orders-column {
                width: 100%;
            }
            
            .container {
                padding: 15px;
            }
            
            .modal-content {
                padding: 12px;
                max-width: 95%;
            }
            
            .qr-code {
                width: 120px;
                height: 120px;
            }
        }
        
        @media (max-width: 480px) {
            .install-button {
                padding: 10px 16px;
                font-size: 13px;
                min-width: 100px;
            }
            
            .install-toast {
                max-width: 180px;
                font-size: 13px;
                padding: 10px 14px;
            }
            
            .title {
                font-size: 18px;
            }
            
            .rate-display {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Í∞ÑÌé∏Ìïú PWA ÏÑ§Ïπò Î≤ÑÌäº -->
    <div class="install-button-container" id="installButtonContainer">
        <div class="install-toast" id="installToast"></div>
        <button class="install-button hidden" id="installButton">
            <span class="install-icon">üì±</span>
            <span id="installButtonText">Ïï± ÏÑ§Ïπò</span>
        </button>
    </div>
    
    <!-- ÎèôÍ∏∞Ìôî ÏÉÅÌÉú ÌëúÏãú -->
    <div class="sync-status" id="syncStatus">
        <div class="sync-pulse"></div>
        <span id="syncText">ÎèôÍ∏∞Ìôî Ï§ë...</span>
    </div>
    
    <div class="container">
        <div class="header">
            <div class="language-container">
                <button class="language-toggle-btn" id="languageToggleBtn">
                    <span class="lang-icon">üåê</span>
                    <span id="languageBtnText">English</span>
                </button>
            </div>
            <h1 class="title" id="pageTitle">USDT ‚Üí THB Í≤∞Ï†ú</h1>
            <p class="subtitle" id="pageSubtitle">Î°úÍ∑∏Ïù∏ ÏóÜÏù¥ USDTÎ°ú ÌÉúÍµ≠ Î∞îÌä∏(THB) Í≤∞Ï†úÌïòÍ∏∞</p>
        </div>

        <div class="main-content">
            <!-- ÏôºÏ™Ω Ïó¥: Í≤∞Ï†ú Ìèº -->
            <div class="payment-column">
                <div class="exchange-section">
                    <h4 id="exchangeTitle">Ïã§ÏãúÍ∞Ñ ÌôòÏú®</h4>
                    <div class="rate-display">
                        1 USDT = <span class="rate-value" id="exchangeRate">
                            <span class="rate-loading">Î°úÎî© Ï§ë...</span>
                        </span> THB
                    </div>
                    <div id="rateUpdate">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: Î°úÎî© Ï§ë...</div>
                </div>

                <div class="payment-form">
                    <div class="input-group">
                        <label class="input-label" id="amountLabel">üí∞ Í≤∞Ï†ú Í∏àÏï° ÏûÖÎ†• (THB):</label>
                        <input type="number" 
                               class="amount-input" 
                               id="thbAmount" 
                               placeholder="Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                               min="1000"
                               max="500000"
                               value="">
                        <div class="amount-limit" id="amountLimit">
                            ÏµúÏÜå 1,000 THB ~ ÏµúÎåÄ 500,000 THB
                        </div>
                    </div>

                    <div class="calculation-preview" id="calcPreview" style="display: none;">
                        <div class="calc-row">
                            <span id="calcAmountLabel">Í≤∞Ï†ú Í∏àÏï°:</span>
                            <span id="calcAmount">0 THB</span>
                        </div>
                        <div class="calc-row">
                            <span id="calcRateLabel">ÌôòÏú®:</span>
                            <span>1 USDT = <span id="calcRate">0.00</span> THB</span>
                        </div>
                        <div class="calc-row">
                            <span id="calcUsdtLabel">USDT Í∏àÏï°:</span>
                            <span id="calcUsdt">0.0000 USDT</span>
                        </div>
                        <div class="calc-row">
                            <span id="calcFeeLabel">ÏàòÏàòÎ£å (3%):</span>
                            <span id="calcFee">0.0000 USDT</span>
                        </div>
                        <div class="calc-row">
                            <span id="calcTotalLabel">Ï¥ù Í≤∞Ï†ú Í∏àÏï°:</span>
                            <span class="calc-total" id="calcTotal">0.0000 USDT</span>
                        </div>
                    </div>

                    <div class="upload-section">
                        <label class="upload-label" for="paymentProof">
                            <div class="upload-button" id="uploadButtonText">
                                üìé Í≤∞Ï†ú Ìï† ÏÉÅÏ†ê QR (ÌïÑÏàò)
                            </div>
                        </label>
                        <div class="upload-required" id="uploadRequired">
                            ‚Äª Í≤∞Ï†úÎ•º ÏúÑÌï¥ QR ÏΩîÎìú Ïä§ÌÅ¨Î¶∞ÏÉ∑ÏùÑ ÏóÖÎ°úÎìúÌï¥Ïïº Ìï©ÎãàÎã§
                        </div>
                        <input type="file" class="upload-input" id="paymentProof" accept="image/*,.pdf,.png,.jpg,.jpeg">
                        <div class="upload-preview" id="uploadPreview">
                            <!-- Ï¥àÍ∏∞ÏóêÎäî ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÜÏùå -->
                        </div>
                    </div>

                    <button class="pay-button" id="payButton" disabled>
                        üí≥ <span id="payButtonText">ÏßÄÍ∏à Í≤∞Ï†úÌïòÍ∏∞</span>
                    </button>
                </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω Ïó¥: Ï£ºÎ¨∏ Î™©Î°ù -->
            <div class="orders-column">
                <div class="orders-section">
                    <h3 class="section-title">
                        ‚è≥ <span id="activeOrdersTitle">ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏</span>
                    </h3>
                    <div class="orders-container" id="activeOrdersContainer">
                        <div class="no-orders" id="noActiveOrders">ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§</div>
                    </div>
                    <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïª®Ìä∏Î°§ -->
                    <div class="pagination-controls" id="activeOrdersPagination" style="display: none;">
                        <button class="page-btn" id="activeOrdersPrevBtn" disabled>‚óÄ</button>
                        <div class="page-info" id="activeOrdersPageInfo">1 / 1</div>
                        <button class="page-btn" id="activeOrdersNextBtn" disabled>‚ñ∂</button>
                    </div>
                </div>

                <div class="completed-orders-section">
                    <h3 class="completed-section-title">
                        <span id="completedOrdersTitle">‚úÖ ÏôÑÎ£åÎêú Ï£ºÎ¨∏</span>
                        <button class="toggle-receipt-btn" id="toggleReceiptBtn">
                            ÏòÅÏàòÏ¶ù Î≥¥Í∏∞
                        </button>
                    </h3>
                    <div class="orders-container" id="completedOrdersContainer">
                        <div class="no-orders" id="noCompletedOrders">ÏôÑÎ£åÎêú Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§</div>
                    </div>
                    <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïª®Ìä∏Î°§ -->
                    <div class="pagination-controls" id="completedOrdersPagination" style="display: none;">
                        <button class="page-btn" id="completedOrdersPrevBtn" disabled>‚óÄ</button>
                        <div class="page-info" id="completedOrdersPageInfo">1 / 1</div>
                        <button class="page-btn" id="completedOrdersNextBtn" disabled>‚ñ∂</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Í∞ÑÎã®Ìïú Í≤∞Ï†ú Î™®Îã¨ (Í∞úÏÑ†Îêú Ïª¥Ìå©Ìä∏ Î≤ÑÏ†Ñ) -->
    <div class="modal-overlay hidden" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">üî≥ USDT Ï†ÑÏÜ° ÏïàÎÇ¥</h3>
                <button class="modal-close" id="closeModal">‚úï</button>
            </div>

            <div class="wallet-selection" id="walletSelection">
                <div class="wallet-selection-title" id="walletSelectionTitle">ÎÑ§Ìä∏ÏõåÌÅ¨:</div>
                <div class="selected-wallet" id="selectedWalletInfo">
                    <div class="wallet-loading">ÏßÄÍ∞ë Ï†ïÎ≥¥ Î°úÎî© Ï§ë...</div>
                </div>
            </div>

            <div class="qr-container">
                <div class="qr-code" id="qrCodeContainer">
                    <div class="wallet-loading">QR ÏΩîÎìú Î°úÎî© Ï§ë...</div>
                </div>
                <p class="step-description" id="step1Description">ÏïÑÎûò ÏßÄÍ∞ë Ï£ºÏÜåÎ°ú USDTÎ•º Ï†ÑÏÜ°Ìï¥Ï£ºÏÑ∏Ïöî</p>
            </div>
            
            <div class="wallet-address" id="walletAddress">
                ÏßÄÍ∞ë Ï†ïÎ≥¥ Î°úÎî© Ï§ë...
            </div>
            
            <button class="copy-button" id="copyAddress">
                üìã <span id="copyButtonText">Ï£ºÏÜå Î≥µÏÇ¨</span>
            </button>

            <div class="payment-info">
                <div class="info-row">
                    <span class="info-label" id="modalTotalLabel">Ï¥ù Í≤∞Ï†ú Í∏àÏï°:</span>
                    <span class="info-value" id="modalTotal">0.0000 USDT</span>
                </div>
                <div class="info-row">
                    <span class="info-label" id="orderIdLabel">Ï£ºÎ¨∏ ID:</span>
                    <span class="info-value" id="orderId">ORD-000000</span>
                </div>
                <div class="info-row">
                    <span class="info-label" id="orderTimeLabel">Ï£ºÎ¨∏ ÏãúÍ∞Ñ:</span>
                    <span class="info-value" id="orderTime">Î°úÎî© Ï§ë...</span>
                </div>
            </div>

            <div class="timer" id="timer">
                ‚è∞ <span id="timerLabel">ÎÇ®ÏùÄ ÏãúÍ∞Ñ:</span> <span id="timeLeft">5:00</span>
            </div>

            <button class="deposit-complete-button" id="depositCompleteBtn">
                ‚úÖ <span id="depositCompleteText">ÏûÖÍ∏à ÏôÑÎ£å</span>
            </button>

            <div class="status-update-message" id="autoUpdateInfo">
                üîÑ <span id="autoUpdateText">Í≤∞Ï†ú ÏôÑÎ£å ÌõÑ ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏ÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî</span>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ï†ÑÏó≠ Î≥ÄÏàò Ï¥àÍ∏∞Ìôî ====================
        // PWA ÏÑ§Ïπò Í¥ÄÎ†® Î≥ÄÏàò
        let deferredPrompt;
        let installPromptShown = false;
        
        // ÌôòÏú® Î∞è Í≤∞Ï†ú Í¥ÄÎ†® Î≥ÄÏàò
        let exchangeRate = 31.5; // Í∏∞Î≥∏Í∞í
        let timeLeft = 300;
        let timerInterval = null;
        let uploadedFile = null;
        let activeWallet = null;
        let allWallets = [];
        let allOrders = [];
        let currentLang = 'ko';
        let syncCheckInterval = null;
        let currentOrderId = '';
        
        // Ï£ºÎ¨∏ ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Í¥ÄÎ†® Î≥ÄÏàò
        let activeOrdersPage = 1;
        let completedOrdersPage = 1;
        const ORDERS_PER_PAGE = 1;
        
        // ÏòÅÏàòÏ¶ù ÌëúÏãú ÏÉÅÌÉú
        let showReceipts = false;

        // ==================== Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨Ïûê ÌÅ¥ÎûòÏä§ ====================
        class DataManager {
            constructor() {
                this.ORDERS_KEY = 'payment_orders';
                this.WALLETS_KEY = 'payment_wallets';
                this.SYNC_KEY = 'payment_sync_flag';
                this.USER_SYNC_KEY = 'user_sync_check';
            }

            getOrders() {
                try {
                    let orders = JSON.parse(localStorage.getItem(this.ORDERS_KEY) || '[]');
                    sessionStorage.setItem(this.ORDERS_KEY, JSON.stringify(orders));
                    return orders;
                } catch (error) {
                    console.error('Error loading orders:', error);
                    return [];
                }
            }

            saveOrders(orders) {
                try {
                    localStorage.setItem(this.ORDERS_KEY, JSON.stringify(orders));
                    sessionStorage.setItem(this.ORDERS_KEY, JSON.stringify(orders));
                    localStorage.setItem(this.SYNC_KEY, Date.now().toString());
                    return true;
                } catch (error) {
                    console.error('Error saving orders:', error);
                    return false;
                }
            }

            getWallets() {
                try {
                    let wallets = JSON.parse(localStorage.getItem(this.WALLETS_KEY) || '[]');
                    if (wallets.length === 0) {
                        wallets = [this.createDefaultWallet()];
                        this.saveWallets(wallets);
                    }
                    return wallets;
                } catch (error) {
                    console.error('Error loading wallets:', error);
                    return [];
                }
            }

            saveWallets(wallets) {
                try {
                    localStorage.setItem(this.WALLETS_KEY, JSON.stringify(wallets));
                    localStorage.setItem(this.SYNC_KEY, Date.now().toString());
                    return true;
                } catch (error) {
                    console.error('Error saving wallets:', error);
                    return false;
                }
            }

            createDefaultWallet() {
                return {
                    id: 'wallet_1',
                    name: 'Í∏∞Î≥∏ ÏßÄÍ∞ë (TRC20)',
                    address: 'TXYZ1234567890abcdefghijklmnopqrstuvw',
                    network: 'TRC20',
                    qrCode: null,
                    isActive: true,
                    isDefault: true,
                    createdAt: new Date().toISOString()
                };
            }

            generateOrderId() {
                return 'ORD-' + Date.now().toString().slice(-6) + Math.random().toString(36).substr(2, 3).toUpperCase();
            }

            getActiveWallet() {
                const wallets = this.getWallets();
                return wallets.find(w => w.isActive) || wallets[0];
            }

            checkSync() {
                return localStorage.getItem(this.SYNC_KEY);
            }

            updateUserSync() {
                const syncTime = this.checkSync();
                sessionStorage.setItem(this.USER_SYNC_KEY, syncTime || '0');
                return syncTime;
            }

            needsSync() {
                const lastSync = this.checkSync();
                const lastUserSync = sessionStorage.getItem(this.USER_SYNC_KEY) || '0';
                return lastSync !== lastUserSync;
            }
        }

        // DataManager Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±
        const dataManager = new DataManager();

        // ==================== Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞ ====================
        const translations = {
            en: {
                title: "USDT/THB Payment",
                subtitle: "Pay with USDT to Thai Baht (THB) without login",
                lastUpdate: "Last update: ",
                amountLabel: "üí∞ Enter payment amount (THB):",
                amountLimit: "Minimum 1,000 THB ~ Maximum 500,000 THB",
                calcAmountLabel: "Payment Amount:",
                calcRateLabel: "Exchange Rate:",
                calcUsdtLabel: "USDT Amount:",
                calcFeeLabel: "Fee (3%):",
                calcTotalLabel: "Total Payment:",
                uploadText: "Store QR to pay (Required)",
                uploadRequired: "‚Äª QR code screenshot must be uploaded for payment",
                payNow: "Pay Now",
                activeOrders: "My Active Orders",
                completedOrders: "‚úÖ Completed Orders",
                noActiveOrders: "No active orders",
                noCompletedOrders: "No completed orders",
                modalTitle: "üî≥ USDT Transfer Guide",
                walletSelectionTitle: "Network:",
                step1Description: "Send USDT to the wallet address below",
                copyButtonText: "Copy Address",
                modalTotalLabel: "Total Payment:",
                orderIdLabel: "Order ID:",
                orderTimeLabel: "Order Time:",
                depositCompleteText: "Deposit Complete",
                timerLabel: "Time left:",
                autoUpdateText: "Check in Active Orders after payment completion",
                waitingDeposit: "Waiting Deposit",
                depositConfirmed: "Deposit Confirmed",
                processing: "Processing",
                completed: "Completed",
                cancelled: "Cancelled",
                rateLoading: "Loading...",
                rateError: "Failed to load rate",
                uploadRequiredAlert: "Please Store QR to pay (QR code screenshot) first",
                amountMinAlert: "Minimum payment amount is 1,000 THB",
                amountMaxAlert: "Maximum payment amount is 500,000 THB",
                languageBtnText: "ÌïúÍµ≠Ïñ¥",
                syncText: "Syncing...",
                showReceipts: "Show Receipts",
                hideReceipts: "Hide Receipts",
                proof: "Proof:",
                attached: "Attached",
                receipt: "Receipt:",
                viewReceipt: "View Receipt",
                installApp: "Install App",
                addToHomeScreen: "Add to Home Screen"
            },
            ko: {
                title: "USDT ‚Üí THB Í≤∞Ï†ú",
                subtitle: "Î°úÍ∑∏Ïù∏ ÏóÜÏù¥ USDTÎ°ú ÌÉúÍµ≠ Î∞îÌä∏(THB) Í≤∞Ï†úÌïòÍ∏∞",
                lastUpdate: "ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ",
                amountLabel: "üí∞ Í≤∞Ï†ú Í∏àÏï° ÏûÖÎ†• (THB):",
                amountLimit: "ÏµúÏÜå 1,000 THB ~ ÏµúÎåÄ 500,000 THB",
                calcAmountLabel: "Í≤∞Ï†ú Í∏àÏï°:",
                calcRateLabel: "ÌôòÏú®:",
                calcUsdtLabel: "USDT Í∏àÏï°:",
                calcFeeLabel: "ÏàòÏàòÎ£å (3%):",
                calcTotalLabel: "Ï¥ù Í≤∞Ï†ú Í∏àÏï°:",
                uploadText: "Í≤∞Ï†ú Ìï† ÏÉÅÏ†ê QR (ÌïÑÏàò)",
                uploadRequired: "‚Äª Í≤∞Ï†úÎ•º ÏúÑÌï¥ QR ÏΩîÎìú Ïä§ÌÅ¨Î¶∞ÏÉ∑ÏùÑ ÏóÖÎ°úÎìúÌï¥Ïïº Ìï©ÎãàÎã§",
                payNow: "ÏßÄÍ∏à Í≤∞Ï†úÌïòÍ∏∞",
                activeOrders: "ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏",
                completedOrders: "‚úÖ ÏôÑÎ£åÎêú Ï£ºÎ¨∏",
                noActiveOrders: "ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§",
                noCompletedOrders: "ÏôÑÎ£åÎêú Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§",
                modalTitle: "üî≥ USDT Ï†ÑÏÜ° ÏïàÎÇ¥",
                walletSelectionTitle: "ÎÑ§Ìä∏ÏõåÌÅ¨:",
                step1Description: "ÏïÑÎûò ÏßÄÍ∞ë Ï£ºÏÜåÎ°ú USDTÎ•º Ï†ÑÏÜ°Ìï¥Ï£ºÏÑ∏Ïöî",
                copyButtonText: "Ï£ºÏÜå Î≥µÏÇ¨",
                modalTotalLabel: "Ï¥ù Í≤∞Ï†ú Í∏àÏï°:",
                orderIdLabel: "Ï£ºÎ¨∏ ID:",
                orderTimeLabel: "Ï£ºÎ¨∏ ÏãúÍ∞Ñ:",
                depositCompleteText: "ÏûÖÍ∏à ÏôÑÎ£å",
                timerLabel: "ÎÇ®ÏùÄ ÏãúÍ∞Ñ:",
                autoUpdateText: "Í≤∞Ï†ú ÏôÑÎ£å ÌõÑ ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏ÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî",
                waitingDeposit: "ÏûÖÍ∏àÎåÄÍ∏∞",
                depositConfirmed: "ÏûÖÍ∏àÌôïÏù∏",
                processing: "Ï≤òÎ¶¨Ï§ë",
                completed: "ÏôÑÎ£å",
                cancelled: "Ï∑®ÏÜå",
                rateLoading: "Î°úÎî© Ï§ë...",
                rateError: "ÌôòÏú® Î°úÎî© Ïã§Ìå®",
                uploadRequiredAlert: "Î®ºÏ†Ä Í≤∞Ï†ú Ìï† ÏÉÅÏ†ê QR(QR ÏΩîÎìú Ïä§ÌÅ¨Î¶∞ÏÉ∑)ÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî",
                amountMinAlert: "ÏµúÏÜå Í≤∞Ï†ú Í∏àÏï°ÏùÄ 1,000 THB ÏûÖÎãàÎã§",
                amountMaxAlert: "ÏµúÎåÄ Í≤∞Ï†ú Í∏àÏï°ÏùÄ 500,000 THB ÏûÖÎãàÎã§",
                languageBtnText: "English",
                syncText: "ÎèôÍ∏∞Ìôî Ï§ë...",
                showReceipts: "ÏòÅÏàòÏ¶ù Î≥¥Í∏∞",
                hideReceipts: "ÏòÅÏàòÏ¶ù Ïà®Í∏∞Í∏∞",
                proof: "Ï¶ùÎ™ÖÏÑú:",
                attached: "Ï≤®Î∂ÄÎê®",
                receipt: "ÏòÅÏàòÏ¶ù:",
                viewReceipt: "ÏòÅÏàòÏ¶ù Î≥¥Í∏∞",
                installApp: "Ïï± ÏÑ§Ïπò",
                addToHomeScreen: "Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä"
            }
        };

        // ==================== PWA ÏÑ§Ïπò Í∏∞Îä• ====================
        function initializePWA() {
            // Ï†ÑÏó≠ Î≥ÄÏàò ÏÑ§Ï†ï
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                                window.navigator.standalone === true;

            console.log('PWA Í∞êÏßÄ:', { isIOS, isAndroid, isStandalone });

            const installButton = document.getElementById('installButton');
            const installToast = document.getElementById('installToast');

            // iOS Chrome Í∞êÏßÄ
            const isChromeIOS = /CriOS|Chrome/.test(navigator.userAgent) && isIOS;

            // iOS ChromeÏù¥Î©¥ ÎßÅÌÅ¨ Î≥µÏÇ¨Îßå Ï†úÍ≥µ
            if (isChromeIOS) {
                console.log('iOS Chrome Í∞êÏßÄ - ÎßÅÌÅ¨ Î≥µÏÇ¨ Í∏∞Îä• Ï†úÍ≥µ');
                installButton.classList.remove('hidden');
                document.getElementById('installButtonText').textContent = 'ÎßÅÌÅ¨ Î≥µÏÇ¨';
                
                installButton.onclick = () => {
                    copyCurrentUrl();
                };
                return;
            }

            // Î™®Î∞îÏùº Ïû•ÏπòÏù∏ÏßÄ ÌôïÏù∏
            const isMobile = isAndroid || isIOS;
            
            // Î™®Î∞îÏùºÏù¥ ÏïÑÎãàÎ©¥ Î≤ÑÌäº Ïà®ÍπÄ
            if (!isMobile) {
                installButton.classList.add('hidden');
                return;
            }

            // Ïù¥ÎØ∏ ÏÑ§ÏπòÎêú Í≤ΩÏö∞
            if (isStandalone) {
                const trans = translations[currentLang];
                document.getElementById('installButtonText').textContent = trans.installApp;
                installButton.classList.remove('hidden');
                
                installButton.onclick = () => {
                    if (isAndroid) {
                        window.location.reload();
                    } else {
                        showIOSQuickGuide();
                    }
                };
                return;
            }

            // Android/Îç∞Ïä§ÌÅ¨ÌÜ± ChromeÏùò Í≤ΩÏö∞
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('‚úÖ beforeinstallprompt Ïù¥Î≤§Ìä∏ Î∞úÏÉù');
                e.preventDefault();
                deferredPrompt = e;
                
                installButton.classList.remove('hidden');
                const trans = translations[currentLang];
                document.getElementById('installButtonText').textContent = trans.installApp;
                installPromptShown = true;
                
                showInstallToast('üì± ' + (currentLang === 'en' ? 'Install the app for more convenience!' : 'Ïï±ÏùÑ ÏÑ§ÏπòÌïòÎ©¥ Îçî Ìé∏Î¶¨Ìï¥Ïöî!'), 3000);
                
                installButton.onclick = async () => {
                    console.log('ÏÑ§Ïπò Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                    if (deferredPrompt) {
                        installButton.classList.add('hidden');
                        
                        deferredPrompt.prompt();
                        
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`ÏÇ¨Ïö©Ïûê ÏùëÎãµ: ${outcome}`);
                        
                        if (outcome === 'accepted') {
                            console.log('PWA ÏÑ§Ïπò ÏàòÎùΩÎê®');
                            showInstallToast('‚úÖ ' + (currentLang === 'en' ? 'App installation started!' : 'Ïï± ÏÑ§ÏπòÍ∞Ä ÏãúÏûëÎê©ÎãàÎã§!'), 2000);
                        } else {
                            showInstallToast(currentLang === 'en' ? 'Installation cancelled' : 'ÏÑ§ÏπòÍ∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§', 2000);
                            setTimeout(() => {
                                installButton.classList.remove('hidden');
                            }, 3000);
                        }
                        
                        deferredPrompt = null;
                    }
                };
            });

            // beforeinstallprompt Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÏßÄ ÏïäÏùÑ Í≤ΩÏö∞
            setTimeout(() => {
                if (!installPromptShown && !isStandalone && isMobile) {
                    showManualInstallOption(isAndroid, isIOS);
                }
            }, 5000);

            // ÏÑ§Ïπò ÏôÑÎ£å ÌõÑ
            window.addEventListener('appinstalled', () => {
                console.log('üéâ PWAÍ∞Ä ÏÑ§ÏπòÎêòÏóàÏäµÎãàÎã§');
                installButton.classList.add('hidden');
                showInstallToast('üéâ ' + (currentLang === 'en' ? 'App installed! Check on home screen.' : 'Ïï± ÏÑ§Ïπò ÏôÑÎ£å! Ìôà ÌôîÎ©¥ÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.'), 3000);
                deferredPrompt = null;
            });
        }

        function showManualInstallOption(isAndroid, isIOS) {
            const installButton = document.getElementById('installButton');
            const installToast = document.getElementById('installToast');
            
            if (!installButton || !installToast) return;
            
            installButton.classList.remove('hidden');
            
            if (isAndroid) {
                const trans = translations[currentLang];
                document.getElementById('installButtonText').textContent = trans.installApp;
                
                installButton.onclick = () => {
                    const trans = translations[currentLang];
                    installToast.innerHTML = `
                        <strong>üì± ${currentLang === 'en' ? 'Install app in Chrome' : 'ChromeÏóêÏÑú Ïï± ÏÑ§ÏπòÌïòÍ∏∞'}</strong><br>
                        1. ${currentLang === 'en' ? 'Tap Chrome menu (‚ãÆ)' : 'Chrome Î©îÎâ¥(‚ãÆ) ÌÉ≠'}<br>
                        2. <strong>'${currentLang === 'en' ? 'Install app' : 'Ïï± ÏÑ§Ïπò'}'</strong> ${currentLang === 'en' ? 'select' : 'ÏÑ†ÌÉù'}<br>
                        3. <strong>'${currentLang === 'en' ? 'Install' : 'ÏÑ§Ïπò'}'</strong> ${currentLang === 'en' ? 'button tap' : 'Î≤ÑÌäº ÌÉ≠'}<br>
                        <br>
                        <small style="color:#666;">${currentLang === 'en' ? 'Or click the üì≤ icon next to address bar' : 'ÎòêÎäî Ï£ºÏÜåÏ∞Ω ÏòÜÏùò üì≤ ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠'}</small>
                    `;
                    installToast.classList.add('show');
                    
                    setTimeout(() => {
                        installToast.classList.remove('show');
                        installToast.classList.add('hide');
                        setTimeout(() => {
                            installToast.classList.remove('hide');
                        }, 300);
                    }, 7000);
                };
            }
            else if (isIOS) {
                const trans = translations[currentLang];
                document.getElementById('installButtonText').textContent = trans.addToHomeScreen;
                
                installButton.onclick = () => {
                    copyCurrentUrl();
                };
            }
        }

        function copyCurrentUrl() {
            const url = window.location.href;
            const trans = translations[currentLang];
            
            navigator.clipboard.writeText(url)
                .then(() => {
                    showInstallToast('üîó ' + trans.copyButtonText + '! ' + (currentLang === 'en' ? 'Paste in Safari' : 'SafariÏóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî'), 3000);
                })
                .catch(err => {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                    // ÎåÄÏ≤¥ Î∞©Î≤ï
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    showInstallToast('üîó ' + trans.copyButtonText + '! ' + (currentLang === 'en' ? 'Paste in Safari' : 'SafariÏóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî'), 3000);
                });
        }

        function showIOSQuickGuide() {
            const installToast = document.getElementById('installToast');
            const trans = translations[currentLang];
            
            installToast.innerHTML = `
                <strong>üì± ${currentLang === 'en' ? 'Install app on iOS' : 'iOSÏóêÏÑú Ïï± ÏÑ§ÏπòÌïòÍ∏∞'}</strong><br><br>
                1. ${currentLang === 'en' ? 'Open this page in Safari' : 'SafariÏóêÏÑú Ïù¥ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞'}<br>
                2. ${currentLang === 'en' ? 'Tap share button (üì§)' : 'Í≥µÏú† Î≤ÑÌäº(üì§) ÌÉ≠ÌïòÍ∏∞'}<br>
                3. ${currentLang === 'en' ? 'Scroll down' : 'ÏïÑÎûòÎ°ú Ïä§ÌÅ¨Î°§'}<br>
                4. <strong>'${currentLang === 'en' ? 'Add to Home Screen' : 'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä'}'</strong> ${currentLang === 'en' ? 'select' : 'ÏÑ†ÌÉù'}<br>
                5. <strong>'${currentLang === 'en' ? 'Add' : 'Ï∂îÍ∞Ä'}'</strong> ${currentLang === 'en' ? 'button tap' : 'Î≤ÑÌäº ÌÉ≠ÌïòÍ∏∞'}
            `;
            installToast.classList.add('show');
            
            setTimeout(() => {
                installToast.classList.remove('show');
                installToast.classList.add('hide');
                setTimeout(() => {
                    installToast.classList.remove('hide');
                }, 300);
            }, 8000);
        }

        function showInstallToast(message, duration = 3000) {
            const installToast = document.getElementById('installToast');
            if (!installToast) return;
            
            installToast.innerHTML = message;
            installToast.classList.remove('hide');
            installToast.classList.add('show');
            
            setTimeout(() => {
                installToast.classList.remove('show');
                installToast.classList.add('hide');
                setTimeout(() => {
                    installToast.classList.remove('hide');
                }, 300);
            }, duration);
        }

        // ==================== Service Worker Ïò§Î•ò ÏàòÏ†ï ====================
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                console.log('Service Worker ÏßÄÏõêÎê®');
                
                // ÌòÑÏû¨ ÏúÑÏπòÏóêÏÑú service-worker.js Ï∞æÍ∏∞
                const swUrl = './service-worker.js';
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('‚úÖ Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration.scope);
                    })
                    .catch(error => {
                        console.warn('‚ö†Ô∏è Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                        // ÌååÏùºÏù¥ ÏóÜÏñ¥ÎèÑ Î¨¥Ïãú (ÌïÑÏàò ÏïÑÎãò)
                    });
            } else {
                console.log('Service WorkerÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Î∏åÎùºÏö∞Ï†Ä');
            }
        }

        // ==================== Í∞ÄÏû• ÏïàÏ†ïÏ†ÅÏù∏ ÌôòÏú® API ====================
        async function fetchRealTimeExchangeRate() {
            try {
                console.log('ÌôòÏú® Ï°∞Ìöå ÏãúÏûë...');
                
                // Í∞ÄÏû• ÏïàÏ†ïÏ†ÅÏù∏ API 1Í∞úÎßå ÏÇ¨Ïö© (Frankfurter.app)
                // Ïù¥ APIÎäî CORSÎ•º ÏßÄÏõêÌïòÍ≥† Î¨¥Î£åÏù¥Î©∞ ÏïàÏ†ïÏ†ÅÏûÖÎãàÎã§.
                const apiUrl = 'https://api.frankfurter.app/latest?from=USD&to=THB';
                
                try {
                    const response = await fetch(apiUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const rate = data.rates?.THB;
                        
                        if (rate && parseFloat(rate) > 0) {
                            console.log('Frankfurter API ÏÑ±Í≥µ:', rate);
                            updateExchangeRateDisplay(parseFloat(rate), true);
                            return;
                        }
                    }
                } catch (fetchError) {
                    console.log('Frankfurter API Ïã§Ìå®:', fetchError.message);
                }
                
                // Î∞±ÏóÖ API ÏãúÎèÑ (currency-api)
                try {
                    const backupUrl = 'https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json';
                    const response = await fetch(backupUrl);
                    
                    if (response.ok) {
                        const data = await response.json();
                        const rate = data.usd?.thb;
                        
                        if (rate && parseFloat(rate) > 0) {
                            console.log('Currency-API ÏÑ±Í≥µ:', rate);
                            updateExchangeRateDisplay(parseFloat(rate), true);
                            return;
                        }
                    }
                } catch (backupError) {
                    console.log('Î∞±ÏóÖ API Ïã§Ìå®:', backupError.message);
                }
                
                // Î™®Îëê Ïã§Ìå® Ïãú Í∏∞Î≥∏Í∞í
                console.log('Î™®Îì† API Ïã§Ìå®, Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©');
                updateExchangeRateDisplay(35.5, false);
                
            } catch (error) {
                console.error('ÌôòÏú® Ï°∞Ìöå Ïò§Î•ò:', error);
                updateExchangeRateDisplay(35.5, false);
            }
        }
        
        function updateExchangeRateDisplay(rate, success) {
            exchangeRate = rate;
            
            const rateElement = document.getElementById('exchangeRate');
            const calcRateElement = document.getElementById('calcRate');
            
            if (success) {
                rateElement.innerHTML = `<span style="color:#e53e3e;font-weight:bold;">${rate.toFixed(2)}</span>`;
                if (calcRateElement) calcRateElement.textContent = rate.toFixed(2);
            } else {
                rateElement.innerHTML = `<span style="color:#e53e3e;font-weight:bold;">${rate.toFixed(2)}</span>`;
                if (calcRateElement) calcRateElement.textContent = rate.toFixed(2);
            }
            
            const trans = translations[currentLang];
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: false 
            });
            
            const rateUpdateElement = document.getElementById('rateUpdate');
            if (rateUpdateElement) {
                rateUpdateElement.textContent = trans.lastUpdate + timeString;
            }
            
            updateCalculation();
        }

        // ==================== ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ÏÇ¨Ïö©Ïûê ÌéòÏù¥ÏßÄ Î°úÎìúÎê®');
            
            // PWA ÏÑ§Ïπò Í∏∞Îä• Ï¥àÍ∏∞Ìôî
            initializePWA();
            
            // Service Worker Îì±Î°ù (Ïò§Î•ò ÏàòÏ†ïÎêú Î∞©Ïãù)
            registerServiceWorker();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Í≤∞Ï†ú Ìèº Ï¥àÍ∏∞Ìôî
            resetPaymentForm();
            
            // Ïñ∏Ïñ¥ Ï¥àÍ∏∞Ìôî
            initLanguageButton();
            updateLanguageButtonText();
            updateAllText();
            
            // Ï≤´ Î≤àÏß∏ Î°úÎî©ÏùÄ Î∞îÎ°ú Ïã§Ìñâ
            setTimeout(fetchRealTimeExchangeRate, 100);
            
            // 30Ï¥àÏóê Ìïú Î≤à ÌôòÏú® ÏóÖÎç∞Ïù¥Ìä∏
            setInterval(fetchRealTimeExchangeRate, 30000);
            
            // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            loadInitialData();
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            setupEventListeners();
            
            // ÎèôÍ∏∞Ìôî Ï≤¥ÌÅ¨ ÏãúÏûë
            startSyncCheck();
            
            // Î™®Îã¨ Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            document.getElementById('qrModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    if (confirm(currentLang === 'en' ? 
                        'Cancel payment?\n\nCurrent payment will be cancelled and form will be reset.' : 
                        'Í≤∞Ï†úÎ•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÌòÑÏû¨ Í≤∞Ï†úÍ∞Ä Ï∑®ÏÜåÎêòÍ≥† ÌèºÏù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.')) {
                        cancelPayment();
                    }
                }
            });
            
            // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !document.getElementById('qrModal').classList.contains('hidden')) {
                    if (confirm(currentLang === 'en' ? 
                        'Cancel payment?\n\nCurrent payment will be cancelled and form will be reset.' : 
                        'Í≤∞Ï†úÎ•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÌòÑÏû¨ Í≤∞Ï†úÍ∞Ä Ï∑®ÏÜåÎêòÍ≥† ÌèºÏù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.')) {
                        cancelPayment();
                    }
                }
            });
            
            console.log('ÏÇ¨Ïö©Ïûê ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        });

        // ==================== Îç∞Ïù¥ÌÑ∞ Î°úÎìú ====================
        function loadInitialData() {
            allOrders = dataManager.getOrders();
            console.log('Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú:', allOrders.length, 'Í∞ú');
            
            allWallets = dataManager.getWallets();
            activeWallet = dataManager.getActiveWallet();
            console.log('ÏßÄÍ∞ë Îç∞Ïù¥ÌÑ∞ Î°úÎìú:', allWallets.length, 'Í∞ú', 'ÌôúÏÑ± ÏßÄÍ∞ë:', activeWallet?.name);
            
            updateOrdersList();
            updateWalletDisplay();
            
            checkPaymentButton();
            
            dataManager.updateUserSync();
        }

        // ==================== Ïñ∏Ïñ¥ Í¥ÄÎ†® Ìï®Ïàò ====================
        function initLanguageButton() {
            const languageBtn = document.getElementById('languageToggleBtn');
            if (!languageBtn) return;
            
            languageBtn.addEventListener('click', toggleLanguage);
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ko' : 'en';
            updateLanguageButtonText();
            updateAllText();
        }

        function updateLanguageButtonText() {
            const trans = translations[currentLang];
            const btnText = document.getElementById('languageBtnText');
            if (btnText && trans) {
                btnText.textContent = trans.languageBtnText;
            }
        }

        function updateAllText() {
            const trans = translations[currentLang];
            
            // Î™®Îì† ÌÖçÏä§Ìä∏ ÏöîÏÜå ÏóÖÎç∞Ïù¥Ìä∏
            const elements = {
                'pageTitle': trans.title,
                'pageSubtitle': trans.subtitle,
                'exchangeTitle': 'üí± ' + (currentLang === 'en' ? 'Real-time Exchange Rate' : 'Ïã§ÏãúÍ∞Ñ ÌôòÏú®'),
                'amountLabel': trans.amountLabel,
                'amountLimit': trans.amountLimit,
                'calcAmountLabel': trans.calcAmountLabel,
                'calcRateLabel': trans.calcRateLabel,
                'calcUsdtLabel': trans.calcUsdtLabel,
                'calcFeeLabel': trans.calcFeeLabel,
                'calcTotalLabel': trans.calcTotalLabel,
                'uploadRequired': trans.uploadRequired,
                'payButtonText': trans.payNow,
                'activeOrdersTitle': trans.activeOrders,
                'completedOrdersTitle': trans.completedOrders,
                'noActiveOrders': trans.noActiveOrders,
                'noCompletedOrders': trans.noCompletedOrders,
                'syncText': trans.syncText,
                'toggleReceiptBtn': showReceipts ? trans.hideReceipts : trans.showReceipts
            };
            
            // Í∏∞Î≥∏ ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            for (const [id, text] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = text;
                }
            }
            
            // ‚úÖ ÌôòÏú® ÏóÖÎç∞Ïù¥Ìä∏ ÌÖçÏä§Ìä∏
            const rateUpdateElement = document.getElementById('rateUpdate');
            if (rateUpdateElement) {
                if (exchangeRate > 0) {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('ko-KR', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit',
                        hour12: false 
                    });
                    rateUpdateElement.textContent = trans.lastUpdate + timeString;
                } else {
                    rateUpdateElement.textContent = trans.lastUpdate + trans.rateLoading;
                }
            }
            
            // ‚úÖ ÏóÖÎ°úÎìú Î≤ÑÌäº ÌÖçÏä§Ìä∏
            const uploadButtonText = document.getElementById('uploadButtonText');
            if (uploadButtonText) {
                if (!uploadedFile) {
                    uploadButtonText.textContent = `üìé ${trans.uploadText}`;
                } else {
                    const uploadCompletedText = currentLang === 'en' ? 'Upload completed' : 'ÏóÖÎ°úÎìú ÏôÑÎ£å';
                    uploadButtonText.innerHTML = 
                        `‚úÖ ${uploadCompletedText}<br><span style="font-size:11px;color:#718096;">${uploadedFile.name}</span>`;
                }
            }
            
            // ÌôòÏú® Ïà´Ïûê ÌëúÏãú
            if (exchangeRate > 0) {
                document.getElementById('exchangeRate').innerHTML = 
                    `<span style="color:#e53e3e;font-weight:bold;">${exchangeRate.toFixed(2)}</span>`;
            }
            
            // Î™®Îã¨ ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            if (!document.getElementById('qrModal').classList.contains('hidden')) {
                updateModalText();
            }
            
            updateOrdersList();
        }

        // ==================== Í≥ÑÏÇ∞ Î∞è Í≤∞Ï†ú Í¥ÄÎ†® Ìï®Ïàò ====================
        function updateCalculation() {
            const amount = parseInt(document.getElementById('thbAmount').value) || 0;
            const calcPreview = document.getElementById('calcPreview');
            
            const minAmount = 1000;
            const maxAmount = 500000;
            
            if (amount < minAmount || amount > maxAmount) {
                calcPreview.style.display = 'none';
                document.getElementById('payButton').disabled = true;
                return;
            }
            
            if (amount > 0 && exchangeRate > 0) {
                calcPreview.style.display = 'block';
                
                const usdtAmount = amount / exchangeRate;
                const fee = usdtAmount * 0.03;
                const total = usdtAmount + fee;
                
                document.getElementById('calcAmount').textContent = amount.toLocaleString() + ' THB';
                document.getElementById('calcUsdt').textContent = usdtAmount.toFixed(4) + ' USDT';
                document.getElementById('calcFee').textContent = fee.toFixed(4) + ' USDT';
                document.getElementById('calcTotal').textContent = total.toFixed(4) + ' USDT';
                
                checkPaymentButton();
            } else {
                calcPreview.style.display = 'none';
                document.getElementById('payButton').disabled = true;
            }
        }

        function checkPaymentButton() {
            const amount = parseInt(document.getElementById('thbAmount').value) || 0;
            const payButton = document.getElementById('payButton');
            
            if (amount >= 1000 && amount <= 500000 && uploadedFile !== null && exchangeRate > 0) {
                payButton.disabled = false;
            } else {
                payButton.disabled = true;
            }
        }

        // ==================== Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ====================
        function setupEventListeners() {
            document.getElementById('thbAmount').addEventListener('input', updateCalculation);
            
            const fileInput = document.getElementById('paymentProof');
            
            document.querySelector('.upload-button').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    handleFileUpload(this.files[0]);
                } else {
                    uploadedFile = null;
                    checkPaymentButton();
                    const trans = translations[currentLang];
                    document.getElementById('uploadButtonText').textContent = `üìé ${trans.uploadText}`;
                    document.getElementById('uploadPreview').innerHTML = '';
                }
            });
            
            document.getElementById('payButton').addEventListener('click', function() {
                // Ïù¥ÎØ∏ ÏßÑÌñâ Ï§ëÏù∏ Í≤∞Ï†úÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
                const modal = document.getElementById('qrModal');
                if (!modal.classList.contains('hidden')) {
                    if (confirm(currentLang === 'en' ? 
                        'There is a payment in progress.\n\nDo you want to cancel it and start a new payment?' : 
                        'ÏßÑÌñâ Ï§ëÏù∏ Í≤∞Ï†úÍ∞Ä ÏûàÏäµÎãàÎã§.\n\nÏ∑®ÏÜåÌïòÍ≥† ÏÉà Í≤∞Ï†úÎ•º ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        cancelPayment();
                        // Ïû†Ïãú ÌõÑ ÏÉà Í≤∞Ï†ú ÏãúÏûë
                        setTimeout(() => startPayment(), 100);
                    }
                    return;
                }
                startPayment();
            });
            
            document.getElementById('closeModal').addEventListener('click', function() {
                if (confirm(currentLang === 'en' ? 
                    'Cancel payment?\n\nCurrent payment will be cancelled and form will be reset.' : 
                    'Í≤∞Ï†úÎ•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÌòÑÏû¨ Í≤∞Ï†úÍ∞Ä Ï∑®ÏÜåÎêòÍ≥† ÌèºÏù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.')) {
                    cancelPayment();
                }
            });
            
            document.getElementById('copyAddress').addEventListener('click', copyWalletAddress);
            
            document.getElementById('depositCompleteBtn').addEventListener('click', function() {
                const trans = translations[currentLang];
                const confirmMsg = currentLang === 'en' ? 
                    'I have completed the USDT transfer.\n\nThe administrator will confirm the deposit.' :
                    'USDT Ï†ÑÏÜ°ÏùÑ ÏôÑÎ£åÌñàÏäµÎãàÎã§.\n\nÍ¥ÄÎ¶¨ÏûêÍ∞Ä ÏûÖÍ∏àÏùÑ ÌôïÏù∏Ìï† Í≤ÉÏûÖÎãàÎã§.';
                
                if (confirm(confirmMsg)) {
                    closePaymentModal();
                }
            });
            
            // ÏòÅÏàòÏ¶ù ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏
            document.getElementById('toggleReceiptBtn').addEventListener('click', function() {
                showReceipts = !showReceipts;
                updateReceiptButtonText();
                updateOrdersList();
            });
            
            // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïù¥Î≤§Ìä∏
            document.getElementById('activeOrdersPrevBtn').addEventListener('click', function() {
                if (activeOrdersPage > 1) {
                    activeOrdersPage--;
                    updateActiveOrdersPage();
                }
            });
            
            document.getElementById('activeOrdersNextBtn').addEventListener('click', function() {
                const activeOrders = allOrders.filter(order => 
                    order.status === 'ÏûÖÍ∏àÎåÄÍ∏∞' || 
                    order.status === 'ÏûÖÍ∏àÌôïÏù∏' || 
                    order.status === 'Ï≤òÎ¶¨Ï§ë'
                );
                const totalPages = Math.ceil(activeOrders.length / ORDERS_PER_PAGE);
                if (activeOrdersPage < totalPages) {
                    activeOrdersPage++;
                    updateActiveOrdersPage();
                }
            });
            
            document.getElementById('completedOrdersPrevBtn').addEventListener('click', function() {
                if (completedOrdersPage > 1) {
                    completedOrdersPage--;
                    updateCompletedOrdersPage();
                }
            });
            
            document.getElementById('completedOrdersNextBtn').addEventListener('click', function() {
                const completedOrders = allOrders.filter(order => 
                    order.status === 'ÏôÑÎ£å' || 
                    order.status === 'Ï∑®ÏÜå'
                );
                const totalPages = Math.ceil(completedOrders.length / ORDERS_PER_PAGE);
                if (completedOrdersPage < totalPages) {
                    completedOrdersPage++;
                    updateCompletedOrdersPage();
                }
            });
            
            const uploadButton = document.querySelector('.upload-button');
            uploadButton.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#667eea';
            });
            
            uploadButton.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = '#cbd5e0';
            });
            
            uploadButton.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = '#cbd5e0';
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    handleFileUpload(file);
                    fileInput.files = e.dataTransfer.files;
                }
            });
        }

        // Í≤∞Ï†ú Ìèº Ï¥àÍ∏∞Ìôî
        function resetPaymentForm() {
            document.getElementById('thbAmount').value = '';
            document.getElementById('paymentProof').value = '';
            uploadedFile = null;
            
            const trans = translations[currentLang];
            const uploadButtonText = document.getElementById('uploadButtonText');
            if (uploadButtonText) {
                uploadButtonText.textContent = `üìé ${trans.uploadText}`;
            }
            
            const uploadPreview = document.getElementById('uploadPreview');
            if (uploadPreview) {
                uploadPreview.innerHTML = '';
            }
            
            const calcPreview = document.getElementById('calcPreview');
            if (calcPreview) {
                calcPreview.style.display = 'none';
            }
            
            document.getElementById('payButton').disabled = true;
            
            console.log('Í≤∞Ï†ú ÌèºÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
        }

        function updateReceiptButtonText() {
            const trans = translations[currentLang];
            const toggleReceiptBtn = document.getElementById('toggleReceiptBtn');
            
            if (toggleReceiptBtn) {
                toggleReceiptBtn.textContent = showReceipts ? trans.hideReceipts : trans.showReceipts;
            }
        }

        // ==================== ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ ====================
        function handleFileUpload(file) {
            console.log('ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ ÏãúÏûë:', file.name, file.type, file.size);
            
            if (!file) {
                uploadedFile = null;
                checkPaymentButton();
                return;
            }
            
            uploadedFile = file;
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                alert(currentLang === 'en' ? 
                    'File size must be less than 5MB' : 
                    'ÌååÏùº ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.');
                uploadedFile = null;
                checkPaymentButton();
                return;
            }
            
            const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type.toLowerCase())) {
                alert(currentLang === 'en' ? 
                    'Only images (JPEG, PNG, GIF, WebP) are allowed for QR code screenshot' : 
                    'QR ÏΩîÎìú Ïä§ÌÅ¨Î¶∞ÏÉ∑ÏùÄ Ïù¥ÎØ∏ÏßÄ(JPEG, PNG, GIF, WebP) ÌååÏùºÎßå ÌóàÏö©Îê©ÎãàÎã§.');
                uploadedFile = null;
                checkPaymentButton();
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('ÌååÏùº ÏùΩÍ∏∞ ÏôÑÎ£å');
                
                uploadedFile = file;
                updateAllText();
                
                const uploadPreview = document.getElementById('uploadPreview');
                if (uploadPreview) {
                    uploadPreview.innerHTML = `
                        <img src="${e.target.result}" alt="Payment proof" class="upload-preview-image">
                        <div class="file-info">
                            ${file.name} (${(file.size / 1024).toFixed(1)}KB)
                        </div>
                    `;
                }
                
                checkPaymentButton();
                console.log('ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ ÏôÑÎ£å');
            };
            
            reader.onerror = function(e) {
                console.error('ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò:', e);
                alert(currentLang === 'en' ? 
                    'Failed to read file. Please try again.' : 
                    'ÌååÏùºÏùÑ ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                uploadedFile = null;
                checkPaymentButton();
            };
            
            reader.readAsDataURL(file);
        }

        // ==================== Í≤∞Ï†ú ÏãúÏûë ====================
        function startPayment() {
            const amount = parseInt(document.getElementById('thbAmount').value);
            const trans = translations[currentLang];
            
            if (!amount || amount < 1000) {
                alert(trans.amountMinAlert);
                return;
            }
            
            if (amount > 500000) {
                alert(trans.amountMaxAlert);
                return;
            }
            
            if (!uploadedFile) {
                alert(trans.uploadRequiredAlert);
                return;
            }

            if (exchangeRate <= 0) {
                alert(currentLang === 'en' ? 
                    'Exchange rate is not loaded yet. Please wait.' : 
                    'ÌôòÏú®Ïù¥ ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.');
                return;
            }

            currentOrderId = dataManager.generateOrderId();
            document.getElementById('orderId').textContent = currentOrderId;
            
            const usdtAmount = amount / exchangeRate;
            const fee = usdtAmount * 0.03;
            const total = usdtAmount + fee;
            
            document.getElementById('modalTotal').textContent = total.toFixed(4) + ' USDT';
            
            const now = new Date();
            document.getElementById('orderTime').textContent = now.toLocaleString('ko-KR');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const proofData = {
                    name: uploadedFile.name,
                    type: uploadedFile.type,
                    size: uploadedFile.size,
                    data: e.target.result
                };
                
                const order = {
                    id: currentOrderId,
                    amount: amount,
                    usdt: total,
                    status: 'ÏûÖÍ∏àÎåÄÍ∏∞',
                    step: 1,
                    time: now.toISOString(),
                    wallet: activeWallet ? {
                        id: activeWallet.id,
                        name: activeWallet.name,
                        address: activeWallet.address,
                        network: activeWallet.network
                    } : null,
                    proof: proofData
                };
                
                saveOrder(order);
                updateOrdersList();
                
                document.getElementById('qrModal').classList.remove('hidden');
                updateModalText();
                updateQRCodeDisplay();
                
                startTimer();
            };
            
            reader.onerror = function(e) {
                alert(currentLang === 'en' ? 
                    'File reading error. Please try again.' : 
                    'ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            };
            
            reader.readAsDataURL(uploadedFile);
        }

        // ==================== Ï£ºÎ¨∏ Ï†ÄÏû• ====================
        function saveOrder(order) {
            let orders = dataManager.getOrders();
            
            const existingIndex = orders.findIndex(o => o.id === order.id);
            
            if (existingIndex > -1) {
                orders[existingIndex] = order;
            } else {
                orders.unshift(order);
            }
            
            if (orders.length > 50) {
                orders = orders.slice(0, 50);
            }
            
            const saved = dataManager.saveOrders(orders);
            if (saved) {
                console.log('Ï£ºÎ¨∏ Ï†ÄÏû•Îê®:', order.id);
            } else {
                console.error('Ï£ºÎ¨∏ Ï†ÄÏû• Ïã§Ìå®:', order.id);
            }
            
            allOrders = orders;
        }

        // ==================== Ï£ºÎ¨∏ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ ====================
        function updateOrdersList() {
            const activeOrders = allOrders.filter(order => 
                order.status === 'ÏûÖÍ∏àÎåÄÍ∏∞' || 
                order.status === 'ÏûÖÍ∏àÌôïÏù∏' || 
                order.status === 'Ï≤òÎ¶¨Ï§ë'
            );
            
            const completedOrders = allOrders.filter(order => 
                order.status === 'ÏôÑÎ£å' || 
                order.status === 'Ï∑®ÏÜå'
            );
            
            updateActiveOrdersPage();
            updateCompletedOrdersPage();
            
            const activePagination = document.getElementById('activeOrdersPagination');
            if (activeOrders.length > ORDERS_PER_PAGE) {
                activePagination.style.display = 'flex';
            } else {
                activePagination.style.display = 'none';
            }
            
            const completedPagination = document.getElementById('completedOrdersPagination');
            if (completedOrders.length > ORDERS_PER_PAGE) {
                completedPagination.style.display = 'flex';
            } else {
                completedPagination.style.display = 'none';
            }
        }

        function updateActiveOrdersPage() {
            const trans = translations[currentLang];
            
            const activeOrders = allOrders.filter(order => 
                order.status === 'ÏûÖÍ∏àÎåÄÍ∏∞' || 
                order.status === 'ÏûÖÍ∏àÌôïÏù∏' || 
                order.status === 'Ï≤òÎ¶¨Ï§ë'
            );
            
            const activeOrdersContainer = document.getElementById('activeOrdersContainer');
            
            if (activeOrders.length === 0) {
                activeOrdersContainer.innerHTML = `
                    <div class="no-orders">
                        ${trans.noActiveOrders}
                    </div>
                `;
                return;
            }
            
            const startIndex = (activeOrdersPage - 1) * ORDERS_PER_PAGE;
            const endIndex = Math.min(startIndex + ORDERS_PER_PAGE, activeOrders.length);
            const currentPageOrders = activeOrders.slice(startIndex, endIndex);
            
            let html = '';
            currentPageOrders.forEach(order => {
                html += createOrderCard(order, false);
            });
            activeOrdersContainer.innerHTML = html;
            
            const totalPages = Math.ceil(activeOrders.length / ORDERS_PER_PAGE);
            document.getElementById('activeOrdersPageInfo').textContent = `${activeOrdersPage} / ${totalPages}`;
            
            document.getElementById('activeOrdersPrevBtn').disabled = activeOrdersPage <= 1;
            document.getElementById('activeOrdersNextBtn').disabled = activeOrdersPage >= totalPages;
            
            addOrderCardClickEvents();
        }

        function updateCompletedOrdersPage() {
            const trans = translations[currentLang];
            
            const completedOrders = allOrders.filter(order => 
                order.status === 'ÏôÑÎ£å' || 
                order.status === 'Ï∑®ÏÜå'
            );
            
            const completedOrdersContainer = document.getElementById('completedOrdersContainer');
            
            if (completedOrders.length === 0) {
                completedOrdersContainer.innerHTML = `
                    <div class="no-orders">
                        ${trans.noCompletedOrders}
                    </div>
                `;
                return;
            }
            
            const startIndex = (completedOrdersPage - 1) * ORDERS_PER_PAGE;
            const endIndex = Math.min(startIndex + ORDERS_PER_PAGE, completedOrders.length);
            const currentPageOrders = completedOrders.slice(startIndex, endIndex);
            
            let html = '';
            currentPageOrders.forEach(order => {
                html += createOrderCard(order, showReceipts);
            });
            completedOrdersContainer.innerHTML = html;
            
            const totalPages = Math.ceil(completedOrders.length / ORDERS_PER_PAGE);
            document.getElementById('completedOrdersPageInfo').textContent = `${completedOrdersPage} / ${totalPages}`;
            
            document.getElementById('completedOrdersPrevBtn').disabled = completedOrdersPage <= 1;
            document.getElementById('completedOrdersNextBtn').disabled = completedOrdersPage >= totalPages;
            
            addOrderCardClickEvents();
        }

        function createOrderCard(order, showReceipt = false) {
            const trans = translations[currentLang];
            
            const statusClass = {
                'ÏûÖÍ∏àÎåÄÍ∏∞': 'status-waiting',
                'ÏûÖÍ∏àÌôïÏù∏': 'status-confirmed',
                'Ï≤òÎ¶¨Ï§ë': 'status-processing',
                'ÏôÑÎ£å': 'status-completed',
                'Ï∑®ÏÜå': 'status-cancelled'
            }[order.status] || 'status-waiting';
            
            const statusText = {
                'ÏûÖÍ∏àÎåÄÍ∏∞': trans.waitingDeposit,
                'ÏûÖÍ∏àÌôïÏù∏': trans.depositConfirmed,
                'Ï≤òÎ¶¨Ï§ë': trans.processing,
                'ÏôÑÎ£å': trans.completed,
                'Ï∑®ÏÜå': trans.cancelled
            }[order.status] || order.status;
            
            const time = new Date(order.time).toLocaleString('ko-KR');
            
            let receiptHtml = '';
            if (order.receipt && order.receipt.data && order.status === 'ÏôÑÎ£å') {
                if (order.receipt.type && order.receipt.type.startsWith('image/')) {
                    receiptHtml = `
                        <div class="receipt-image-container ${showReceipt ? 'show' : ''}">
                            <img src="${order.receipt.data}" alt="Payment receipt" class="receipt-image">
                        </div>
                    `;
                }
            }
            
            const usdtLabel = currentLang === 'en' ? 'USDT Amount:' : 'USDT Í∏àÏï°:';
            const stepLabel = currentLang === 'en' ? 'Status:' : 'ÏÉÅÌÉú:';
            
            return `
                <div class="order-card ${statusClass}" data-order-id="${order.id}">
                    <div class="order-header">
                        <div>
                            <div class="order-id">${order.id}</div>
                            <div class="order-time">${time}</div>
                        </div>
                        <div class="status-badge ${statusClass}">${statusText}</div>
                    </div>
                    <div class="order-details">
                        <div class="order-amount">${order.amount.toLocaleString()} THB</div>
                        <div class="order-breakdown">
                            <div class="breakdown-item">
                                <span>${usdtLabel}</span>
                                <span>${order.usdt.toFixed(4)} USDT</span>
                            </div>
                            <div class="breakdown-item">
                                <span>${stepLabel}</span>
                                <span>${statusText}</span>
                            </div>
                            ${order.wallet ? `
                            <div class="breakdown-item">
                                <span>${currentLang === 'en' ? 'Network:' : 'ÎÑ§Ìä∏ÏõåÌÅ¨:'}</span>
                                <span>${order.wallet.network}</span>
                            </div>
                            ` : ''}
                            ${receiptHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        function addOrderCardClickEvents() {
            document.querySelectorAll('#completedOrdersContainer .order-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    const receiptImageContainer = this.querySelector('.receipt-image-container');
                    if (receiptImageContainer) {
                        receiptImageContainer.classList.toggle('show');
                    }
                });
            });
        }

        // ==================== Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò ====================
        function updateModalText() {
            const trans = translations[currentLang];
            
            document.getElementById('modalTitle').textContent = trans.modalTitle;
            document.getElementById('walletSelectionTitle').textContent = trans.walletSelectionTitle;
            document.getElementById('step1Description').textContent = trans.step1Description;
            document.getElementById('copyButtonText').textContent = trans.copyButtonText;
            document.getElementById('modalTotalLabel').textContent = trans.modalTotalLabel;
            document.getElementById('orderIdLabel').textContent = trans.orderIdLabel;
            document.getElementById('orderTimeLabel').textContent = trans.orderTimeLabel;
            document.getElementById('depositCompleteText').textContent = trans.depositCompleteText;
            document.getElementById('timerLabel').textContent = trans.timerLabel;
            document.getElementById('autoUpdateText').textContent = trans.autoUpdateText;
        }

        function updateWalletDisplay() {
            if (!activeWallet) {
                console.log('ÌôúÏÑ± ÏßÄÍ∞ëÏù¥ ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            console.log('ÏßÄÍ∞ë Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏:', activeWallet.name);
            document.getElementById('walletAddress').textContent = activeWallet.address;
            const networkClass = `network-${activeWallet.network.toLowerCase()}`;
            
            let networkText = '';
            switch(activeWallet.network) {
                case 'TRC20': networkText = 'TRC20 Network'; break;
                case 'ERC20': networkText = 'ERC20 Network'; break;
                case 'BEP20': networkText = 'BEP20 Network'; break;
                default: networkText = activeWallet.network + ' Network';
            }
            
            document.getElementById('selectedWalletInfo').innerHTML = `
                <div class="wallet-icon">üëõ</div>
                <div class="wallet-details">
                    <div class="wallet-network">
                        ${networkText}
                        <span class="network-badge ${networkClass}">${activeWallet.network}</span>
                    </div>
                </div>
            `;
        }

        function updateQRCodeDisplay() {
            if (!activeWallet) {
                console.log('ÌôúÏÑ± ÏßÄÍ∞ëÏù¥ ÏóÜÏùå');
                return;
            }
            
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            if (!qrCodeContainer) return;
            
            qrCodeContainer.innerHTML = '';
            
            if (activeWallet.qrCode && 
                activeWallet.qrCode !== 'null' && 
                activeWallet.qrCode !== '' && 
                activeWallet.qrCode !== null &&
                typeof activeWallet.qrCode === 'string' && 
                activeWallet.qrCode.startsWith('data:image/')) {
                
                console.log('QR ÏΩîÎìú ÌëúÏãú ÏãúÎèÑ:', activeWallet.id);
                
                const img = document.createElement('img');
                img.src = activeWallet.qrCode;
                img.alt = 'QR Code';
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                img.style.borderRadius = '4px';
                
                img.onerror = function() {
                    console.log('QR ÏΩîÎìú Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®');
                    this.style.display = 'none';
                    const errorDiv = document.createElement('div');
                    errorDiv.style.color = '#999';
                    errorDiv.style.fontSize = '12px';
                    errorDiv.style.textAlign = 'center';
                    errorDiv.style.padding = '20px';
                    errorDiv.textContent = 'QR ÏΩîÎìú Î°úÎìú Ïã§Ìå®';
                    qrCodeContainer.appendChild(errorDiv);
                };
                
                img.onload = function() {
                    console.log('QR ÏΩîÎìú Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏÑ±Í≥µ');
                };
                
                qrCodeContainer.appendChild(img);
                
            } else {
                console.log('QR ÏΩîÎìú ÏóÜÏùå, ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî ÌëúÏãú');
                const placeholder = document.createElement('div');
                placeholder.className = 'qr-placeholder';
                placeholder.textContent = 'üî≥';
                placeholder.style.fontSize = '40px';
                placeholder.style.marginBottom = '10px';
                placeholder.style.textAlign = 'center';
                qrCodeContainer.appendChild(placeholder);
            }
        }

        function copyWalletAddress() {
            const address = document.getElementById('walletAddress').textContent;
            navigator.clipboard.writeText(address)
                .then(() => {
                    const copiedText = currentLang === 'en' ? 'Copied' : 'Î≥µÏÇ¨Îê®';
                    document.getElementById('copyButtonText').textContent = copiedText;
                    setTimeout(() => {
                        const trans = translations[currentLang];
                        document.getElementById('copyButtonText').textContent = trans.copyButtonText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                });
        }

        // ==================== ÌÉÄÏù¥Î®∏ ====================
        function startTimer() {
            timeLeft = 300;
            updateTimerDisplay();
            
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert(currentLang === 'en' ? 
                        'Payment time expired' : 
                        'Í≤∞Ï†ú ÏãúÍ∞ÑÏù¥ ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§');
                    cancelPayment();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timeLeft').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // ==================== Í≤∞Ï†ú Ï∑®ÏÜå/ÏôÑÎ£å ====================
        function cancelPayment() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            if (currentOrderId) {
                updateOrderStatus('Ï∑®ÏÜå');
                currentOrderId = '';
            }
            
            document.getElementById('qrModal').classList.add('hidden');
            resetPaymentForm();
            alert(currentLang === 'en' ? 'Payment cancelled' : 'Í≤∞Ï†úÍ∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§');
        }

        function closePaymentModal() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            document.getElementById('qrModal').classList.add('hidden');
            resetPaymentForm();
            
            alert(currentLang === 'en' ? 
                'Thank you for your payment. Please check the status in Active Orders.' : 
                'Í≤∞Ï†úÌï¥ Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§. ÏßÑÌñâ Ï§ëÏù∏ Ï£ºÎ¨∏ÏóêÏÑú ÏÉÅÌÉúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
        }

        function updateOrderStatus(status) {
            const orderIndex = allOrders.findIndex(o => o.id === currentOrderId);
            if (orderIndex === -1) return;
            
            allOrders[orderIndex] = {
                ...allOrders[orderIndex],
                status: status,
                updated: new Date().toISOString()
            };
            
            dataManager.saveOrders(allOrders);
            updateOrdersList();
        }

        // ==================== Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî ====================
        function checkDataSync() {
            if (dataManager.needsSync()) {
                showSyncStatus();
                
                const updatedOrders = dataManager.getOrders();
                const updatedWallets = dataManager.getWallets();
                
                if (JSON.stringify(updatedOrders) !== JSON.stringify(allOrders)) {
                    console.log('üìä Ï£ºÎ¨∏ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏Îê®');
                    allOrders = updatedOrders;
                    updateOrdersList();
                    
                    if (currentOrderId) {
                        const currentOrder = allOrders.find(o => o.id === currentOrderId);
                        if (currentOrder) {
                            document.getElementById('modalTotal').textContent = 
                                currentOrder.usdt.toFixed(4) + ' USDT';
                        }
                    }
                }
                
                if (JSON.stringify(updatedWallets) !== JSON.stringify(allWallets)) {
                    console.log('üëõ ÏßÄÍ∞ë Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏Îê®');
                    allWallets = updatedWallets;
                    activeWallet = dataManager.getActiveWallet();
                    
                    updateWalletDisplay();
                    
                    const modal = document.getElementById('qrModal');
                    if (!modal.classList.contains('hidden')) {
                        updateQRCodeDisplay();
                    }
                }
                
                dataManager.updateUserSync();
                setTimeout(hideSyncStatus, 2000);
            }
        }

        function startSyncCheck() {
            if (syncCheckInterval) clearInterval(syncCheckInterval);
            
            console.log('üîÑ ÎèôÍ∏∞Ìôî Ï≤¥ÌÅ¨ ÏãúÏûë (1Ï¥à Í∞ÑÍ≤©)');
            syncCheckInterval = setInterval(() => {
                checkDataSync();
            }, 1000);
        }

        function showSyncStatus() {
            const syncElement = document.getElementById('syncStatus');
            syncElement.classList.add('visible');
        }

        function hideSyncStatus() {
            const syncElement = document.getElementById('syncStatus');
            syncElement.classList.remove('visible');
        }

        // ==================== Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ ÌÜµÏã† Ìï®Ïàò ====================
        window.updateOrderStatusFromAdmin = function(orderId, newStatus, receipt = null) {
            console.log('Í¥ÄÎ¶¨ÏûêÎ°úÎ∂ÄÌÑ∞ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏:', orderId, newStatus, receipt);
            
            const orderIndex = allOrders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;
            
            allOrders[orderIndex] = {
                ...allOrders[orderIndex],
                status: newStatus,
                updated: new Date().toISOString()
            };
            
            if (receipt && newStatus === 'ÏôÑÎ£å') {
                allOrders[orderIndex].receipt = receipt;
            }
            
            dataManager.saveOrders(allOrders);
            
            if (newStatus === 'Ï∑®ÏÜå' && currentOrderId === orderId) {
                const modal = document.getElementById('qrModal');
                if (!modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                    resetPaymentForm();
                    currentOrderId = '';
                    
                    alert(currentLang === 'en' ? 
                        'Payment has been cancelled by administrator.' : 
                        'Í¥ÄÎ¶¨ÏûêÏóê ÏùòÌï¥ Í≤∞Ï†úÍ∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                }
            }
            
            updateOrdersList();
        };

        window.updateWalletsFromAdmin = function(wallets) {
            console.log('üëõ ÏÇ¨Ïö©Ïûê ÌéòÏù¥ÏßÄ: Í¥ÄÎ¶¨ÏûêÎ°úÎ∂ÄÌÑ∞ ÏßÄÍ∞ë ÏóÖÎç∞Ïù¥Ìä∏ Î∞õÏùå', wallets.length, 'Í∞ú');
            
            localStorage.setItem('payment_wallets', JSON.stringify(wallets));
            
            allWallets = wallets;
            activeWallet = dataManager.getActiveWallet();
            
            updateWalletDisplay();
            
            if (!document.getElementById('qrModal').classList.contains('hidden')) {
                updateQRCodeDisplay();
            }
        };

        // ==================== ÌÖåÏä§Ìä∏ Ìï®Ïàò ====================
        window.createTestOrder = function() {
            const testOrder = {
                id: dataManager.generateOrderId(),
                amount: Math.floor(Math.random() * 10000) + 1000,
                usdt: Math.random() * 100 + 10,
                status: 'ÏûÖÍ∏àÎåÄÍ∏∞',
                step: 1,
                time: new Date().toISOString(),
                wallet: activeWallet ? {
                    id: activeWallet.id,
                    name: activeWallet.name,
                    address: activeWallet.address,
                    network: activeWallet.network
                } : null,
                proof: {
                    name: 'test.png',
                    type: 'image/png',
                    size: 1024,
                    data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='
                }
            };
            
            saveOrder(testOrder);
            updateOrdersList();
            
            alert(`ÌÖåÏä§Ìä∏ Ï£ºÎ¨∏ ${testOrder.id} ÏÉùÏÑ±Îê®`);
        };
        
        console.log('Í∞ÑÌé∏Ìïú PWA ÌÜµÌï© Ïú†Ï†Ä ÌéòÏù¥ÏßÄ Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú ÏôÑÎ£å');
    </script>
</body>
</html>
